<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>江南一点雨</title>
  
  <subtitle>江南一点雨</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="http://www.javaboy.org/"/>
  <updated>2022-12-19T12:18:56.663Z</updated>
  <id>http://www.javaboy.org/</id>
  
  <author>
    <name>江南一点雨</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>请假要组长和经理同时审批该怎么办？来看看工作流中的会签功能！</title>
    <link href="http://www.javaboy.org/2022/0908/flowable.html"/>
    <id>http://www.javaboy.org/2022/0908/flowable.html</id>
    <published>2022-09-08T12:10:15.000Z</published>
    <updated>2022-12-19T12:18:56.663Z</updated>
    
    <content type="html"><![CDATA[<p>[TOC]</p><p>今天松哥和小伙伴们介绍一下 Spring Security 中另外一个好玩的会签功能。</p><p>会签的意思就是，在一个流程中的某一个 Task 上，这个 Task 需要多个用户审批，当多个用户全部审批通过，或者多个用户中的某几个用户审批通过，就算通过。这就是我们说的 Flowable 中的会签功能！</p><a id="more"></a><p>例如我们之前的请假流程，假设这个请假流程需要组长和经理都审批了，才算审批通过，那么我们就需要设置这个 Task 是会签节点。</p><p>以我们之前的请假流程为例，我和大家演示一下我们这次要实现的效果。</p><ol><li>首先员工提交请假申请，可以提交给多个审批人：</li></ol><p><img src="http://img.itboyhub.com/2022/08/20220902194011.png" alt></p><ol start="2"><li>提交成功之后，员工的历史请假列表中，可以看到刚刚提交的请假申请，但是选择的三个审批人都是灰色的，表示三个人都还没有审批。</li></ol><p><img src="http://img.itboyhub.com/2022/08/20220902194044.png" alt></p><ol start="3"><li>接下来，以 javaboy 的身份登录到系统中，就可以看到刚刚用户提交的请假申请，然后进行审批。</li></ol><p><img src="http://img.itboyhub.com/2022/08/20220902194220.png" alt></p><ol start="4"><li>审批完成后，以 zhangsan 的身份登录到系统中，就可以看到 javaboy 已经完成审批了，等三个人都完成审批之后，这个请假流程的状态也就会变成已通过，要是三个人中有一个人点击了拒绝，那么这个请假流程的状态就会变为已拒绝。</li></ol><p><img src="http://img.itboyhub.com/2022/08/20220902194302.png" alt></p><p>好啦，这就是我们本文要实现的一个功能。本文也是基于之前的文章完成，如果小伙伴们还没看过松哥之前发的关于 Flowable 流程引擎的文章，可以在公众号江南一点雨上先翻一下。</p><h2 id="1-会签流程图"><a href="#1-会签流程图" class="headerlink" title="1. 会签流程图"></a>1. 会签流程图</h2><p>首先我们来画一下这个请假流程图，这个流程图基本上还是和之前的一样，如下图：</p><p><img src="http://img.itboyhub.com/2022/08/20220902194824.png" alt></p><p>这跟我们之前的流程图有两个不一样的地方：</p><ol><li>首先就是最最核心的的这个批准或者拒绝的节点，这个节点下面多个三个竖线，这三个竖线的意思就是多个用户审批时是并发执行的，相互之间没有先后顺序，还有一种是三个横线，三个横线的意思是多个用户顺序执行。当然，这里不是说流程图上多三个竖线就行了，还需要稍微配置一下，如下：</li></ol><p><img src="http://img.itboyhub.com/2022/08/20220902200335.png" alt></p><p>这里配置的属性主要有五个：</p><ul><li>多实例类型：这个选项主要有两个，分别是 Parallel 和 Sequential，表示并发执行还是顺序执行，选择是 Parallel 就是多个用户并发执行，相互之间没有先后顺序，选择 Sequential 则是顺序执行，多个用户之间有先后顺序。</li><li>集合（多实例）：这个地方我配置了一个 ${userTasks}，这个表示当流程执行到这个节点的时候，我会传进来一个变量，这个变量的名字是 userTasks，这个变量中包含了所有要审批这个 Task 的用户名。</li><li>元素变量（多实例）：由于上面的是一个集合，这里配置的则是集合中每一个元素的变量名，这就类似于 Java 里增强 for 循环的变量名。</li><li>完成条件（多实例）：这里我配置的值是 <code>${nrOfCompletedInstances== nrOfInstances}</code>，涉及到两个变量，nrOfCompletedInstances 这个表示已经完成审批的实例个数，nrOfInstances 则表示总共的实例个数，也就是当完成审批的实例个数等于总的实例个数的时候，这个节点就算执行完了，换句话说，也就是 zhangsan 将请假申请提交给 javaboy 和 lisi，必须这两个人都审批了，这个节点才算执行完。另外这里还有一个内置的变量可用就是 nrOfActiveInstances 表示未完成审批的实例个数，只不过在本案例中没有用到这个内置变量。</li><li>分配用户：这个是说这个 Task 的执行人，当然就是我们前面配置的 userTask，也就是从集合中拿出来的每一个元素的变量名。</li></ul><ol start="2"><li>去掉了审批通过之后的 UserTask。</li></ol><p>在之前的请假流程图中，当请假审批通过之后，发送了请假通过通知之后，还会进入到一个 UserTask 流程中，这里为了方便，我把这个流程删掉了。</p><p>好啦，这就是新流程图和以前旧流程图之间的一个区别，现在我们来看下这个流程图对应的 XML 文件：</p><figure class="highlight xml hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="hljs-tag">&lt;<span class="hljs-name">definitions</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">"http://www.omg.org/spec/BPMN/20100524/MODEL"</span> <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">"http://www.w3.org/2001/XMLSchema-instance"</span> <span class="hljs-attr">xmlns:xsd</span>=<span class="hljs-string">"http://www.w3.org/2001/XMLSchema"</span> <span class="hljs-attr">xmlns:flowable</span>=<span class="hljs-string">"http://flowable.org/bpmn"</span> <span class="hljs-attr">xmlns:bpmndi</span>=<span class="hljs-string">"http://www.omg.org/spec/BPMN/20100524/DI"</span> <span class="hljs-attr">xmlns:omgdc</span>=<span class="hljs-string">"http://www.omg.org/spec/DD/20100524/DC"</span> <span class="hljs-attr">xmlns:omgdi</span>=<span class="hljs-string">"http://www.omg.org/spec/DD/20100524/DI"</span> <span class="hljs-attr">typeLanguage</span>=<span class="hljs-string">"http://www.w3.org/2001/XMLSchema"</span> <span class="hljs-attr">expressionLanguage</span>=<span class="hljs-string">"http://www.w3.org/1999/XPath"</span> <span class="hljs-attr">targetNamespace</span>=<span class="hljs-string">"http://www.flowable.org/processdef"</span> <span class="hljs-attr">exporter</span>=<span class="hljs-string">"Flowable Open Source Modeler"</span> <span class="hljs-attr">exporterVersion</span>=<span class="hljs-string">"6.7.2"</span>&gt;</span></span><br><span class="line">  <span class="hljs-tag">&lt;<span class="hljs-name">process</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"holidayRequest"</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"holidayRequest"</span> <span class="hljs-attr">isExecutable</span>=<span class="hljs-string">"true"</span>&gt;</span></span><br><span class="line">    <span class="hljs-tag">&lt;<span class="hljs-name">startEvent</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"startEvent1"</span> <span class="hljs-attr">flowable:formFieldValidation</span>=<span class="hljs-string">"true"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">startEvent</span>&gt;</span></span><br><span class="line">    <span class="hljs-tag">&lt;<span class="hljs-name">userTask</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"sid-1A1AA050-1900-4CAD-A277-18BD97BD61FB"</span> <span class="hljs-attr">flowable:assignee</span>=<span class="hljs-string">"$&#123;userTask&#125;"</span> <span class="hljs-attr">flowable:formFieldValidation</span>=<span class="hljs-string">"true"</span>&gt;</span></span><br><span class="line">      <span class="hljs-tag">&lt;<span class="hljs-name">extensionElements</span>&gt;</span></span><br><span class="line">        <span class="hljs-tag">&lt;<span class="hljs-name">modeler:initiator-can-complete</span> <span class="hljs-attr">xmlns:modeler</span>=<span class="hljs-string">"http://flowable.org/modeler"</span>&gt;</span>&lt;![CDATA[false]]&gt;<span class="hljs-tag">&lt;/<span class="hljs-name">modeler:initiator-can-complete</span>&gt;</span></span><br><span class="line">      <span class="hljs-tag">&lt;/<span class="hljs-name">extensionElements</span>&gt;</span></span><br><span class="line">      <span class="hljs-tag">&lt;<span class="hljs-name">multiInstanceLoopCharacteristics</span> <span class="hljs-attr">isSequential</span>=<span class="hljs-string">"false"</span> <span class="hljs-attr">flowable:collection</span>=<span class="hljs-string">"$&#123;userTasks&#125;"</span> <span class="hljs-attr">flowable:elementVariable</span>=<span class="hljs-string">"userTask"</span>&gt;</span></span><br><span class="line">        <span class="hljs-tag">&lt;<span class="hljs-name">extensionElements</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">extensionElements</span>&gt;</span></span><br><span class="line">        <span class="hljs-tag">&lt;<span class="hljs-name">completionCondition</span>&gt;</span>$&#123;nrOfCompletedInstances == nrOfInstances&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">completionCondition</span>&gt;</span></span><br><span class="line">      <span class="hljs-tag">&lt;/<span class="hljs-name">multiInstanceLoopCharacteristics</span>&gt;</span></span><br><span class="line">    <span class="hljs-tag">&lt;/<span class="hljs-name">userTask</span>&gt;</span></span><br><span class="line">    <span class="hljs-tag">&lt;<span class="hljs-name">sequenceFlow</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"sid-2597F958-175E-4F9F-9BEA-6E89D6C5B0A4"</span> <span class="hljs-attr">sourceRef</span>=<span class="hljs-string">"startEvent1"</span> <span class="hljs-attr">targetRef</span>=<span class="hljs-string">"sid-1A1AA050-1900-4CAD-A277-18BD97BD61FB"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">sequenceFlow</span>&gt;</span></span><br><span class="line">    <span class="hljs-tag">&lt;<span class="hljs-name">exclusiveGateway</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"sid-A04AF65B-D8B2-4F30-BFD5-7F2C9FCEFA51"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">exclusiveGateway</span>&gt;</span></span><br><span class="line">    <span class="hljs-tag">&lt;<span class="hljs-name">sequenceFlow</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"sid-7CD68B1D-C2CE-4A1A-ABA7-216D0F80BDD8"</span> <span class="hljs-attr">sourceRef</span>=<span class="hljs-string">"sid-1A1AA050-1900-4CAD-A277-18BD97BD61FB"</span> <span class="hljs-attr">targetRef</span>=<span class="hljs-string">"sid-A04AF65B-D8B2-4F30-BFD5-7F2C9FCEFA51"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">sequenceFlow</span>&gt;</span></span><br><span class="line">    <span class="hljs-tag">&lt;<span class="hljs-name">serviceTask</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"sid-4412386C-15E9-40C6-AB6B-66919A8D1302"</span> <span class="hljs-attr">flowable:class</span>=<span class="hljs-string">"org.javaboy.flowable03.flowable.Approve"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">serviceTask</span>&gt;</span></span><br><span class="line">    <span class="hljs-tag">&lt;<span class="hljs-name">serviceTask</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"sid-903B79F3-2020-419E-AD42-215C2E26C784"</span> <span class="hljs-attr">flowable:class</span>=<span class="hljs-string">"org.javaboy.flowable03.flowable.Reject"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">serviceTask</span>&gt;</span></span><br><span class="line">    <span class="hljs-tag">&lt;<span class="hljs-name">endEvent</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"sid-FE27FA28-2B2F-4572-A2D6-BFE83EBA9370"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">endEvent</span>&gt;</span></span><br><span class="line">    <span class="hljs-tag">&lt;<span class="hljs-name">sequenceFlow</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"sid-474E5177-9B1A-4757-877F-5A0DA72B0A59"</span> <span class="hljs-attr">sourceRef</span>=<span class="hljs-string">"sid-903B79F3-2020-419E-AD42-215C2E26C784"</span> <span class="hljs-attr">targetRef</span>=<span class="hljs-string">"sid-FE27FA28-2B2F-4572-A2D6-BFE83EBA9370"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">sequenceFlow</span>&gt;</span></span><br><span class="line">    <span class="hljs-tag">&lt;<span class="hljs-name">sequenceFlow</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"sid-85E7B515-734C-4E46-9889-D74FC5A04891"</span> <span class="hljs-attr">sourceRef</span>=<span class="hljs-string">"sid-A04AF65B-D8B2-4F30-BFD5-7F2C9FCEFA51"</span> <span class="hljs-attr">targetRef</span>=<span class="hljs-string">"sid-903B79F3-2020-419E-AD42-215C2E26C784"</span>&gt;</span></span><br><span class="line">      <span class="hljs-tag">&lt;<span class="hljs-name">conditionExpression</span> <span class="hljs-attr">xsi:type</span>=<span class="hljs-string">"tFormalExpression"</span>&gt;</span>&lt;![CDATA[$&#123;!approved&#125;]]&gt;<span class="hljs-tag">&lt;/<span class="hljs-name">conditionExpression</span>&gt;</span></span><br><span class="line">    <span class="hljs-tag">&lt;/<span class="hljs-name">sequenceFlow</span>&gt;</span></span><br><span class="line">    <span class="hljs-tag">&lt;<span class="hljs-name">sequenceFlow</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"sid-EEC3F695-D61D-40BC-BA68-BCDD4DA40299"</span> <span class="hljs-attr">sourceRef</span>=<span class="hljs-string">"sid-A04AF65B-D8B2-4F30-BFD5-7F2C9FCEFA51"</span> <span class="hljs-attr">targetRef</span>=<span class="hljs-string">"sid-4412386C-15E9-40C6-AB6B-66919A8D1302"</span>&gt;</span></span><br><span class="line">      <span class="hljs-tag">&lt;<span class="hljs-name">conditionExpression</span> <span class="hljs-attr">xsi:type</span>=<span class="hljs-string">"tFormalExpression"</span>&gt;</span>&lt;![CDATA[$&#123;approved&#125;]]&gt;<span class="hljs-tag">&lt;/<span class="hljs-name">conditionExpression</span>&gt;</span></span><br><span class="line">    <span class="hljs-tag">&lt;/<span class="hljs-name">sequenceFlow</span>&gt;</span></span><br><span class="line">    <span class="hljs-tag">&lt;<span class="hljs-name">endEvent</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"sid-92DA7300-EFD1-437B-96D5-EAADAFABC507"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">endEvent</span>&gt;</span></span><br><span class="line">    <span class="hljs-tag">&lt;<span class="hljs-name">sequenceFlow</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"sid-E882A39F-9E88-4BB8-B7CE-F975B6ADC862"</span> <span class="hljs-attr">sourceRef</span>=<span class="hljs-string">"sid-4412386C-15E9-40C6-AB6B-66919A8D1302"</span> <span class="hljs-attr">targetRef</span>=<span class="hljs-string">"sid-92DA7300-EFD1-437B-96D5-EAADAFABC507"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">sequenceFlow</span>&gt;</span></span><br><span class="line">  <span class="hljs-tag">&lt;/<span class="hljs-name">process</span>&gt;</span></span><br><span class="line"><span class="hljs-tag">&lt;/<span class="hljs-name">definitions</span>&gt;</span></span><br></pre></td></tr></table></figure><p>这个流程图也没有啥特别值得说的地方，基本上前面该说的都说了，小伙伴们可以自行结合流程图对比看下这个 XML 文件。</p><h2 id="2-请假处理"><a href="#2-请假处理" class="headerlink" title="2. 请假处理"></a>2. 请假处理</h2><h3 id="2-1-前端提交请假流程"><a href="#2-1-前端提交请假流程" class="headerlink" title="2.1 前端提交请假流程"></a>2.1 前端提交请假流程</h3><p>接下来我们看下前端如何提交请假申请：</p><p>先来看页面：</p><p><img src="http://img.itboyhub.com/2022/08/20220902194011.png" alt></p><p>对应的 HTML 如下：</p><figure class="highlight html hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>提交请假申请<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span></span><br><span class="line"><span class="hljs-tag">&lt;<span class="hljs-name">table</span>&gt;</span></span><br><span class="line">    <span class="hljs-tag">&lt;<span class="hljs-name">tr</span>&gt;</span></span><br><span class="line">        <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>请输入请假天数：<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span></span><br><span class="line">        <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span></span><br><span class="line">            <span class="hljs-tag">&lt;<span class="hljs-name">el-input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"text"</span> <span class="hljs-attr">v-model</span>=<span class="hljs-string">"afl.days"</span>/&gt;</span></span><br><span class="line">        <span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span></span><br><span class="line">    <span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span></span><br><span class="line">    <span class="hljs-tag">&lt;<span class="hljs-name">tr</span>&gt;</span></span><br><span class="line">        <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>请输入请假理由：<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span></span><br><span class="line">        <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span></span><br><span class="line">            <span class="hljs-tag">&lt;<span class="hljs-name">el-input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"text"</span> <span class="hljs-attr">v-model</span>=<span class="hljs-string">"afl.reason"</span>/&gt;</span></span><br><span class="line">        <span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span></span><br><span class="line">    <span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span></span><br><span class="line">    <span class="hljs-tag">&lt;<span class="hljs-name">tr</span>&gt;</span></span><br><span class="line">        <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>审批人：<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span></span><br><span class="line">        <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span></span><br><span class="line">            <span class="hljs-tag">&lt;<span class="hljs-name">el-select</span> <span class="hljs-attr">v-model</span>=<span class="hljs-string">"afl.approveUsers"</span> <span class="hljs-attr">style</span>=<span class="hljs-string">"width: 226px"</span> <span class="hljs-attr">placeholder</span>=<span class="hljs-string">"请选择审批人"</span> <span class="hljs-attr">multiple</span>&gt;</span></span><br><span class="line">                <span class="hljs-tag">&lt;<span class="hljs-name">el-option</span></span></span><br><span class="line"><span class="hljs-tag">                        <span class="hljs-attr">v-for</span>=<span class="hljs-string">"item in users"</span></span></span><br><span class="line"><span class="hljs-tag">                        <span class="hljs-attr">:key</span>=<span class="hljs-string">"item.id"</span></span></span><br><span class="line"><span class="hljs-tag">                        <span class="hljs-attr">:label</span>=<span class="hljs-string">"item.username"</span></span></span><br><span class="line"><span class="hljs-tag">                        <span class="hljs-attr">:value</span>=<span class="hljs-string">"item.username"</span>/&gt;</span></span><br><span class="line">            <span class="hljs-tag">&lt;/<span class="hljs-name">el-select</span>&gt;</span></span><br><span class="line">        <span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span></span><br><span class="line">    <span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span></span><br><span class="line"><span class="hljs-tag">&lt;/<span class="hljs-name">table</span>&gt;</span></span><br><span class="line"><span class="hljs-tag">&lt;<span class="hljs-name">el-button</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"primary"</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">"submit"</span>&gt;</span>提交请假申请<span class="hljs-tag">&lt;/<span class="hljs-name">el-button</span>&gt;</span></span><br></pre></td></tr></table></figure><p>跟之前不同的是，这里的下拉框是多选的，当用户提交请假申请的时候，可以选择多个审批人，多个审批人的值将保存在 afl.approveUsers 变量中。</p><p>再来看提交请假方法：</p><figure class="highlight js hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">submit() &#123;</span><br><span class="line">    <span class="hljs-keyword">let</span> _this = <span class="hljs-keyword">this</span>;</span><br><span class="line">    axios.post(<span class="hljs-string">'/ask_for_leave'</span>, <span class="hljs-keyword">this</span>.afl)</span><br><span class="line">        .then(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">response</span>) </span>&#123;</span><br><span class="line">            <span class="hljs-keyword">if</span> (response.data.status == <span class="hljs-number">200</span>) &#123;</span><br><span class="line">                <span class="hljs-comment">//提交成功</span></span><br><span class="line">                _this.$message.success(response.data.msg);</span><br><span class="line">                _this.search();</span><br><span class="line">            &#125; <span class="hljs-keyword">else</span> &#123;</span><br><span class="line">                <span class="hljs-comment">//提交失败</span></span><br><span class="line">                _this.$message.error(response.data.msg);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">        .catch(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">error</span>) </span>&#123;</span><br><span class="line">            <span class="hljs-built_in">console</span>.log(error);</span><br><span class="line">        &#125;);</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure><p>这个方法其实没啥好说的，唯一需要和小伙伴们强调的是请求的参数，来看下：</p><p><img src="http://img.itboyhub.com/2022/08/20220902210820.png" alt></p><p>我们来看下我这里提交的三个请求参数：</p><ol><li>approveUsers：这是审批当前流程的三个用户，当这三个用户都审批通过后，请假流程就通过了。</li><li>days：这是请假的天数。</li><li>reason：这是请假理由。</li></ol><h3 id="2-2-服务端处理请假请求"><a href="#2-2-服务端处理请假请求" class="headerlink" title="2.2 服务端处理请假请求"></a>2.2 服务端处理请假请求</h3><p>我们再来看看服务端如何处理这个请假请求，我这里跟大家展示最核心的流程处理代码，文末可以下载完整代码。</p><figure class="highlight java hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-meta">@Transactional</span></span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">public</span> RespBean <span class="hljs-title">askForLeave</span><span class="hljs-params">(AskForLeaveVO askForLeaveVO)</span> </span>&#123;</span><br><span class="line">    Map&lt;String, Object&gt; variables = <span class="hljs-keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">    askForLeaveVO.setName(SecurityContextHolder.getContext().getAuthentication().getName());</span><br><span class="line">    variables.put(<span class="hljs-string">"name"</span>, askForLeaveVO.getName());</span><br><span class="line">    variables.put(<span class="hljs-string">"days"</span>, askForLeaveVO.getDays());</span><br><span class="line">    variables.put(<span class="hljs-string">"reason"</span>, askForLeaveVO.getReason());</span><br><span class="line">    variables.put(<span class="hljs-string">"userTasks"</span>, askForLeaveVO.getApproveUsers());</span><br><span class="line">    <span class="hljs-keyword">try</span> &#123;</span><br><span class="line">        runtimeService.startProcessInstanceByKey(<span class="hljs-string">"holidayRequest"</span>, askForLeaveVO.getName(), variables);</span><br><span class="line">        <span class="hljs-keyword">return</span> RespBean.ok(<span class="hljs-string">"已提交请假申请"</span>);</span><br><span class="line">    &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="hljs-keyword">return</span> RespBean.error(<span class="hljs-string">"提交申请失败"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>可以看到，从前端一共传递过来三个参数，但是执行这个流程需要四个参数，其中一个 name 表示当前登录的用户名，也就是这个请假是谁发起的。另外三个参数就是前端传来的参数。</p><h3 id="2-3-服务端返回待审批数据"><a href="#2-3-服务端返回待审批数据" class="headerlink" title="2.3 服务端返回待审批数据"></a>2.3 服务端返回待审批数据</h3><p>接下来我们来看看服务端如何返回待审批数据，也就是下面这张图要展示的数据：</p><p><img src="http://img.itboyhub.com/2022/08/20220902194220.png" alt></p><figure class="highlight java hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment">/**</span></span><br><span class="line"><span class="hljs-comment"> * 待审批列表</span></span><br><span class="line"><span class="hljs-comment"> *</span></span><br><span class="line"><span class="hljs-comment"> * <span class="hljs-doctag">@return</span></span></span><br><span class="line"><span class="hljs-comment"> */</span></span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">public</span> RespBean <span class="hljs-title">leaveList</span><span class="hljs-params">()</span> </span>&#123;</span><br><span class="line">    String identity = SecurityContextHolder.getContext().getAuthentication().getName();</span><br><span class="line">    <span class="hljs-comment">//找到所有分配给你的任务</span></span><br><span class="line">    List&lt;Task&gt; tasks = taskService.createTaskQuery().taskAssignee(identity).list();</span><br><span class="line">    <span class="hljs-comment">//重新组装返回的数据，为每个流程增加任务 id，方便后续执行批准或者拒绝操作</span></span><br><span class="line">    List&lt;Map&lt;String, Object&gt;&gt; list = <span class="hljs-keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; tasks.size(); i++) &#123;</span><br><span class="line">        Task task = tasks.get(i);</span><br><span class="line">        Map&lt;String, Object&gt; variables = taskService.getVariables(task.getId());</span><br><span class="line">        variables.put(<span class="hljs-string">"id"</span>, task.getId());</span><br><span class="line">        list.add(variables);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="hljs-keyword">return</span> RespBean.ok(<span class="hljs-string">"加载成功"</span>, list);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>这个整体上分了两步：</p><ol><li>首先查询出来当前用户所有待审批的 Task。</li><li>查询出来这些 Task 上的 variables，这是一个 Map 集合，然后我们再手动加上 id 这个参数。</li></ol><p>最后将组装好的 list 弄成一个 JSON 返回即可。</p><h3 id="2-4-服务端批准-OR-拒绝"><a href="#2-4-服务端批准-OR-拒绝" class="headerlink" title="2.4 服务端批准 OR 拒绝"></a>2.4 服务端批准 OR 拒绝</h3><p>我们再来看看服务端批准或者拒绝请假流程的代码：</p><figure class="highlight java hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-function"><span class="hljs-keyword">public</span> RespBean <span class="hljs-title">askForLeaveHandler</span><span class="hljs-params">(ApproveRejectVO approveRejectVO)</span> </span>&#123;</span><br><span class="line">    <span class="hljs-keyword">try</span> &#123;</span><br><span class="line">        Task task = taskService.createTaskQuery().taskId(approveRejectVO.getTaskId()).singleResult();</span><br><span class="line">        <span class="hljs-keyword">boolean</span> approved = approveRejectVO.getApprove();</span><br><span class="line">        Map&lt;String, Object&gt; variables = <span class="hljs-keyword">new</span> HashMap&lt;String, Object&gt;();</span><br><span class="line">        variables.put(<span class="hljs-string">"approved"</span>, approved);</span><br><span class="line">        variables.put(<span class="hljs-string">"approveUser#"</span> + task.getAssignee(), SecurityContextHolder.getContext().getAuthentication().getName());</span><br><span class="line">        taskService.complete(task.getId(), variables);</span><br><span class="line">        <span class="hljs-keyword">return</span> RespBean.ok(<span class="hljs-string">"操作成功"</span>);</span><br><span class="line">    &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="hljs-keyword">return</span> RespBean.error(<span class="hljs-string">"操作失败"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>批准或者拒绝，最主要的参数就是 approved，true 表示批准，false 表示拒绝。</p><p>另一方面，由于现在是会签，我们需要知道目前谁已经审批了，谁还没审批，所以这里额外多加了一个参数 <code>approveUser#XXX</code>，表示审批这个节点的用户名（也就是当前登录用户）。</p><p>注意这个参数的 key 我没有固定，主要是因为这个节点会有多个人审批，如果固定的话，后面审批的人会覆盖掉前面的人，所以这个节点的 key 设置成动态的了，<code>approveUser#</code> 后面加上处理这个节点的用户名。</p><h3 id="2-5-服务端返回流程数据"><a href="#2-5-服务端返回流程数据" class="headerlink" title="2.5 服务端返回流程数据"></a>2.5 服务端返回流程数据</h3><p>最后还有服务端展示流程数据。就是当用户提交流程之后，想要查看自己的流程处理到哪一步了，也就是下图中的数据：</p><p><img src="http://img.itboyhub.com/2022/08/20220902194302.png" alt></p><p>这张图中的数据其实包含了两部分，一部分是已经执行完的流程，还有一部分是正在执行中的流程，所以在查询中，我们也得分为两步来完成，如下：</p><figure class="highlight java hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-function"><span class="hljs-keyword">public</span> RespBean <span class="hljs-title">searchResult</span><span class="hljs-params">()</span> </span>&#123;</span><br><span class="line">    String name = SecurityContextHolder.getContext().getAuthentication().getName();</span><br><span class="line">    List&lt;HistoryInfo&gt; infos = <span class="hljs-keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">    <span class="hljs-comment">//未完成流程</span></span><br><span class="line">    List&lt;HistoricProcessInstance&gt; unFinishedHistoricProcessInstances = historyService.createHistoricProcessInstanceQuery().processInstanceBusinessKey(name).unfinished().orderByProcessInstanceStartTime().desc().list();</span><br><span class="line">    <span class="hljs-keyword">for</span> (HistoricProcessInstance unFinishedHistoricProcessInstance : unFinishedHistoricProcessInstances) &#123;</span><br><span class="line">        HistoryInfo historyInfo = <span class="hljs-keyword">new</span> HistoryInfo();</span><br><span class="line">        Date startTime = unFinishedHistoricProcessInstance.getStartTime();</span><br><span class="line">        Date endTime = unFinishedHistoricProcessInstance.getEndTime();</span><br><span class="line">        List&lt;HistoricVariableInstance&gt; historicVariableInstances = historyService.createHistoricVariableInstanceQuery()</span><br><span class="line">                .processInstanceId(unFinishedHistoricProcessInstance.getId())</span><br><span class="line">                .list();</span><br><span class="line">        System.out.println(<span class="hljs-string">"historicVariableInstances = "</span> + historicVariableInstances);</span><br><span class="line">        <span class="hljs-keyword">for</span> (HistoricVariableInstance historicVariableInstance : historicVariableInstances) &#123;</span><br><span class="line">            String variableName = historicVariableInstance.getVariableName();</span><br><span class="line">            Object value = historicVariableInstance.getValue();</span><br><span class="line">            <span class="hljs-keyword">if</span> (<span class="hljs-string">"reason"</span>.equals(variableName)) &#123;</span><br><span class="line">                historyInfo.setReason((String) value);</span><br><span class="line">            &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-string">"days"</span>.equals(variableName)) &#123;</span><br><span class="line">                historyInfo.setDays(Integer.parseInt(value.toString()));</span><br><span class="line">            &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-string">"name"</span>.equals(variableName)) &#123;</span><br><span class="line">                historyInfo.setName((String) value);</span><br><span class="line">            &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (variableName.startsWith(<span class="hljs-string">"approveUser"</span>)) &#123;</span><br><span class="line">                historyInfo.getApproveUsers().add((String) value);</span><br><span class="line">            &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-string">"userTask"</span>.equals(variableName)) &#123;</span><br><span class="line">                historyInfo.getCandidateUsers().add((String) value);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        historyInfo.setStatus(<span class="hljs-number">3</span>);</span><br><span class="line">        historyInfo.setStartTime(startTime);</span><br><span class="line">        historyInfo.setEndTime(endTime);</span><br><span class="line">        infos.add(historyInfo);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="hljs-comment">//已结束流程</span></span><br><span class="line">    List&lt;HistoricProcessInstance&gt; finishHistoricProcessInstances = historyService.createHistoricProcessInstanceQuery().processInstanceBusinessKey(name)</span><br><span class="line">            .finished()</span><br><span class="line">            .orderByProcessInstanceStartTime().desc().list();</span><br><span class="line">    <span class="hljs-keyword">for</span> (HistoricProcessInstance historicProcessInstance : finishHistoricProcessInstances) &#123;</span><br><span class="line">        HistoryInfo historyInfo = <span class="hljs-keyword">new</span> HistoryInfo();</span><br><span class="line">        Date startTime = historicProcessInstance.getStartTime();</span><br><span class="line">        Date endTime = historicProcessInstance.getEndTime();</span><br><span class="line">        List&lt;HistoricVariableInstance&gt; historicVariableInstances = historyService.createHistoricVariableInstanceQuery()</span><br><span class="line">                .processInstanceId(historicProcessInstance.getId())</span><br><span class="line">                .list();</span><br><span class="line">        System.out.println(historicVariableInstances);</span><br><span class="line">        <span class="hljs-keyword">for</span> (HistoricVariableInstance historicVariableInstance : historicVariableInstances) &#123;</span><br><span class="line">            String variableName = historicVariableInstance.getVariableName();</span><br><span class="line">            Object value = historicVariableInstance.getValue();</span><br><span class="line">            <span class="hljs-keyword">if</span> (<span class="hljs-string">"reason"</span>.equals(variableName)) &#123;</span><br><span class="line">                historyInfo.setReason((String) value);</span><br><span class="line">            &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-string">"days"</span>.equals(variableName)) &#123;</span><br><span class="line">                historyInfo.setDays(Integer.parseInt(value.toString()));</span><br><span class="line">            &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-string">"approved"</span>.equals(variableName)) &#123;</span><br><span class="line">                Boolean v = (Boolean) value;</span><br><span class="line">                <span class="hljs-keyword">if</span> (v) &#123;</span><br><span class="line">                    historyInfo.setStatus(<span class="hljs-number">1</span>);</span><br><span class="line">                &#125; <span class="hljs-keyword">else</span> &#123;</span><br><span class="line">                    historyInfo.setStatus(<span class="hljs-number">2</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-string">"name"</span>.equals(variableName)) &#123;</span><br><span class="line">                historyInfo.setName((String) value);</span><br><span class="line">            &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (variableName.startsWith(<span class="hljs-string">"approveUser"</span>)) &#123;</span><br><span class="line">                historyInfo.getApproveUsers().add((String) value);</span><br><span class="line">            &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-string">"userTask"</span>.equals(variableName)) &#123;</span><br><span class="line">                historyInfo.getCandidateUsers().add((String) value);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        historyInfo.setStartTime(startTime);</span><br><span class="line">        historyInfo.setEndTime(endTime);</span><br><span class="line">        infos.add(historyInfo);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="hljs-keyword">return</span> RespBean.ok(<span class="hljs-string">"ok"</span>, infos);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>这段代码比较长，但是比较像。整体上分为两部分，前面是查询未执行完的流程，后面是查询已经执行完毕的流程。对于未执行完的流程，我们在 historyInfo 中设置 status 为 3，表示待审批。当我们去读取一个流程的历史变量时，有一个以 approveUser 开头的变量，这个就表示这个流程已经被谁审批过了，我们将这个存到一个 List 集合中，将来返回给前端。流程的历史变量中还有一个 userTask，表示这个流程中这个节点待审批的用户都有谁，我们也将之保存到 List 集合中，将来返回给前端。</p><h3 id="2-6-前端渲染审批数据"><a href="#2-6-前端渲染审批数据" class="headerlink" title="2.6 前端渲染审批数据"></a>2.6 前端渲染审批数据</h3><p>最后，我们再来看看前端如何渲染 2.5 小节返回的数据，如下：</p><figure class="highlight html hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span></span><br><span class="line">    <span class="hljs-tag">&lt;<span class="hljs-name">el-tag</span>&gt;</span>历史请假列表<span class="hljs-tag">&lt;/<span class="hljs-name">el-tag</span>&gt;</span></span><br><span class="line">    <span class="hljs-tag">&lt;<span class="hljs-name">el-table</span> <span class="hljs-attr">border</span> <span class="hljs-attr">strip</span> <span class="hljs-attr">:data</span>=<span class="hljs-string">"historyInfos"</span>&gt;</span></span><br><span class="line">        <span class="hljs-tag">&lt;<span class="hljs-name">el-table-column</span> <span class="hljs-attr">prop</span>=<span class="hljs-string">"name"</span> <span class="hljs-attr">label</span>=<span class="hljs-string">"姓名"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">el-table-column</span>&gt;</span></span><br><span class="line">        <span class="hljs-tag">&lt;<span class="hljs-name">el-table-column</span> <span class="hljs-attr">prop</span>=<span class="hljs-string">"startTime"</span> <span class="hljs-attr">label</span>=<span class="hljs-string">"提交时间"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">el-table-column</span>&gt;</span></span><br><span class="line">        <span class="hljs-tag">&lt;<span class="hljs-name">el-table-column</span> <span class="hljs-attr">prop</span>=<span class="hljs-string">"endTime"</span> <span class="hljs-attr">label</span>=<span class="hljs-string">"审批时间"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">el-table-column</span>&gt;</span></span><br><span class="line">        <span class="hljs-tag">&lt;<span class="hljs-name">el-table-column</span> <span class="hljs-attr">prop</span>=<span class="hljs-string">"reason"</span> <span class="hljs-attr">label</span>=<span class="hljs-string">"事由"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">el-table-column</span>&gt;</span></span><br><span class="line">        <span class="hljs-tag">&lt;<span class="hljs-name">el-table-column</span> <span class="hljs-attr">prop</span>=<span class="hljs-string">"days"</span> <span class="hljs-attr">label</span>=<span class="hljs-string">"天数"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">el-table-column</span>&gt;</span></span><br><span class="line">        <span class="hljs-tag">&lt;<span class="hljs-name">el-table-column</span> <span class="hljs-attr">label</span>=<span class="hljs-string">"审批人"</span>&gt;</span></span><br><span class="line">            <span class="hljs-tag">&lt;<span class="hljs-name">template</span> #<span class="hljs-attr">default</span>=<span class="hljs-string">"scope"</span>&gt;</span></span><br><span class="line">                <span class="hljs-tag">&lt;<span class="hljs-name">template</span> <span class="hljs-attr">v-for</span>=<span class="hljs-string">"(cu,i) in scope.row.candidateUsers"</span> <span class="hljs-attr">:key</span>=<span class="hljs-string">"i"</span>&gt;</span></span><br><span class="line">                    <span class="hljs-tag">&lt;<span class="hljs-name">el-tag</span> <span class="hljs-attr">v-if</span>=<span class="hljs-string">"scope.row.approveUsers.indexOf(cu)!=-1"</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"success"</span>&gt;</span></span><br><span class="line">                        &#123;&#123;cu&#125;&#125;</span><br><span class="line">                    <span class="hljs-tag">&lt;/<span class="hljs-name">el-tag</span>&gt;</span></span><br><span class="line">                    <span class="hljs-tag">&lt;<span class="hljs-name">el-tag</span> <span class="hljs-attr">v-else</span> <span class="hljs-attr">style</span>=<span class="hljs-string">"color: gray"</span>&gt;</span>&#123;&#123;cu&#125;&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">el-tag</span>&gt;</span></span><br><span class="line">                <span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span></span><br><span class="line">            <span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span></span><br><span class="line">        <span class="hljs-tag">&lt;/<span class="hljs-name">el-table-column</span>&gt;</span></span><br><span class="line">        <span class="hljs-tag">&lt;<span class="hljs-name">el-table-column</span> <span class="hljs-attr">label</span>=<span class="hljs-string">"状态"</span>&gt;</span></span><br><span class="line">            <span class="hljs-tag">&lt;<span class="hljs-name">template</span> #<span class="hljs-attr">default</span>=<span class="hljs-string">"scope"</span>&gt;</span></span><br><span class="line">                <span class="hljs-tag">&lt;<span class="hljs-name">el-tag</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"success"</span> <span class="hljs-attr">v-if</span>=<span class="hljs-string">"scope.row.status==1"</span>&gt;</span>已通过<span class="hljs-tag">&lt;/<span class="hljs-name">el-tag</span>&gt;</span></span><br><span class="line">                <span class="hljs-tag">&lt;<span class="hljs-name">el-tag</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"danger"</span> <span class="hljs-attr">v-else-if</span>=<span class="hljs-string">"scope.row.status==2"</span>&gt;</span>已拒绝<span class="hljs-tag">&lt;/<span class="hljs-name">el-tag</span>&gt;</span></span><br><span class="line">                <span class="hljs-tag">&lt;<span class="hljs-name">el-tag</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"info"</span> <span class="hljs-attr">v-else</span>&gt;</span>待审批<span class="hljs-tag">&lt;/<span class="hljs-name">el-tag</span>&gt;</span></span><br><span class="line">            <span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span></span><br><span class="line">        <span class="hljs-tag">&lt;/<span class="hljs-name">el-table-column</span>&gt;</span></span><br><span class="line">    <span class="hljs-tag">&lt;/<span class="hljs-name">el-table</span>&gt;</span></span><br><span class="line"><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><p>大家看到，在审批人这个字段中，我们先去遍历显示这个流程所有的审批人（candidateUsers），在遍历的过程中，如果发现这个用户存在于 approveUsers 集合中，就表示这个用户已经审批，用绿色的 el-tag 显示，否则表示这个用户还没有审批，我们就用灰色的 el-tag 显示。</p><p>好啦，这就可以啦！一个简简单单的会签功能就完成了，测试流程我就不演示了，小伙伴们参考本文一开始的内容～</p><h2 id="3-或签"><a href="#3-或签" class="headerlink" title="3. 或签"></a>3. 或签</h2><p>说完了会签，再来和大家说一说或签。</p><p>或签意思就是 A 的请假流程提交给 B、C、D，但是并不需要 B/C/D 同时审批通过，只需要 B/C/D 中的任意一个审批即可，这就是或签，<strong>注意，我这里的表述，只需要 B/C/D 任意一个审批即可，这个审批即可以是审批通过，也可以是审批拒绝，反正只要审批，这个 UserTask 就算完成了</strong>。</p><p>将会签改为或签其实非常容易，我们只需要修改一下 UserTask 的属性即可，和会签相比，我这里主要改了一个地方，都在下图中用箭头标出来了：</p><p><img src="http://img.itboyhub.com/2022/08/20220903212658.png" alt></p><blockquote><p>完成条件（多实例）这里改为了 <code>${nrOfCompletedInstances &gt;= 1}</code>，表示只要有一个同意或者拒绝，这个 UserTask 就算过了。</p></blockquote><p>改完之后，我们重新下载这个流程图的 XML 文件，并放到前文中的代码上去运行，就可以看到或签效果了，我就不演示了，小伙伴们可以自行尝试。</p><p>本文也有配套视频，感兴趣的小伙伴戳这里查看视频详情：<a href="https://mp.weixin.qq.com/s/RyW6cr6DfxItuqEfrRnBPA" target="_blank" rel="noopener">TienChin 项目配套视频来啦</a>。</p><p>小伙伴们在公众号江南一点雨后台回复 flowable04 可以下载本文完整案例～</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;[TOC]&lt;/p&gt;
&lt;p&gt;今天松哥和小伙伴们介绍一下 Spring Security 中另外一个好玩的会签功能。&lt;/p&gt;
&lt;p&gt;会签的意思就是，在一个流程中的某一个 Task 上，这个 Task 需要多个用户审批，当多个用户全部审批通过，或者多个用户中的某几个用户审批通过，就算通过。这就是我们说的 Flowable 中的会签功能！&lt;/p&gt;
    
    </summary>
    
      <category term="TienChin" scheme="http://www.javaboy.org/categories/TienChin/"/>
    
    
      <category term="TienChin" scheme="http://www.javaboy.org/tags/TienChin/"/>
    
      <category term="Flowable" scheme="http://www.javaboy.org/tags/Flowable/"/>
    
  </entry>
  
  <entry>
    <title>Flowable 79 张表都是干嘛的？</title>
    <link href="http://www.javaboy.org/2022/0907/flowable-tables.html"/>
    <id>http://www.javaboy.org/2022/0907/flowable-tables.html</id>
    <published>2022-09-07T12:10:01.000Z</published>
    <updated>2022-12-19T12:18:53.339Z</updated>
    
    <content type="html"><![CDATA[<p>[TOC]</p><p>当我们使用 Flowable 流程引擎的时候，虽然我们使用的是各种 API，但是小伙伴们都知道，这些 API 本质上操作的都是底层的数据表，Flowable 默认一共生成了 79 张数据表，了解这些数据表，有助于我们更好的理解 Flowable 中的各种 API，因此今天松哥就来和大家捋一捋 Flowable 中的数据表都有哪些，以及这些表都是干嘛用的。</p><a id="more"></a><p>现在我们基本上都是 Spring Boot 工程了，在 Spring Boot 工程中，只要我们添加了 Flowable 的依然，然后启动项目，系统就会自动帮我们创建 79 张表，查询 SQL 如下：</p><figure class="highlight sql hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">COUNT</span>(*) <span class="hljs-keyword">TABLES</span>, table_schema <span class="hljs-keyword">FROM</span> information_schema.TABLES  <span class="hljs-keyword">WHERE</span> table_schema = <span class="hljs-string">'flowable02'</span> <span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> table_schema;</span><br></pre></td></tr></table></figure><p><img src="http://img.itboyhub.com/2022/08/20220903224046.png" alt></p><blockquote><p>这里显示了 82 张表，是因为我自己手动创建了三个跟用户相关的表，其他 79 张表都是 Flowable 自动创建的。</p></blockquote><p>好了，接下来我们就对这 79 张表进行一个简单的分类整理。</p><ol><li><code>ACT_APP_*</code>（5）</li><li><code>ACT_CMMN_*</code>（12）</li><li><code>ACT_CO_*</code>（3）</li><li><code>ACT_DMN_*</code>（6）</li><li><code>ACT_EVT_*</code>（1）</li><li><code>ACT_FO_*</code>（6）</li><li><code>ACT_GE_*</code>（2）</li><li><code>ACT_HI_*</code>（10）</li><li><code>ACT_ID_*</code>（9）</li><li><code>ACT_PROCDEF_*</code>（1）</li><li><code>ACT_RE_*</code>（3）</li><li><code>ACT_RU_*</code>（13）</li><li><code>FLW_CHANNEL_*</code>（1）</li><li><code>FLW_EV_*</code>（2）</li><li><code>FLW_EVENT_*</code>（3）</li><li><code>FLW_RU_*</code>（2）</li></ol><p><code>*</code> 是通配符，后面的数字表示这种类型的表有多少个。</p><p>大致看一下，其实还是有很多规律的。</p><p>最明显的规律就表名通过两个 <code>_</code> 隔开成了三部分，接下来我们就以此为线索，一部分一部分来讲。</p><h2 id="1-表名前缀"><a href="#1-表名前缀" class="headerlink" title="1. 表名前缀"></a>1. 表名前缀</h2><p>首先搭建看这个表的前缀，分了两种：</p><ul><li>ACT_</li><li>FLW_</li></ul><p>松哥在之前的文章中已经和大家介绍过了，Flowable 是基于 Activiti 开发出来的流程引擎，所以我们在很多地方都还能看到 Activiti 的影子，这个表名中 <code>ACT_</code> 就是 Activiti。</p><p>具体来说，与 Flowable 开源代码库相关的数据库表名以 <code>ACT_</code> 开头。特定于 Flowable Work 或 Engage 的数据库表以 <code>FLW_</code> 前缀开头。</p><h2 id="2-表名中间部分"><a href="#2-表名中间部分" class="headerlink" title="2. 表名中间部分"></a>2. 表名中间部分</h2><p>紧跟着 ACT_ 或者 FLW_ 后面的内容，基本上也都是简称，例如：</p><ul><li>APP 表示这都是跟应用程序相关的表。</li><li>CMMN 表示这都是跟 CMMN 协议相关的表。</li><li>CO（CONTENT）表示这都是跟内容引擎相关的表。</li><li>DMN 表示这都是跟 DMN 协议相关的表。</li><li>EVT（EVENT）表示这都是跟事件相关的表。</li><li>FO（FORM）表示这都是跟表单相关的表。</li><li>GE（GENERAL）表示这都是通用表，适用于各种用例的。</li><li>HI（HISTORY）这些是包含历史数据的表。当从运行时表中删除数据时，历史表仍然包含这些已完成实例的所有信息。</li><li>ID（IDENTITY）表示这都是跟用户身份认证相关的表。</li><li>PROCDEF（PROCESSDEFINE） 表示这都是跟记录流程定义相关的表。</li><li>RE（REPOSITORY）表示这都是跟流程的定义、流程的资源等等包含了静态信息相关的表。</li><li>RU（RUNTIME）代表运行时，这些是包含尚未完成的流程、案例等的运行时数据的运行时表。Flowable 仅在执行期间存储运行时数据，并在实例结束后删除记录，这使运行时表保持小而快。</li><li>CHANNEL 表示这都是跟泳道相关的表。</li><li>EV 表示这个是跟 FLW_ 搭配的，在这里似乎并没有一个明确的含义，相关的表也都是跟 Liquibase 相关的表。</li><li>EVENT 表示这都是跟事件相关的表。</li></ul><p>把这些简称的单词搞明白了，接下来的就容易看懂每一个表的含义了。</p><p>表名是由三部分构成的，我们现在已经分析了前两部分了，接下来我们来看第三部分。</p><h2 id="3-表名后缀"><a href="#3-表名后缀" class="headerlink" title="3. 表名后缀"></a>3. 表名后缀</h2><p>表名的后缀，有一些是通用的后缀名词，我们先来看下。</p><ul><li>DATABASECHANGELOG：表名中包含这个单词的，表示这个表是 Liquibase 执行的记录，Liquibase 是一个数据库脚本管理的工具，有点像 flyway，松哥之前写过 flyway 的文章，我这里就不啰嗦了。包含 DATABASECHANGELOG 后缀的表一共是 6 张。</li><li>DATABASECHANGELOGLOCK：表名中包含这个单词的，表示这个表记录 Liquibase 执行锁的，用以确保一次只运行一个 Liquibase 实例，包含 DATABASECHANGELOGLOCK 后缀的表也是 6 张。</li></ul><p>这两个加起来就 12 张表了，一共 79 张，现在还剩 67 张，我们来详细看下。</p><blockquote><p>在后面的介绍中，凡是涉及到 DATABASECHANGELOG 和 DATABASECHANGELOGLOCK 的表，我就直接省略了。</p></blockquote><h3 id="3-1-ACT-APP"><a href="#3-1-ACT-APP" class="headerlink" title="3.1 ACT_APP_*"></a>3.1 ACT_APP_*</h3><p>以 <code>ACT_APP_*</code> 开头的表负责应用引擎存储和应用部署定义。相关的表一共是五张，如下：</p><p><img src="http://img.itboyhub.com/2022/08/20220904144147.png" alt></p><p><strong>ACT_APP_APPDEF</strong></p><p>应用程序模型产生应用程序定义。此定义，如流程/案例/等。是成功部署到应用引擎的应用模型的表示。</p><p><strong>ACT_APP_DEPLOYMENT</strong></p><p>当通过应用引擎部署应用模型时，会存储一条记录以保存此部署。部署的实际内容被存储在 ACT_APP_DEPLOYMENT_RESOURCE 表中，并从该表中引用。</p><p><strong>ACT_APP_DEPLOYMENT_RESOURCE</strong></p><p>此表包含构成应用程序部署的实际资源（存储为字节）。当引擎需要实际模型时，将从该表中获取资源。</p><h3 id="3-2-ACT-CMMN"><a href="#3-2-ACT-CMMN" class="headerlink" title="3.2 ACT_CMMN_*"></a>3.2 ACT_CMMN_*</h3><p>Flowable CMMN Engine 的数据库名称都以 <code>ACT_CMMN_</code> 开头。这里涉及到一个东西就是 CMMN，CMMN 与 BPMN 协议一致，也是一种流程内容的规范，CMMN 这类表一般用于存储处理 BPMN 所不能适用的业务场景数据，CMMN 通常与 BPMN 搭配使用，不过只有符合 CMMN 规范的模型数据才会使用这类表。</p><p>这里涉及到的相关表一共是 12 张，如下：</p><p><img src="http://img.itboyhub.com/2022/08/20220904144810.png" alt></p><ul><li><strong>ACT_CMMN_CASEDEF</strong></li><li><strong>ACT_CMMN_DEPLOYMENT</strong></li><li><strong>ACT_CMMN_DEPLOYMENT_RESOURCE</strong></li></ul><p>这三个都是没有附加前缀的表，主要定义了静态信息，例如 case 的定义和部署和以及相关的资源等。</p><p>接下来这些以 <code>ACT_CMMN_HI_</code> 开头的表代表历史数据，例如过去的案例实例、计划项目等。</p><p><strong>ACT_CMMN_HI_CASE_INST</strong></p><p>此表记录由 CMMN 引擎启动的每个案例实例的数据。</p><p><strong>ACT_CMMN_HI_MIL_INST</strong></p><p>此表记录了在案例实例中达到的每个里程碑的数据。</p><p><strong>ACT_CMMN_HI_PLAN_ITEM_INST</strong></p><p>此表记录了作为案例实例执行的一部分创建的每个计划项实例的数据。</p><p>接下来以 <code>ACT_CMMN_RU_</code> 开始的表代表运行时的数据，这些数据包含案例实例、计划项等的运行时数据。Flowable 仅在案例实例执行期间存储运行时数据，并在案例实例结束时删除记录，这使运行时表保持小且查询速度快。</p><p><strong>ACT_CMMN_RU_CASE_INST</strong></p><p>此表包含每个已启动但尚未完成的案例实例的条目。</p><p><strong>ACT_CMMN_RU_MIL_INST</strong></p><p>此表包含作为运行案例实例的一部分达到的每个里程碑的条目。</p><p><strong>ACT_CMMN_RU_PLAN_ITEM_INST</strong></p><p>案例实例执行由案例定义中定义的计划项的多个实例组成，此表包含在案例实例执行期间创建的每个实例的条目。</p><p><strong>ACT_CMMN_RU_SENTRY_PART_INST</strong></p><p>计划项目实例可以有守卫状态转换的哨兵，这样的哨兵在状态改变之前可以包含多个部分，这个表就是专门用来存储这种哨兵。</p><h3 id="3-3-ACT-DMN"><a href="#3-3-ACT-DMN" class="headerlink" title="3.3 ACT_DMN_*"></a>3.3 ACT_DMN_*</h3><p>Flowable DMN 的数据库名称都以 <code>ACT_DMN_</code> 开头，这里涉及到的表一共是 6 张：</p><p><img src="http://img.itboyhub.com/2022/08/20220904151320.png" alt></p><ul><li><strong>ACT_DMN_DEPLOYMENT</strong></li><li><strong>ACT_DMN_DEPLOYMENT_RESOURCE</strong></li></ul><p>这两个是就不需要我多说了吧，跟前面的都一样，只不过这里部署的是 DMN。</p><p><strong>ACT_DMN_DECISION</strong></p><p>此表包含已部署决策表的元数据，并与来自其他引擎的定义相对应。</p><p><strong>ACT_DMN_HI_DECISION_EXECUTION</strong></p><p>此表包含有关 DMN 决策表执行的审计信息。</p><h3 id="3-4-ACT-RU"><a href="#3-4-ACT-RU" class="headerlink" title="3.4 ACT_RU_*"></a>3.4 ACT_RU_*</h3><p>以 <code>ACT_RU_</code> 开头的表都是和流程引擎运行时信息相关的一些表。涉及到的表一共有 13 张：</p><p><img src="http://img.itboyhub.com/2022/08/20220904152024.png" alt><br><img src="http://img.itboyhub.com/2022/08/20220904152039.png" alt></p><p><strong>ACT_RU_ACTINST</strong></p><p>流程实例中的每个活动在此表中都有一行来指示活动的当前状态。</p><ul><li><strong>ACT_RU_JOB</strong></li><li><strong>ACT_RU_TIMER_JOB</strong></li><li><strong>ACT_RU_SUSPENDED_JOB</strong></li><li><strong>ACT_RU_EXTERNAL_JOB</strong></li><li><strong>ACT_RU_HISTORY_JOB</strong></li><li><strong>ACT_RU_DEADLETTER_JOB</strong></li></ul><p>Flowable 引擎使用作业表来实现异步逻辑、计时器或历史处理。这些表存储每个作业所需的数据。</p><p><strong>ACT_RU_ENTITYLINK</strong></p><p>此表存储有关实例的父子关系的信息。例如，如果流程实例启动子案例实例，则此关系存储在此表中。这样可以轻松查询关系。</p><p><strong>ACT_RU_EVENT_SUBSCR</strong></p><p>当流程定义使用事件（信号/消息/等或启动/中间/边界）时，引擎将对该表的引用存储在该表中。这简化了查询哪些实例正在等待某种类型的事件。</p><p><strong>ACT_RU_EXECUTION</strong></p><p>存储流程实例和指向流程实例当前状态的指针（称为执行）。</p><p><strong>ACT_RU_IDENTITYLINK</strong></p><p>此表存储有关用户或组的数据及其与（流程/案例/等）实例相关的角色。该表也被其他需要身份链接的引擎使用。</p><p><strong>ACT_RU_TASK</strong></p><p>此表包含正在运行的实例的每个未完成用户任务的条目。然后在查询用户的任务列表时使用此表。CMMN 引擎也使用此表。</p><p><strong>ACT_RU_VARIABLE</strong></p><p>此表存储与实例相关的变量。 CMMN 引擎也使用此表。</p><h3 id="3-5-ACT-HI"><a href="#3-5-ACT-HI" class="headerlink" title="3.5 ACT_HI_*"></a>3.5 ACT_HI_*</h3><p>以 <code>ACT_HI_*</code> 开头的表包含正在运行和已完成的实例的历史数据，这些表的名称遵循其运行时对应的名称，这里一共涉及到 10 张表：</p><p><img src="http://img.itboyhub.com/2022/08/20220904153147.png" alt></p><p><strong>ACT_HI_ACTINST</strong></p><p>历史活动信息。这里记录流程流转过的所有节点，与 ACT_HI_TASKINST 不同的是， ACT_HI_TASKINST 只记录 Task 内容。</p><p><strong>ACT_HI_ATTACHMENT</strong></p><p>历史附件表。</p><p><strong>ACT_HI_COMMENT</strong></p><p>流程的历史评论表。</p><p><strong>ACT_HI_DETAIL</strong></p><p>历史详情表：流程中产生的变量详细，包括控制流程流转的变量，业务表单中填写的流程需要用到的变量等。</p><p><strong>ACT_HI_ENTITYLINK</strong></p><p>历史参与的人员表。</p><p><strong>ACT_HI_IDENTITYLINK</strong></p><p>任务参与者数据表，主要存储历史节点参与者的信息，可能是 Group 也可能是 User。</p><p><strong>ACT_HI_PROCINST</strong></p><p>保存每一个历史流程，创建时就生成，一条流程实例对应一个记录。</p><p><strong>ACT_HI_TASKINST</strong></p><p>记录每一个历史节点，一个 Task 对应一个记录。</p><p><strong>ACT_HI_TSK_LOG</strong></p><p>每一次执行可能会带上数据，存在这里。</p><p><strong>ACT_HI_VARINST</strong></p><p>流程历史变量表。</p><h3 id="3-6-ACT-ID"><a href="#3-6-ACT-ID" class="headerlink" title="3.6 ACT_ID_*"></a>3.6 ACT_ID_*</h3><p>以 <code>ACT_ID_*</code> 开头的都是和用户身份相关的表，一共是有 9 张表：</p><p><strong>ACT_ID_BYTEARRAY</strong></p><p>这是用户组的部署内容。</p><p><strong>ACT_ID_GROUP</strong></p><p>这是用户组的表。</p><p><strong>ACT_ID_INFO</strong></p><p>这是所有的用户的信息，账号密码。</p><p><strong>ACT_ID_MEMBERSHIP</strong></p><p>用户和用户组的关联表。</p><p><strong>ACT_ID_PRIV</strong></p><p>权限表。</p><p><strong>ACT_ID_PRIV_MAPPING</strong></p><p>用户、用户组以及权限之间的关联表。</p><p><strong>ACT_ID_PROPERTY</strong></p><p>用户的变量表。</p><p><strong>ACT_ID_TOKEN</strong></p><p>用户访问记录表。</p><p><strong>ACT_ID_USER</strong></p><p>用户表。</p><h3 id="3-7-ACT-FO-FORM"><a href="#3-7-ACT-FO-FORM" class="headerlink" title="3.7 ACT_FO_FORM_*"></a>3.7 ACT_FO_FORM_*</h3><p>以 <code>ACT_FO_FORM_</code> 开头的表存储表单引擎和围绕表单模型和这些表单的实例数据。</p><p><strong>ACT_FO_FORM_DEFINITION</strong></p><p>表单定义表。</p><p><strong>ACT_FO_FORM_DEPLOYMENT</strong></p><p>表单部署表。</p><p><strong>ACT_FO_FORM_INSTANCE</strong></p><p>表单实例表。</p><p><strong>ACT_FO_FORM_RESOURCE</strong></p><p>表单源数据表。</p><h3 id="3-8-ACT-GE"><a href="#3-8-ACT-GE" class="headerlink" title="3.8 ACT_GE_*"></a>3.8 ACT_GE_*</h3><p>以 <code>ACT_GE_</code> 开头的表表示一些通用信息表，涉及到的表一共是两个。</p><p><img src="http://img.itboyhub.com/2022/08/20220904155450.png" alt></p><p><strong>ACT_GE_BYTEARRAY</strong></p><p>存储每个流程的部署记录，bytes_ 字段中保存流程的具体内容。</p><p><strong>ACT_GE_PROPERTY</strong></p><p>存储 Flowable 自身的一些变量，主要是版本号。</p><h3 id="3-9-ACT-RE"><a href="#3-9-ACT-RE" class="headerlink" title="3.9 ACT_RE_*"></a>3.9 ACT_RE_*</h3><p>以 <code>ACT_RE_</code> 开头的表表示这些表都是跟流程的定义、流程的资源等等包含了静态信息相关的表。</p><p><strong>ACT_RE_DEPLOYMENT</strong></p><p>流程部署记录，每次服务重启会部署一次，这里会新增一条记录。</p><p><strong>ACT_RE_MODEL</strong></p><p>创建模型时，额外定义的一些模型相关信息，存在这张表，默认不保存。</p><p><strong>ACT_RE_PROCDEF</strong></p><p>记录流程的变更，流程每变更一次存一条记录，version_ 字段加 1。</p><h3 id="3-10-FLW-EVENT"><a href="#3-10-FLW-EVENT" class="headerlink" title="3.10 FLW_EVENT_*"></a>3.10 FLW_EVENT_*</h3><p><strong>FLW_EVENT_DEFINITION</strong></p><p>已部署事件定义的元数据。</p><p><strong>FLW_EVENT_DEPLOYMENT</strong></p><p>已部署事件部署元数据。</p><p><strong>FLW_EVENT_RESOURCE</strong></p><p>事件所需资源。</p><h3 id="3-11-其他表"><a href="#3-11-其他表" class="headerlink" title="3.11 其他表"></a>3.11 其他表</h3><p>还剩一些规则不太明显的表，如下：</p><p><strong>FLW_RU_BATCH</strong><br><strong>FLW_RU_BATCH_PART</strong></p><p>这两个是批量迁移流程时使用。</p><p><strong>ACT_PROCDEF_INFO</strong></p><p>流程定义信息，对流程的说明。</p><p><strong>ACT_CO_CONTENT_ITEM</strong></p><p>每项内容在此表中都有个条目。</p><p><strong>ACT_EVT_LOG</strong></p><p>Flowable 引入了事件日志机制，默认会在数据库中创建 <code>ACT_EVT_LOG</code> 表保存事件日志，如果不使用事件日志，则可以删除这个表。</p><p><strong>FLW_CHANNEL_DEFINITION</strong></p><p>泳池管道定义表。</p><p>好啦，Flowable 中的表结构就和小伙伴们介绍完毕啦～大家可以收藏本文，在需要的时候作为一个参考～</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;[TOC]&lt;/p&gt;
&lt;p&gt;当我们使用 Flowable 流程引擎的时候，虽然我们使用的是各种 API，但是小伙伴们都知道，这些 API 本质上操作的都是底层的数据表，Flowable 默认一共生成了 79 张数据表，了解这些数据表，有助于我们更好的理解 Flowable 中的各种 API，因此今天松哥就来和大家捋一捋 Flowable 中的数据表都有哪些，以及这些表都是干嘛用的。&lt;/p&gt;
    
    </summary>
    
      <category term="TienChin" scheme="http://www.javaboy.org/categories/TienChin/"/>
    
    
      <category term="TienChin" scheme="http://www.javaboy.org/tags/TienChin/"/>
    
      <category term="Flowable" scheme="http://www.javaboy.org/tags/Flowable/"/>
    
  </entry>
  
  <entry>
    <title>SpringBoot+Vue 送十本！</title>
    <link href="http://www.javaboy.org/2022/0906/springboot-vue.html"/>
    <id>http://www.javaboy.org/2022/0906/springboot-vue.html</id>
    <published>2022-09-06T12:09:46.000Z</published>
    <updated>2022-12-19T12:19:00.109Z</updated>
    
    <content type="html"><![CDATA[<p>虽然我知道这本书松哥的大部分读者可能都有了，但是受出版社编辑老师委托，还是再做一次 《Spring Boot + Vue 全栈开发实战》的送书活动，<strong>已经精通 Spring Boot 的小伙伴请忽略～</strong></p><a id="more"></a><p><img src="http://img.itboyhub.com/2022/08/20220905233431.png" alt></p><p>这次送书是出版社直接寄出，所以不是签名书。</p><p>Spring Boot2 最早是在 2018 年 2 月 28 日发布了第一个版本，到今天为止，时间已经过去了四年了，Spring Boot2.x 的最新版本是 2.7.3 这个版本，四年时间，Spring Boot 一共发布了大大小小 95 个版本。</p><p>松哥因为工作的关系，几乎每一个 Spring Boot 版本都有体验过，所以即使一些细微的变化也都能及时感知到，不过我一般不玩快照版，只玩 release 版本。</p><p>根据官方的说法，将在今年 11 月份发布 Spring Boot3 的第一个 release 版本，在经过漫长的四年之后，Spring Boot 也终于将迈入 3.0 的时代了。</p><p>Spring Boot3 将基于 Spring Framework6.0，并且需要 Java17 或更高版本才能运行。对于 Java 快速增长的版本号，很多人的态度是你发任你发，我用 Java8。不过在一众主流的框架/工具都将支持的 Java 版本不断推高的时候，其实我们也该考虑一下，是不是该换一个更高的 Java 版本玩一下了～特别再过一个月，连 Spring Boot 都说要 Java17 了。</p><p>另外，Spring Boot3 也将是第一个使用 <code>Jakarta EE 9 API (jakarta.*)</code> 而不是 <code>JavaEE 8 (javax.*)</code> 的 Spring Boot 版本。</p><p>在 Spring Boot3 中，默认将采用 SpringMVC 最新提供的 PathPatternParser 来处理路径解析，以前老的方式是使用 AntPathMatcher。关于 PathPatternParser，其实松哥在一年前就已经写过文章和大家介绍了<a href="https://mp.weixin.qq.com/s/-7mUZVCdupha6sEvZQ6LyQ" target="_blank" rel="noopener">Spring5 里边的新玩法！这种 URL 请求让我涨见识了！</a>。</p><p>当然了，Spring Boot3 还会有一些其他的玩法，这个等将来发布了松哥再和大家细聊，反正现在已经九月份了，十一月也很快了～</p><p>呀，扯远了。</p><p>如果你已经精通 Spring Boot2 了，那么我并不推荐《Spring Boot + Vue 全栈开发实战》这本书，如果你有 SSM 基础，但是尚不熟悉 Spring Boot，那么不妨看看《Spring Boot + Vue 全栈开发实战》，相信一定会有收获。</p><p>好啦，最后，十本《Spring Boot + Vue 全栈开发实战》送给大家！小伙伴们留言<strong>说说你为什么选择了 Java 这条路</strong>，松哥会从留言的小伙伴中选出来十位小伙伴，《Spring Boot + Vue 全栈开发实战》包邮到家（书由出版社直接寄出，所以不是签名版）！</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;虽然我知道这本书松哥的大部分读者可能都有了，但是受出版社编辑老师委托，还是再做一次 《Spring Boot + Vue 全栈开发实战》的送书活动，&lt;strong&gt;已经精通 Spring Boot 的小伙伴请忽略～&lt;/strong&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="TienChin" scheme="http://www.javaboy.org/categories/TienChin/"/>
    
    
      <category term="TienChin" scheme="http://www.javaboy.org/tags/TienChin/"/>
    
      <category term="Flowable" scheme="http://www.javaboy.org/tags/Flowable/"/>
    
  </entry>
  
  <entry>
    <title>种草两个可以画 flowable 流程图的 Vue 库！</title>
    <link href="http://www.javaboy.org/2022/0905/vue-flowable.html"/>
    <id>http://www.javaboy.org/2022/0905/vue-flowable.html</id>
    <published>2022-09-05T12:09:29.000Z</published>
    <updated>2022-12-19T12:18:49.946Z</updated>
    
    <content type="html"><![CDATA[<p>之前松哥发了一篇文章和小伙伴们介绍了前端的 bpmn.js 这个库，利用这个库我们可以自己将绘制流程图的功能嵌入到我们的项目中。</p><a id="more"></a><p>然而，这个库默认是给 Camunda 设计的，所以画出来的流程图导出来的 XML 文件无法直接使用，必须要做一些深度定制，才能将 XML 文件转为 Flowable 流程引擎可用的 XML 文件。这个深度定制太太太麻烦了。</p><p>所以我就在想前端有没有现成的库，可以直接用来绘制 Flowable 流程图的？找来找去，找到了两个，这两个的相似度还蛮高的，不过这两个都有一个问题，那就是都是基于 Vue2 开发的，在 Vue3 中用不了，算了，作为一个工具，Vue2 就 Vue2 吧，忍了。毕竟我也不是专业的前端工程师，掌握的前端技能能满足我后端的需求也就足够了，要是专业的前端工程师，我肯定把 bpmn.js+Vue3 整的明明白白了。</p><p>好啦，接下来就不废话了，跟小伙伴们介绍一下这两个可以绘制 Flowable 流程图的前端库。</p><h2 id="workflow-bpmn-modeler"><a href="#workflow-bpmn-modeler" class="headerlink" title="workflow-bpmn-modeler"></a>workflow-bpmn-modeler</h2><p>workflow-bpmn-modeler 基于 Vue 和 <a href="mailto:bpmn.io@7.0" target="_blank" rel="noopener">bpmn.io@7.0</a>，实现了 flowable 的工作流设计器。使用这个流程绘制工具，建议采用 flowable6.4.1 版本，flowable6.4.2 版本开始进行商业化重构，为了方便刨码学习，推荐使用 flowable6.4.1 版本。</p><p>这个用法其实很简单，首先我们创建一个 Vue2 的项目，注意 Vue 的版本不要选错了，项目创建好之后，添加 workflow-bpmn-modeler 依赖，执行如下任意命令添加：</p><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i workflow-bpmn-modeler</span><br></pre></td></tr></table></figure><p>或者：</p><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn add workflow-bpmn-modeler</span><br></pre></td></tr></table></figure><p>添加完成后，package.json 内容如下：</p><figure class="highlight json hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="hljs-attr">"name"</span>: <span class="hljs-string">"bpmn_demo02"</span>,</span><br><span class="line">  <span class="hljs-attr">"version"</span>: <span class="hljs-string">"0.1.0"</span>,</span><br><span class="line">  <span class="hljs-attr">"private"</span>: <span class="hljs-literal">true</span>,</span><br><span class="line">  <span class="hljs-attr">"scripts"</span>: &#123;</span><br><span class="line">    <span class="hljs-attr">"serve"</span>: <span class="hljs-string">"vue-cli-service serve"</span>,</span><br><span class="line">    <span class="hljs-attr">"build"</span>: <span class="hljs-string">"vue-cli-service build"</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="hljs-attr">"dependencies"</span>: &#123;</span><br><span class="line">    <span class="hljs-attr">"core-js"</span>: <span class="hljs-string">"^3.8.3"</span>,</span><br><span class="line">    <span class="hljs-attr">"element-ui"</span>: <span class="hljs-string">"^2.15.9"</span>,</span><br><span class="line">    <span class="hljs-attr">"vue"</span>: <span class="hljs-string">"^2.6.14"</span>,</span><br><span class="line">    <span class="hljs-attr">"vue-router"</span>: <span class="hljs-string">"^3.5.1"</span>,</span><br><span class="line">    <span class="hljs-attr">"workflow-bpmn-modeler"</span>: <span class="hljs-string">"^0.2.8"</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="hljs-attr">"devDependencies"</span>: &#123;</span><br><span class="line">    <span class="hljs-attr">"@vue/cli-plugin-babel"</span>: <span class="hljs-string">"~5.0.0"</span>,</span><br><span class="line">    <span class="hljs-attr">"@vue/cli-plugin-router"</span>: <span class="hljs-string">"~5.0.0"</span>,</span><br><span class="line">    <span class="hljs-attr">"@vue/cli-service"</span>: <span class="hljs-string">"~5.0.0"</span>,</span><br><span class="line">    <span class="hljs-attr">"vue-template-compiler"</span>: <span class="hljs-string">"^2.6.14"</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>注意看版本号。</strong></p><p>接下来我们就可以在一个 .vue 文件中使用这个组件了，代码如下：</p><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">    &lt;bpmn-modeler</span><br><span class="line">            ref=&quot;refNode&quot;</span><br><span class="line">            :xml=&quot;xml&quot;</span><br><span class="line">            :users=&quot;users&quot;</span><br><span class="line">            :groups=&quot;groups&quot;</span><br><span class="line">            :categorys=&quot;categorys&quot;</span><br><span class="line">            :is-view=&quot;false&quot;</span><br><span class="line">            @save=&quot;save&quot;</span><br><span class="line">    /&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">  import bpmnModeler from &quot;workflow-bpmn-modeler&quot;;</span><br><span class="line"></span><br><span class="line">  export default &#123;</span><br><span class="line">    components: &#123;</span><br><span class="line">      bpmnModeler,</span><br><span class="line">    &#125;,</span><br><span class="line">    data() &#123;</span><br><span class="line">      return &#123;</span><br><span class="line">        xml: &quot;&quot;, // 后端查询到的xml</span><br><span class="line">        users: [</span><br><span class="line">          &#123; name: &quot;javaboy&quot;, id: 1 &#125;,</span><br><span class="line">          &#123; name: &quot;itboyhub&quot;, id: 2 &#125;,</span><br><span class="line">          &#123; name: &quot;江南一点雨&quot;, id: 3 &#125;,</span><br><span class="line">        ],</span><br><span class="line">        groups: [</span><br><span class="line">          &#123; name: &quot;经理&quot;, id: 4 &#125;,</span><br><span class="line">          &#123; name: &quot;组长&quot;, id: 5 &#125;,</span><br><span class="line">          &#123; name: &quot;员工&quot;, id: 6 &#125;,</span><br><span class="line">        ],</span><br><span class="line">        categorys: [</span><br><span class="line">          &#123; name: &quot;OA&quot;, id: &quot;oa&quot; &#125;,</span><br><span class="line">          &#123; name: &quot;财务&quot;, id: &quot;finance&quot; &#125;,</span><br><span class="line">        ],</span><br><span class="line">      &#125;;</span><br><span class="line">    &#125;,</span><br><span class="line">    methods: &#123;</span><br><span class="line">      getModelDetail() &#123;</span><br><span class="line">        // 发送请求，获取xml</span><br><span class="line">        // this.xml = response.xml</span><br><span class="line">      &#125;,</span><br><span class="line">      save(data) &#123;</span><br><span class="line">        console.log(data);  // &#123; process: &#123;...&#125;, xml: &apos;...&apos;, svg: &apos;...&apos; &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure><p>我们来分析一下这段代码：</p><ol><li>首先从 workflow-bpmn-modeler 中导入 bpmnModeler。</li><li>注册 bpmnModeler 组件。</li><li>在页面中直接使用 bpmnModeler 组件，使用该组件时候，有五个属性一个方法，我们挨个来说：<ol><li>xml：这个属性是 bpmnModeler 要展示的流程图的 XML 字符串，我们可以提前给一个流程图的 XML 字符串，这样 bpmnModeler 组件就会将这个 XML 字符串所对应的流程图给画出来，如果我们只是单纯的想自己绘制流程图，那么这个可以不用管，给一个空字符串就行了。</li><li>users：这是一个数组，当我们配置 UserTask 的时候，可以设置这个 UserTask 由谁来处理，users 配置的就是这里用到的用户。</li><li>groups：这个类似于 users，也是在 UserTask 中，如果我们想要配置一个 UserTask 的候选组的话，那么就会用到 groups 中的内容。</li><li>categorys：这个属性亲测没有任何功能，源代码我也看了，源代码中也没有用这个属性，这完全就是一个没有用的属性，可忽略之。</li><li>is-view：这个表示当前 bpmnModeler 是要画流程图还是单纯的只是将流程图展示出来，false 表示我们是用 bpmnModeler 画流程图的，如果设置为 true，就表示 bpmnModeler 只是用来展示流程图（提前准备好流程图的 XML 文件，可以用 bpmnModeler 将之展示出来）。</li><li>@save：这个是点击网页上的保存模型按钮的时候，会触发的一个回调函数。</li></ol></li></ol><p>好啦，这就可以了。</p><p>接下来，我们启动 Vue 项目，就可以看到这个流程图绘制页面了：</p><p><img src="http://img.itboyhub.com/2022/08/20220831202505.png" alt></p><p>现在就可以愉快的画流程图了～</p><p>接下来，松哥就用这个，手把手教大家画一下之前文章中和大家用的请假流程图，当时的流程图是这样的：</p><p><img src="http://img.itboyhub.com/2021/10/tran/20220808211237.png" alt></p><p>我们来看下如何绘制：</p><ol><li>首先我们先来定义一下流程的基本信息：</li></ol><p><img src="http://img.itboyhub.com/2022/08/20220831203259.png" alt></p><ol start="2"><li>接下来绘制经理批准还是拒绝流程：</li></ol><p>点击这个扳手按钮可以设置任务类型：</p><p><img src="http://img.itboyhub.com/2022/08/20220831203417.png" alt></p><p>为这个任务设置一个监听器：</p><p><img src="http://img.itboyhub.com/2022/08/20220831203654.png" alt></p><blockquote><p>设置监听器的原因是因为前端用户在提交请假申请的时候，选择审批人可以直接选择审批人，也可以选择审批人的身份（例如经理），这两种选择都是被允许的。所以我们就添加一个任务监听器，当流程执行到这个 Task 的时候，我们就在任务监听器中，根据前端传来的参数去设置这个任务是由候选人处理还是候选用户组处理。</p></blockquote><ol start="3"><li>添加互斥网关：</li></ol><p><img src="http://img.itboyhub.com/2022/08/20220831204433.png" alt></p><ol start="4"><li>审批通过线</li></ol><p>接下来，先是审批通过，审批通过的条件是 approved 字段为 true 就表示审批通过：</p><p><img src="http://img.itboyhub.com/2022/08/20220831204918.png" alt></p><ol start="5"><li>审批通过发送通知</li></ol><p>审批通过后，给用户发送一个通知，这是一个服务任务，发送通知的类是我们自己写的，所以也需要配置一下自定义类的位置：</p><p><img src="http://img.itboyhub.com/2022/08/20220831205114.png" alt></p><ol start="6"><li>结束</li></ol><p>最后进入到审批通过 UserTask 并且结束：</p><p><img src="http://img.itboyhub.com/2022/08/20220831213436.png" alt></p><p><img src="http://img.itboyhub.com/2022/08/20220831205627.png" alt></p><ol start="7"><li>绘制拒绝线</li></ol><p>按照如上流程，继续绘制请假被拒绝的流程：</p><p><img src="http://img.itboyhub.com/2022/08/20220831205748.png" alt></p><h2 id="muheflow-bpmn-modeler"><a href="#muheflow-bpmn-modeler" class="headerlink" title="muheflow-bpmn-modeler"></a>muheflow-bpmn-modeler</h2><p>松哥要和大家介绍的第二个工具就是 muheflow-bpmn-modeler，这个基于 Vue 和 <a href="mailto:bpmn.io@8.0" target="_blank" rel="noopener">bpmn.io@8.0</a>，实现了 flowable 的工作流设计器。使用这个流程绘制工具，建议采用 flowable6.4.1 版本，flowable6.4.2 版本开始进行商业化重构，为了方便刨码学习，推荐使用 flowable6.4.1 版本。</p><p>没找到这个的源代码，但是我发现这个的用法和 workflow-bpmn-modeler 的用法毫无差别～所以我就不废话了，照着上面的用这个就行了。</p><p>感兴趣的小伙伴不妨试试～公众号江南一点雨后台回复 bpmn_demo02 可以下载本文案例～</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;之前松哥发了一篇文章和小伙伴们介绍了前端的 bpmn.js 这个库，利用这个库我们可以自己将绘制流程图的功能嵌入到我们的项目中。&lt;/p&gt;
    
    </summary>
    
      <category term="TienChin" scheme="http://www.javaboy.org/categories/TienChin/"/>
    
    
      <category term="TienChin" scheme="http://www.javaboy.org/tags/TienChin/"/>
    
      <category term="Flowable" scheme="http://www.javaboy.org/tags/Flowable/"/>
    
  </entry>
  
  <entry>
    <title>八月最后一天，给小伙伴们汇报下 TienChin 项目视频进度</title>
    <link href="http://www.javaboy.org/2022/0831/flowable-video.html"/>
    <id>http://www.javaboy.org/2022/0831/flowable-video.html</id>
    <published>2022-08-31T12:09:09.000Z</published>
    <updated>2022-12-19T12:18:40.733Z</updated>
    
    <content type="html"><![CDATA[<p>距离上次跟小伙伴们汇报 TienChin 项目视频进度已经过去一个月啦，今天是 7 月 31 号，再来汇报一下这个月视频的进展。</p><a id="more"></a><p>其实也没啥好说的，直接上目录吧！</p><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br></pre></td><td class="code"><pre><span class="line">├── 000.开篇.mp4</span><br><span class="line">├── 001.运行RuoYi-Vue.mp4</span><br><span class="line">├── 002.代码格式化.mp4</span><br><span class="line">├── 003.项目结构大改造.mp4</span><br><span class="line">├── 004.项目改造完善.mp4</span><br><span class="line">├── 005.项目结构分析.mp4</span><br><span class="line">├── 006.验证码响应结果分析.mp4</span><br><span class="line">├── 007.验证码生成接口分析.mp4</span><br><span class="line">├── 008.验证码配置分析.mp4</span><br><span class="line">├── 009.验证码的校验.mp4</span><br><span class="line">├── 010.登录流程分析.mp4</span><br><span class="line">├── 011.登录JWT校验.mp4</span><br><span class="line">├── 012.SpringSecurity登录配置分析.mp4</span><br><span class="line">├── 013.自定义多数据源思路分析.mp4</span><br><span class="line">├── 014.自定义多数据源-1.mp4</span><br><span class="line">├── 015.自定义多数据源-2.mp4</span><br><span class="line">├── 016.手动实现网页上切换数据源.mp4</span><br><span class="line">├── 017.RateLimiter注解简介.mp4</span><br><span class="line">├── 018.自定义限流注解-1.mp4</span><br><span class="line">├── 019.自定义限流注解-2.mp4</span><br><span class="line">├── 020.RuoYi脚手架限流注解分析.mp4</span><br><span class="line">├── 021.幂等性实现的6中思路梳理.mp4</span><br><span class="line">├── 022.实现JSON格式参数多次读取.mp4</span><br><span class="line">├── 023.防止请求重复提交.mp4</span><br><span class="line">├── 024.防止接口重复提交注解分析.mp4</span><br><span class="line">├── 025.数据权限注解介绍.mp4</span><br><span class="line">├── 026.数据权限案例准备工作.mp4</span><br><span class="line">├── 027.权限注解实现思路分析.mp4</span><br><span class="line">├── 028.自定义数据权限注解@DataScope.mp4</span><br><span class="line">├── 029.数据权限过滤角色数据.mp4</span><br><span class="line">├── 030.数据权限过滤用户数据.mp4</span><br><span class="line">├── 031.数据权限注解总结.mp4</span><br><span class="line">├── 032.操作日志记录.mp4</span><br><span class="line">├── 033.修改日志方法名称.mp4</span><br><span class="line">├── 034.理解Aware接口.mp4</span><br><span class="line">├── 035.自定义注解+AOP整理.mp4</span><br><span class="line">├── 036.TienChin细化到按钮的权限实现思路.mp4</span><br><span class="line">├── 037.理解TienChin项目中的权限注解.mp4</span><br><span class="line">├── 038.角色和权限概念梳理.mp4</span><br><span class="line">├── 039.Spring Security中角色和权限的区别.mp4</span><br><span class="line">├── 040.SpringSecurity中的权限处理逻辑.mp4</span><br><span class="line">├── 041.SpringSecurity中使用权限通配符.mp4</span><br><span class="line">├── 042.SpringSecurity另一种权限判断方式.mp4</span><br><span class="line">├── 043.自定义权限表达式.mp4</span><br><span class="line">├── 044.使用POSTMAN测试项目接口.mp4</span><br><span class="line">├── 045.自定义TienChin项目权限判断表达式.mp4</span><br><span class="line">├── 046.登录鉴权流程梳理.mp4</span><br><span class="line">├── 047.运行RuoYi-Vue3.mp4</span><br><span class="line">├── 048.动态菜单实现思路.mp4</span><br><span class="line">├── 049.动态菜单JSON分析.mp4</span><br><span class="line">├── 050.动态菜单的path问题.mp4</span><br><span class="line">├── 051.服务端查询当前登录用户菜单.mp4</span><br><span class="line">├── 052.服务端构建动态菜单.mp4</span><br><span class="line">├── 053.动态菜单实现思路梳理.mp4</span><br><span class="line">├── 054.Vue3中的动态菜单递归渲染.mp4</span><br><span class="line">├── 055.前端固定路由定义.mp4</span><br><span class="line">├── 056.前端轻量级状态管理框架Pinia.mp4</span><br><span class="line">├── 057.前端网络请求封装思路.mp4</span><br><span class="line">├── 058.前端登录请求执行流程.mp4</span><br><span class="line">├── 059.前端动态菜单加载思路.mp4</span><br><span class="line">├── 060.动态菜单为什么不能存在localStorage.mp4</span><br><span class="line">├── 061.动态菜单为什么不能存在localStorage-2.mp4</span><br><span class="line">├── 062.前端路由导航守卫源码分析.mp4</span><br><span class="line">├── 063.前端动态菜单加载四个核心变量.mp4</span><br><span class="line">├── 064.routes变量多级菜单铺平.mp4</span><br><span class="line">├── 065.component字符串转对象.mp4</span><br><span class="line">├── 066.前端多级菜单铺平.mp4</span><br><span class="line">├── 067.过滤前端本地动态路由.mp4</span><br><span class="line">├── 068.前端generateRoutes方法.mp4</span><br><span class="line">├── 069.前端回调地狱.mp4</span><br><span class="line">├── 070.Promise初体验.mp4</span><br><span class="line">├── 071.then方法的各种情况.mp4</span><br><span class="line">├── 072.Promise中的catch代码块.mp4</span><br><span class="line">├── 073.Promise中的finally代码块.mp4</span><br><span class="line">├── 074.Promise中的静态方法.mp4</span><br><span class="line">├── 075.TienChin项目Vue3中的Promise.mp4</span><br><span class="line">├── 076.Vue3中的变量定义方式.mp4</span><br><span class="line">├── 077.Vue3中方法的定义.mp4</span><br><span class="line">├── 078.Vue3中钩子函数的定义.mp4</span><br><span class="line">├── 079.Vue3中的计算属性.mp4</span><br><span class="line">├── 080.Vue3中的watch函数.mp4</span><br><span class="line">├── 081.Vue3中的ref和reactive.mp4</span><br><span class="line">├── 082.Vue3中的setup函数.mp4</span><br><span class="line">├── 083.Vue3中自定义全局方法.mp4</span><br><span class="line">├── 084.Vue3中router和store的调用.mp4</span><br><span class="line">├── 085.插件和全局方法的区别.mp4</span><br><span class="line">├── 086.在Vue3中定义一个插件.mp4</span><br><span class="line">├── 087.在插件中注册全局组件.mp4</span><br><span class="line">├── 088.在插件中自定义全局指令.mp4</span><br><span class="line">├── 089.Vue3自定义插件时传入参数.mp4</span><br><span class="line">├── 090.自定义插件中的provide和inject.mp4</span><br><span class="line">├── 091.什么是Vue中的指令.mp4</span><br><span class="line">├── 092.Vue3自定义局部指令.mp4</span><br><span class="line">├── 093.Vue3全局自定义指令.mp4</span><br><span class="line">├── 094.Vue3自定义指令同时传递两个参数.mp4</span><br><span class="line">├── 095.自定义插件传递动态参数.mp4</span><br><span class="line">├── 096.Vue3中自定义权限指令.mp4</span><br><span class="line">├── 097.Vite简介.mp4</span><br><span class="line">├── 098.创建一个基于Vite的项目.mp4</span><br><span class="line">├── 099.Vite项目安装vue-router.mp4</span><br><span class="line">├── 100.Vue3方法自动导入插件.mp4</span><br><span class="line">├── 101.Vite中省略组件后缀.mp4</span><br><span class="line">├── 102.Vue3简化组件名称配置.mp4</span><br><span class="line">├── 【号外001】.登录流程解析.mp4</span><br><span class="line">├── 【号外002】.分布式事务开篇.mp4</span><br><span class="line">├── 【号外003】.分布式事务seata三个核心概念.mp4</span><br><span class="line">├── 【号外004】.分布式事务seata四种事务模式.mp4</span><br><span class="line">├── 【号外005】.分布式事务seata中的at模式.mp4</span><br><span class="line">├── 【号外006】.分布式事务安装seata-server.mp4</span><br><span class="line">├── 【号外007】.分布式事务seata-at模式实战.mp4</span><br><span class="line">├── 【号外008】.分布式事务seata-at模式总结.mp4</span><br><span class="line">├── 【号外009】.多数据源如何处理事务问题.mp4</span><br><span class="line">├── 【号外010】.分布式事务seata-at模式补充.mp4</span><br><span class="line">├── 【号外011】.分布式事务seata-tcc模式简介.mp4</span><br><span class="line">├── 【号外012】.分布式事务seata-tcc模式实战-1.mp4</span><br><span class="line">├── 【号外013】.分布式事务seata-tcc模式实战-2.mp4</span><br><span class="line">├── 【号外014】.分布式事务seata-tcc模式实战-3.mp4</span><br><span class="line">├── 【号外015】.分布式事务seata-tcc模式实战-4.mp4</span><br><span class="line">├── 【号外016】.分布式事务seata-tcc总结.mp4</span><br><span class="line">├── 【号外017】.分布式事务seata-xa简介.mp4</span><br><span class="line">├── 【号外018】.MySQL中的XA事务实践.mp4</span><br><span class="line">├── 【号外019】.分布式事务seata-xa模式实战-1.mp4</span><br><span class="line">├── 【号外020】.分布式事务seata-xa模式实战-2.mp4</span><br><span class="line">├── 【号外021】.分布式事务总结-1.mp4</span><br><span class="line">├── 【号外022】.分布式事务总结-2.mp4</span><br><span class="line">├── 【号外023】.动态代理的两种实现方式.mp4</span><br><span class="line">└── 【号外024】.解决多数据源注解失效问题.mp4</span><br></pre></td></tr></table></figure><p><strong>目前已经录的总共是 103+24=127 集，约 31 个小时。</strong> 八月份的更新主要是讲了 Vue3 的各种玩法以及 Vite 和一些配套插件，现在这一部分的内容也基本讲完了，接下来会更一点 Flowable 流程引擎，然后就正式开始做项目了。</p><p><strong>这套视频预计更完之后内容会比较多，所以小伙伴们其实现在就可以跟着松哥慢慢敲起来了，更完再敲积累太多容易打退堂鼓。</strong></p><p>虽然我感觉自己一直在吆喝，但是还是不少小伙伴来了第一句话是“松哥又有新教程啦？”：</p><p><img src="http://img.itboyhub.com/2021/10/tran/20220731113711.png" alt></p><p>因此这里再跟大伙啰嗦一下：</p><blockquote><p>TienChin 项目是一个健身会员管理系统，基于 RuoYi-Vue 脚手架来做，使用 Spring Boot + Vue3 开发，不同于之前的 vhr 是一个脚手架，TienChin 项目的业务完成度会超过 90%。这个项目的视频教程整体上分为两大块：第一块主要是解剖 RuoYi-Vue 脚手架，让小伙伴们能够熟练掌握这个脚手架的使用，在这个过程中，我会讲许多技术点，前面列出来的视频目录都属于这一部分的内容，这个过程中我不会带领大家从头敲一边 RuoYi-Vue 脚手架，但是对项目里边的一些技术点，会有针对性的讲解，也会写一些案例来帮助大家理解这些技术点。第二块内容则主要是业务功能的完成了，业务功能涉及到的技术点主要有：SpringBoot、Vue、MyBatis Plus、MySQL、Redis、Flowable、EasyExcel、NodeJS 等。</p></blockquote><p>目前更新的视频主要出于第一阶段，不过按照目前的进度，应该很快就会进入到第二阶段。</p><p>这些视频基本上都是工作之余录制的，大部分都是早上 6-8 点之间录的，也有一些是利用周末的晚上录制的，所以是付费视频，视频定价是 399，不过目前可以 7 折上车，也就是 279，之前买过 vhr 的小伙伴可在此基础上再优惠 30，即只要 249，随着视频的录制，内容越来越多，折扣力度也会变小，这个之前买过 vhr 视频的小伙伴应该都懂，无论你何时上车，当前价格都是你在未来能够买到的最低价格啦。</p><p>录视频还是蛮辛苦的，一方面赚点小钱养家糊口，另一方面也是小伙伴们的认可在支撑着我把这件事做下去，得瑟一下：</p><p><img src="http://img.itboyhub.com/2021/10/tran/996.jpg" alt></p><p><img src="http://img.itboyhub.com/2021/10/tran/995.jpg" alt></p><p><img src="http://img.itboyhub.com/2021/10/tran/013.jpeg" alt></p><p><strong>有时候看小伙伴们发的，我真的特别动容。虽然大家看我天天写文章聊技术，其实我在生活中除了工作之外很少和人交流，真的特别想给这些爱学习会说话的小伙伴们点赞，他们肯定会混的比我好。</strong></p><hr><p>好啦，最后再统一回答大家几个关于视频的问题。</p><p><strong>Q1：视频放在哪里，怎么播放？</strong></p><p>视频放在百度网盘上，下载后使用专用播放器授权播放，专用播放器一机一码一人一码。至于小伙伴们推荐的阿里网盘等，由于空间、分享文件类型等限制，并无法用在 TienChin 项目视频分发中。</p><p><strong>Q2：视频为什么不支持在线播放？</strong></p><p>在线播放的话，一般都是和平台合作，但是国内大家所熟知的平台如慕课网、csdn 学院等，平台抽成基本都是 4 成起，松哥之前还合作了一个平台拿 6 成（也就是假如 100 块钱的课，平台拿走 60）。这样的分成比例无形中会推高课程的价格，现在我自己分发，所以才能做到<strong>低价</strong>。同时为了防止视频泄露，松哥对视频做了加密处理，这样可以确保大家不会在其他地方看到一模一样的免费视频，加密后的视频只能使用专用播放器播放，因此不支持在线播放。</p><p><strong>Q3：视频可以试看吗？</strong></p><p>其实我最近在公号发的视频，大家都可以当作试看的，反正的录视频风格是不变的。和 vhr 视频相比，现在的 TienChin 项目视频音质是杠杠滴，下面三个视频是我最近发过的，小伙伴们可以当作试看的视频：</p><p><strong>Q4：可以砍价吗？</strong></p><p>不可以，这个价格已经很便宜了，没法砍了（悄悄告诉大家，从 vhr 到 tienchin，暂时没有人砍价成功过）。</p><p><strong>Q5：视频多久更新完毕？</strong></p><p>其实如果单纯带着大家写业务功能，这个项目不会花太多时间，这样虽然大家完整的做了一个项目，但是技术却不会有太多长进，而我则希望在这个过程中多整点活，能让小伙伴们技术也有一些提升，这样内容一加，最终何时更完就不确定了。不过，有一点是可以保证的，每周至少一次，每周至少更一个半小时精品视频。</p><p><strong>Q6：知识星球是什么？</strong></p><p>星球主要是用来更新视频下载地址的地方，大家在这套视频教程时遇到问题时，都可以在星球上提问，小伙伴们购买视频后，我会拉你进星球。</p><p><strong>Q7：这套视频适合哪些人看？</strong></p><p>学习这套视频，首先需要有 SSM 基础，如果没有，可以在公众号后台回复 SSM，有我录制的免费视频教程；另外也需要一些 Spring Boot 基础和 Vue 基础，要是没接触过 Spring Boot 和 Vue 的话，那么建议先看看 vhr，戳这里：<a href="https://mp.weixin.qq.com/s/aIyP77WrrswWNXaueBXj7w" target="_blank" rel="noopener">Spring Boot+Vue+微人事视频教程</a></p><p><strong>Q8：看视频有问题可以问吗？</strong></p><p>参考 Q6。</p><p><strong>Q9：这套视频我能学到啥？</strong></p><p>TienChin 项目基于 RuoYi-Vue 脚手架（Spring Boot+Vue3），这套视频学完后，小伙伴们对 RuoYi-Vue 脚手架基本上就融会贯通了，并能在 RuoYi-Vue 脚手架上随心所欲的开发常规的企业后台应用。并且对于分布式事务 seata、Flowable 流程引擎等框架也能熟练使用并掌握其原理，对于 Redis 在项目中的各种实际应用场景也会有较好的掌握。</p><hr><p><strong>好啦，七折 279 抄底就在今天啦！</strong></p><p>P.s.：可能有小伙伴加了松哥多个微信，其实没有必要重复添加，任意一个都能找到我。当然，如果你还没有松哥微信，扫码加微信，转账 279 上车吧（买过 vhr 的小伙伴可在此基础上再优惠 ¥30 哦）～</p><p><img src="http://img.itboyhub.com/2021/10/tran/20220731113838.png" alt></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;距离上次跟小伙伴们汇报 TienChin 项目视频进度已经过去一个月啦，今天是 7 月 31 号，再来汇报一下这个月视频的进展。&lt;/p&gt;
    
    </summary>
    
      <category term="TienChin" scheme="http://www.javaboy.org/categories/TienChin/"/>
    
    
      <category term="TienChin" scheme="http://www.javaboy.org/tags/TienChin/"/>
    
      <category term="Flowable" scheme="http://www.javaboy.org/tags/Flowable/"/>
    
  </entry>
  
  <entry>
    <title>签名书继续，再来十本！</title>
    <link href="http://www.javaboy.org/2022/0830/springboot-security.html"/>
    <id>http://www.javaboy.org/2022/0830/springboot-security.html</id>
    <published>2022-08-30T12:08:54.000Z</published>
    <updated>2022-12-19T12:18:30.619Z</updated>
    
    <content type="html"><![CDATA[<p>松哥搞公众号一直比较佛系，看标题看内容基本上就能看出来，我基本上是按照自己的节奏去写去更的，基本上从来不追热点，所以公众号的阅读量、评论数这些指标也就比较佛系，时高时低，不过都无所谓了。</p><a id="more"></a><p>然而上次送签名书时候的评论数远远超乎我的预料，给大家看张图：</p><p><img src="http://img.itboyhub.com/2022/08/20220829195544.png" alt></p><p>这个留言数跟点赞数有点鹤立鸡群了。</p><p>留言一共有 369 条，然而微信公众号有精选留言数目的限制，一篇文章最多只能精选 100 条留言，其他超过的就无法精选了，所以有很多小伙伴的留言最终没能精选出来，但是每条留言我其实都有认真去看。选中奖小伙伴的时候，前前后后差不多花了一个多小时，实在太纠结了，想给每一个小伙伴送，可惜只有十本书。。。</p><p>送书其实有一个省事的办法就是直接抽奖，抽奖是完全随机的，总感觉少了一点人情味在里边。。。所以这次还是留言送书吧。</p><p>都说现在很卷，那么如何破呢？读书，读书破万卷！</p><p>越是在行情不好的时候，越是在人心浮躁的时候，我们更应该静下心来提升自己。以前行情好的时候，技术差点也能找个差不多的工作，现在行情不好，就是真正拼技术的时候了，只要技术到位，找份工作依然问题不大。希望松哥这本 <strong>《深入浅出 Spring Security》</strong> 能够在安全管理方面带给大家一些帮助。</p><p>好啦，那我也不废话了，这次还是十本《深入浅出 Spring Security》包邮到家！<strong>小伙伴们留言说说你印象最深的一次找工作经历</strong>，松哥会从留言的小伙伴中选出来十位幸运小伙伴各送一本签名版《深入浅出 Spring Security》，留言截止到 9 月 1 号 18 点。</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;松哥搞公众号一直比较佛系，看标题看内容基本上就能看出来，我基本上是按照自己的节奏去写去更的，基本上从来不追热点，所以公众号的阅读量、评论数这些指标也就比较佛系，时高时低，不过都无所谓了。&lt;/p&gt;
    
    </summary>
    
      <category term="TienChin" scheme="http://www.javaboy.org/categories/TienChin/"/>
    
    
      <category term="TienChin" scheme="http://www.javaboy.org/tags/TienChin/"/>
    
      <category term="Spring Security" scheme="http://www.javaboy.org/tags/Spring-Security/"/>
    
  </entry>
  
  <entry>
    <title>没有一个顺手的流程绘制工具？好吧，自己动手，丰衣足食！</title>
    <link href="http://www.javaboy.org/2022/0829/flowable-vue-tool.html"/>
    <id>http://www.javaboy.org/2022/0829/flowable-vue-tool.html</id>
    <published>2022-08-29T12:08:36.000Z</published>
    <updated>2022-12-19T12:18:47.037Z</updated>
    
    <content type="html"><![CDATA[<p>流程绘制工具感觉也挺常用的，而且流程图基本上也都标准化了，标准化的东西其实是最容易做的，但是 IDEA 上却一直没有一个称手的流程绘制工具，其实这也是一个机会吧哈哈，自己搞一个 IDEA 插件～</p><a id="more"></a><p>不过这个机会留给各位正在阅读本文的小伙伴吧，松哥今天跟大家介绍另外一个工具 bpmn.js，利用这个，再结合大家熟悉的 Vue，我们就可以开发出一个自己的流程绘制工具，一起来看下。</p><p>先看下效果图：</p><p><img src="http://img.itboyhub.com/2022/08/20220823174610.png" alt></p><p>好了，不废话了，开搞！</p><h2 id="1-bpmn-js"><a href="#1-bpmn-js" class="headerlink" title="1. bpmn.js"></a>1. bpmn.js</h2><p>bpmn.js 是一个工具包，利用这个工具包，我们可以非常方便的在浏览器中创建、嵌入或者扩展一个 BPMN 流程图，重要的是，这个过程非常 Easy，我们只需要少量代码即可实现这一目标。</p><p>不知道看文章的小伙伴们日常工作中接触流程图多不多，如果经常接触的话，我估计有不少小伙伴可能都见过基于 bpmn.js 构建出来的流程图绘制工具。</p><p>因为 flowable-ui 这种太重量级了，如果我们单纯的只是想在自己的项目中嵌入一个流程绘制工具，那么显然 bpmn.js 是最佳选择。</p><p>网上其实也有不少关于 bpmn.js 的文章，不过当和 Vue 整合的时候，基本上都用的是 Vue2，而这个工具在 Vue2 和 Vue3 的使用中，还是有不少差异的，今天松哥就以 Vue3 为例，来和小伙伴们分享一下这个工具在 Vue3 中的使用。</p><h2 id="2-Vue3"><a href="#2-Vue3" class="headerlink" title="2. + Vue3"></a>2. + Vue3</h2><h3 id="2-1-项目创建"><a href="#2-1-项目创建" class="headerlink" title="2.1 项目创建"></a>2.1 项目创建</h3><p>首先我们执行如下命令，来创建一个 Vue3 项目：</p><figure class="highlight shell hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">npm create vite@latest bpmn_demo --template vue</span><br><span class="line">cd bpmn_demo</span><br><span class="line">npm install</span><br><span class="line">npm run dev</span><br></pre></td></tr></table></figure><p>创建完成后，我们先来装上 bpmn.js 所需要的依赖，一共是三个依赖：</p><ul><li>bpmn-js</li></ul><p>这是最核心的流程绘制工具了。</p><ul><li>bpmn-js-properties-panel</li></ul><p>这是 bpmn-js 的属性面板，流程图中的每一个节点都有属性，如果需要配置这些数据，就需要用到这个依赖，小伙伴们看看下图中右边的部分，就是这个依赖实现的功能：</p><p><img src="http://img.itboyhub.com/2022/08/20220822205118.png" alt></p><ul><li>camunda-bpmn-moddle</li></ul><p>如果你的流程引擎使用了 Camunda，那么可以通过 camunda-bpmn-moddle 模块来配置该流程所支持的任务属性。</p><p>好啦，废话不多说，先把这三个依赖依次安装上：</p><figure class="highlight shell hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">npm install bpmn-js</span><br><span class="line">npm install bpmn-js-properties-panel</span><br><span class="line">npm install camunda-bpmn-moddle</span><br></pre></td></tr></table></figure><p>另外，松哥亲测，还需要安装 @bpmn-io/properties-panel 和 inherits 用以解决依赖内部的兼容性问题，安装命令如下：</p><figure class="highlight shell hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">npm i @bpmn-io/properties-panel</span><br><span class="line">npm i inherits</span><br></pre></td></tr></table></figure><p>另外，项目中用到了一个 ElementUI 的按钮，所以需要安装上 ElementUI-Plus，如下：</p><figure class="highlight shell hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install element-plus --save</span><br></pre></td></tr></table></figure><p>装好之后，我给大家看下我安装的版本，都是目前最新版：</p><figure class="highlight json hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="hljs-attr">"name"</span>: <span class="hljs-string">"bpmn_demo"</span>,</span><br><span class="line">  <span class="hljs-attr">"private"</span>: <span class="hljs-literal">true</span>,</span><br><span class="line">  <span class="hljs-attr">"version"</span>: <span class="hljs-string">"0.0.0"</span>,</span><br><span class="line">  <span class="hljs-attr">"type"</span>: <span class="hljs-string">"module"</span>,</span><br><span class="line">  <span class="hljs-attr">"scripts"</span>: &#123;</span><br><span class="line">    <span class="hljs-attr">"dev"</span>: <span class="hljs-string">"vite"</span>,</span><br><span class="line">    <span class="hljs-attr">"build"</span>: <span class="hljs-string">"vite build"</span>,</span><br><span class="line">    <span class="hljs-attr">"preview"</span>: <span class="hljs-string">"vite preview"</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="hljs-attr">"dependencies"</span>: &#123;</span><br><span class="line">    <span class="hljs-attr">"@bpmn-io/properties-panel"</span>: <span class="hljs-string">"^0.19.0"</span>,</span><br><span class="line">    <span class="hljs-attr">"bpmn-js"</span>: <span class="hljs-string">"^9.4.0"</span>,</span><br><span class="line">    <span class="hljs-attr">"bpmn-js-properties-panel"</span>: <span class="hljs-string">"^1.5.0"</span>,</span><br><span class="line">    <span class="hljs-attr">"camunda-bpmn-moddle"</span>: <span class="hljs-string">"^6.1.2"</span>,</span><br><span class="line">    <span class="hljs-attr">"element-plus"</span>: <span class="hljs-string">"^2.2.14"</span>,</span><br><span class="line">    <span class="hljs-attr">"inherits"</span>: <span class="hljs-string">"^2.0.4"</span>,</span><br><span class="line">    <span class="hljs-attr">"vue"</span>: <span class="hljs-string">"^3.2.37"</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="hljs-attr">"devDependencies"</span>: &#123;</span><br><span class="line">    <span class="hljs-attr">"@vitejs/plugin-vue"</span>: <span class="hljs-string">"^3.0.3"</span>,</span><br><span class="line">    <span class="hljs-attr">"vite"</span>: <span class="hljs-string">"^3.0.7"</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>松哥亲测，如果使用 Webpack 而不是 Vite 来构建项目的话，那么可以不用安装 inherits，这个小伙伴们根据自己的实际情况安装即可，项目创建完成后，如果提示缺少这个组件就安装一下，如果不提示那就忽略即可。</p></blockquote><h3 id="2-2-开发页面"><a href="#2-2-开发页面" class="headerlink" title="2.2 开发页面"></a>2.2 开发页面</h3><p>用 Vite 新建的项目默认没有安装路由，配路由也比较麻烦，所以我这里就省事一些，我直接新建一个组件来写我们的页面，将来在 App.vue 中引入我这个新建的组件即可。</p><p>首先我新建一个名为 BpmnView 的组件，然后在这个组件中配置 bpmn.js，内容如下：</p><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">&lt;div&gt;</span><br><span class="line">    &lt;div class=&quot;containers&quot; style=&quot;display: flex;width:100%;height: 96vh&quot;&gt;</span><br><span class="line">        &lt;div class=&quot;canvas&quot; style=&quot;width: 100%&quot; id=&quot;canvas&quot;&gt;&lt;/div&gt;</span><br><span class="line">        &lt;div id=&quot;properties&quot;&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">    &lt;div style=&quot;display:flex;justify-content: flex-end&quot;&gt;</span><br><span class="line">        &lt;el-button @click=&quot;downloadXML&quot; type=&quot;primary&quot; :icon=&quot;Download&quot;&gt;下载&lt;/el-button&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></table></figure><p>小伙伴们看到，这个页面整体上分为两部分，上面是我们绘制的主区域，包括绘图区以及属性设置区；下面则放了一个下载流程图 XML 文件的按钮。</p><p>在上面的主绘制区，我们放了两个东西，一个是画布 canvas，另一个是属性 properties，canvas 就是流程图绘制时候的核心区域，properties 则是流程中的每一个节点的属性配置。</p><p>参考下图，大家就知道 canvas 和 properties 分别表示什么了：</p><p><img src="http://img.itboyhub.com/2022/08/20220823002614.png" alt></p><p>接下来我们先来初始化左边的 canvas。</p><h4 id="2-2-1-canvas"><a href="#2-2-1-canvas" class="headerlink" title="2.2.1 canvas"></a>2.2.1 canvas</h4><p>首先我们来看下左边的 Canvas 该如何初始化。</p><figure class="highlight js hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&lt;script setup&gt;</span><br><span class="line">    <span class="hljs-keyword">import</span> &#123; onMounted&#125; <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-keyword">import</span> BpmnModeler <span class="hljs-keyword">from</span> <span class="hljs-string">'bpmn-js/lib/Modeler'</span>;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-keyword">let</span> bpmnModeler;</span><br><span class="line">    onMounted(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="hljs-comment">// 建模</span></span><br><span class="line">        bpmnModeler = <span class="hljs-keyword">new</span> BpmnModeler(&#123;</span><br><span class="line">            container: <span class="hljs-string">'#canvas'</span></span><br><span class="line">        &#125;)</span><br><span class="line">        bpmnModeler.createDiagram();</span><br><span class="line">    &#125;)</span><br><span class="line">&lt;<span class="hljs-regexp">/script&gt;</span></span><br></pre></td></tr></table></figure><p>这个初始化工作在 onMounted 回调中完成。</p><ol><li>创建 BpmnModeler 并设置画布。</li><li>调用 createDiagram 方法开始绘图。</li></ol><p>配置完成后，还要记得在 main.js 中引入样式文件，如下：</p><figure class="highlight js hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">import</span> <span class="hljs-string">'bpmn-js/dist/assets/diagram-js.css'</span></span><br><span class="line"><span class="hljs-keyword">import</span> <span class="hljs-string">'bpmn-js/dist/assets/bpmn-font/css/bpmn.css'</span></span><br><span class="line"><span class="hljs-keyword">import</span> <span class="hljs-string">'bpmn-js/dist/assets/bpmn-font/css/bpmn-codes.css'</span></span><br><span class="line"><span class="hljs-keyword">import</span> <span class="hljs-string">'bpmn-js/dist/assets/bpmn-font/css/bpmn-embedded.css'</span></span><br></pre></td></tr></table></figure><p>现在就可以了，左边可以开始画流程图了。</p><h4 id="2-2-2-properties"><a href="#2-2-2-properties" class="headerlink" title="2.2.2 properties"></a>2.2.2 properties</h4><p>再来看右边属性的配置。</p><p>首先在 main.js 中加入右边属性的样式文件：</p><figure class="highlight js hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">import</span> <span class="hljs-string">'bpmn-js-properties-panel/dist/assets/properties-panel.css'</span></span><br></pre></td></tr></table></figure><p>然后继续在 BpmnView.vue 中进行配置即可：</p><figure class="highlight js hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">&lt;script setup&gt;</span><br><span class="line">    <span class="hljs-keyword">import</span> &#123;onMounted&#125; <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-keyword">import</span> BpmnModeler <span class="hljs-keyword">from</span> <span class="hljs-string">'bpmn-js/lib/Modeler'</span>;</span><br><span class="line">    <span class="hljs-keyword">import</span> &#123;</span><br><span class="line">        BpmnPropertiesPanelModule,</span><br><span class="line">        BpmnPropertiesProviderModule,</span><br><span class="line">        CamundaPlatformPropertiesProviderModule</span><br><span class="line">    &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">'bpmn-js-properties-panel'</span>;</span><br><span class="line">    <span class="hljs-keyword">import</span> CamundaExtensionModule <span class="hljs-keyword">from</span> <span class="hljs-string">'camunda-bpmn-moddle/lib'</span>;</span><br><span class="line">    <span class="hljs-keyword">import</span> camundaModdleDescriptors <span class="hljs-keyword">from</span> <span class="hljs-string">'camunda-bpmn-moddle/resources/camunda'</span>;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-keyword">let</span> bpmnModeler;</span><br><span class="line">    onMounted(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="hljs-comment">// 建模</span></span><br><span class="line">        bpmnModeler = <span class="hljs-keyword">new</span> BpmnModeler(&#123;</span><br><span class="line">            container: <span class="hljs-string">'#canvas'</span>, <span class="hljs-attr">propertiesPanel</span>: &#123;</span><br><span class="line">                parent: <span class="hljs-string">'#properties'</span></span><br><span class="line">            &#125;,</span><br><span class="line">            additionalModules: [</span><br><span class="line">                BpmnPropertiesPanelModule,</span><br><span class="line">                BpmnPropertiesProviderModule,</span><br><span class="line">                CamundaPlatformPropertiesProviderModule,</span><br><span class="line">                CamundaExtensionModule</span><br><span class="line">            ],</span><br><span class="line">            moddleExtensions: &#123;</span><br><span class="line">                camunda: camundaModdleDescriptors</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">        bpmnModeler.createDiagram();</span><br><span class="line">    &#125;)</span><br><span class="line">&lt;<span class="hljs-regexp">/script&gt;</span></span><br></pre></td></tr></table></figure><p>在创建 BpmnModeler 的时候，通过 propertiesPanel 去指定 parent 的位置，再把另外五个额外的模块挂载上去就行了，这五个模块分别代表不同的属性，我就不挨个说了，小伙伴们可以自行尝试删除掉一个属性，看看哪些属性少了，就知道这个模块的功能了。</p><h4 id="2-2-3-下载按钮"><a href="#2-2-3-下载按钮" class="headerlink" title="2.2.3 下载按钮"></a>2.2.3 下载按钮</h4><p>最后再来看看下载按钮的点击事件。</p><figure class="highlight js hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">downloadXML</span>(<span class="hljs-params"></span>) </span>&#123;</span><br><span class="line">    bpmnModeler.saveXML(&#123;<span class="hljs-attr">format</span>: <span class="hljs-literal">true</span>&#125;, (err, xml) =&gt; &#123;</span><br><span class="line">        <span class="hljs-keyword">if</span> (!err) &#123;</span><br><span class="line">            <span class="hljs-built_in">console</span>.log(xml);</span><br><span class="line">            <span class="hljs-comment">// 获取文件名</span></span><br><span class="line">            <span class="hljs-keyword">const</span> name = getFileName(xml);</span><br><span class="line">            <span class="hljs-comment">// 把输就转换为URI，下载要用到的</span></span><br><span class="line">            <span class="hljs-keyword">const</span> encodedData = <span class="hljs-built_in">encodeURIComponent</span>(xml);</span><br><span class="line">            <span class="hljs-keyword">const</span> downloadLink = <span class="hljs-built_in">document</span>.createElement(<span class="hljs-string">'a'</span>);</span><br><span class="line">            <span class="hljs-keyword">if</span> (xml) &#123;</span><br><span class="line">                <span class="hljs-comment">// 将数据给到链接</span></span><br><span class="line">                downloadLink.href =</span><br><span class="line">                    <span class="hljs-string">"data:application/bpmn20-xml;charset=UTF-8,"</span> + encodedData;</span><br><span class="line">                <span class="hljs-comment">// 设置文件名</span></span><br><span class="line">                downloadLink.download = name;</span><br><span class="line">                <span class="hljs-comment">// 触发点击事件开始下载</span></span><br><span class="line">                downloadLink.click();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getFileName</span>(<span class="hljs-params">xml</span>) </span>&#123;</span><br><span class="line">    <span class="hljs-keyword">let</span> split = xml.split(<span class="hljs-string">'process id="'</span>);</span><br><span class="line">    <span class="hljs-keyword">return</span> split[<span class="hljs-number">1</span>].split(<span class="hljs-string">'" '</span>)[<span class="hljs-number">0</span>]+<span class="hljs-string">".bpmn20.xml"</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>调用 bpmnModeler.saveXML 方法，回调中的 xml 参数就是生成的流程图 XML 文件，然后创建一个虚拟的 a 标签，模拟一个点击事件即可完成下载。</p><p>getFileName 方法则是从下载的 XML 文件中截取出来 bpmn:process 标签的 id 值作为文件名，这也符合我们日常的命名习惯。</p><p>好啦，大功告成！以后就可以使用我们自己的流程绘制工具来画流程图了。</p><p>不过有一个小小遗憾，就是这个是针对 Camunda 这个流程引擎的，如果所以他画出来的流程图并不能直接用在 Flowable 中，如果想在 Flowable 中使用，还需要一点额外的定制，这个咱们以后再说。</p><h2 id="3-小结"><a href="#3-小结" class="headerlink" title="3. 小结"></a>3. 小结</h2><p>bpmn.js 最大的优势在于可以根据自己项目的需求，方便的嵌入到已有项目中。好啦，公众号江南一点雨后台回复 bpmn_demo 可以下载文本完整案例。</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;流程绘制工具感觉也挺常用的，而且流程图基本上也都标准化了，标准化的东西其实是最容易做的，但是 IDEA 上却一直没有一个称手的流程绘制工具，其实这也是一个机会吧哈哈，自己搞一个 IDEA 插件～&lt;/p&gt;
    
    </summary>
    
      <category term="TienChin" scheme="http://www.javaboy.org/categories/TienChin/"/>
    
    
      <category term="TienChin" scheme="http://www.javaboy.org/tags/TienChin/"/>
    
      <category term="Flowable" scheme="http://www.javaboy.org/tags/Flowable/"/>
    
  </entry>
  
  <entry>
    <title>极简 Java 工作流概念入门</title>
    <link href="http://www.javaboy.org/2022/0825/flowable-quickstart.html"/>
    <id>http://www.javaboy.org/2022/0825/flowable-quickstart.html</id>
    <published>2022-08-25T12:08:13.000Z</published>
    <updated>2022-12-19T12:18:43.978Z</updated>
    
    <content type="html"><![CDATA[<p>关于 Flowable 松哥已经更新了好几篇文章了，不过考虑到有的小伙伴可能还从来没接触过流程引擎，因此有一些基础的内容我再来和小伙伴们梳理一下。</p><a id="more"></a><h2 id="1-为什么需要工作流"><a href="#1-为什么需要工作流" class="headerlink" title="1. 为什么需要工作流"></a>1. 为什么需要工作流</h2><p>松哥将之前的文章转发到朋友圈后，有小伙伴评论说一直不理解为什么需要工作流，今天我们就先来说说这个话题。</p><p>假设我有一个请假需求，流程如下：</p><p><img src="http://img.itboyhub.com/2021/10/tran/20220808211237.png" alt></p><p>请假可以提交给我的上司，上司可以选择批准或者拒绝，无论批准还是拒绝，都会给我一个通知。</p><p>这个流程比较简单，我们很容易想到解决方案，不用工作流也能解决，有一个专门的请假表，当 A 要请假的时候，就往请假表中添加一条记录，这条记录的内容包含了请假的天数、原因、请假的审批人 B 以及一个名为 status 的字段，这个 status 字段表示这个请假申请目前的状态（待审批、已批准还是已拒绝），然后 B 登录系统之后，在请假表中查询到了 A 的请假信息，然后选择批准，此时将 status  字段的值改一下就行了。</p><p>这个流程很简单，相信小伙伴们都能想到。</p><p>然而，这是一个非常简单的流程，对于这样的流程，一般来说也确实没有必要使用工作流，但是现实中，我们涉及到的工作流往往都是非常复杂的，我举个例子，就说报销审批吧，这个可能很多小伙伴都经历过。</p><p><img src="http://img.itboyhub.com/2022/08/baoxiaoliucheng.png" alt></p><p>小伙伴们看到，这个流程相对来说还是比较复杂的，此时你再用一个 status 字段去描述，就很难说的请到底是怎么回事了。每一步审批，都有可能批准也有可能拒绝，拒绝并不意味着流程结束，员工修改报销资料之后，还可以继续提交。此时如果还用 status 去描述，那么 status 将有 N 多个值去表示不同的情况，这个维护起来非常不便。</p><p>这就复杂了吗？非也非也，我们再来看一个生产笔记本电脑的例子，假设公司研发了一款新型笔记本电脑，整个研发到生产的流程可能是这样：</p><p><img src="http://img.itboyhub.com/2022/08/bijibenshengchanliucheng-2.png" alt></p><p>相比上面两个，这个就更复杂一些了，不仅有串行任务还有并行任务，如何去设计这样一个系统？单纯的通过状态字段去描述显然已经不够用了，此时我们就得考虑一种通用的、更易维护的方案来实现这样的系统了，这种通用的、易维护的方案，也就是工作流。</p><h2 id="2-三大工作流"><a href="#2-三大工作流" class="headerlink" title="2. 三大工作流"></a>2. 三大工作流</h2><p>一个比较早的工作流是 jBPM，这是一个由 Java 实现的企业级流程引擎，是 JBoss 公司开发的产品之一。</p><p>jBPM 的创建者是 Tom Baeyens，这个大佬后来离开了 JBoss，并加入到 Alfresco，并推出了基于 jBPM4 的开源工作流系统 Activiti，而 jBPM 则在后续的代码中完全放弃了 jBPM4 的代码。从这个过程中也能看出来，jBPM 在发展过程中，由于意见相左，后来变成了两个 jBPM 和 Activiti。</p><p>然而戏剧的是，Activiti5 没搞多久，从 Activiti 中又分出来一个 Camunda，Activiti 继续发展，又从中分出来一个 Flowable。。。</p><p>由于开发 jBPM、Activiti、Camunda 以及 Flowable 的人多多少少有一些关联性，让人不得不猜测意见相左拉一票人出来单干是他们的企业文化。</p><p>所以现在市面上主流的流程引擎就一共有三个：</p><ul><li>Activiti</li><li>Flowable</li><li>Camunda</li></ul><p>这三个各有特点：</p><ol><li>Activiti 目前是侧重云，他目前的设计会向 Spring Cloud、Docker 这些去靠拢。</li><li>Flowable 核心思想还是在做一个功能丰富的流程引擎工具，除了最最基础的工作流，他还提供了很多其他的扩展点，我们可以基于 Flowable 实现出许多我们想要的功能（当然这也是小伙伴们觉得 Flowable 使用复杂的原因之一）。</li><li>Camunda 相对于前两个而言比较轻量级，Camunda 有一个比较有特色的功能就是他提供了一个小巧的编辑器，基于 bpmn.io 来实现的（松哥之前已经发文讲过了）。如果你的项目需求是做一个轻巧的、灵活的、定制性强的编辑器，工作流是嵌入式的，那么可以选择 Camunda。</li></ol><p>如果仔细比较起这三个的差异，能列一个长长的表格，这个网上也有不少人都总结过了，松哥这里也就不啰嗦了。</p><h2 id="3-流程图"><a href="#3-流程图" class="headerlink" title="3. 流程图"></a>3. 流程图</h2><p>既然有三个不同的工作流，那么三个不同的工作流画出来的流程图是否都各不相同呢？</p><p>不是的。</p><p>工作流程图这块其实有一个统一的标准，那就是 BPMN。BPMN 全称是 Business Process Model and Notation，中文译作业务流程模型和标记法，这个中文太绕口了，还是简称 BPMN 吧。</p><p>这是一套图形化表示法，用图形来表示业务流程模型。BPMN 最初由业务流程管理倡议组织（BPMI, Business Process Management Initiative）开发，BPMI 于 2005 年与对象管理组织（OMG, Object Management Group）合并，并于 2011 年 1 月 OMG 发布 2.0 版本，同时改为现在的名称。</p><p>一句话，就是流程图这块有一个特别古老的规范，那就是 BPMN，而我们前面所说的无论是 Activiti、Flowable 还是 Camunda，都是支持这个规范的，所以呢，无论你使用哪一个流程引擎，都可以使用同一套流程图。</p><p>那么这个规范究竟都说了些什么事情呢？</p><p>我们以上面生产笔记本的流程图为例，来和小伙伴们做一个简单介绍：</p><p><img src="http://img.itboyhub.com/2022/08/bijibenshengchanliucheng-2.png" alt></p><p>从上图中可以看到，一个流程图中主要包含四方面的内容：</p><ul><li>事件</li><li>连线</li><li>任务</li><li>网关</li></ul><p>我们一个一个来说。</p><p><strong>事件</strong></p><p>首先在一个流程图中应该有开始事件和结束事件，也就是上图大家看到的两个圆圈。另外还有一些中间事件、边界事件等。举个中间定时事件的例子，比如用户下单之后，可以有一个中间定时事件，延迟 5 分钟发货。</p><p><strong>连线</strong></p><p>连线就是将事件、任务、网关等连在一起的线条，一般情况下就是普通连线，有的时候连线会有一些条件，例如松哥之前文章和大家分享的请假，如果经理同意请假申请，就走哪一个线条，如果经理不同意请假申请，就走哪一个线条。对应上图的笔记本生产，如果经理审批通过，就载入图纸准备生产，如果经理审批不通过，就重新设计。</p><p><strong>任务</strong></p><p>任务这块其实有很多分类。</p><p>如果细分大致上可以分为如下几种：</p><ul><li>接收任务</li></ul><p><img src="http://img.itboyhub.com/2022/08/20220825121125.png" alt></p><p>在上面的流程图中，等待准备工作完成这一项就是一个接收任务。这个任务里并不需要额外做什么事情，流程到这一步就自动停下来了，需要人工去点一下，推动流程继续向下执行。</p><ul><li>发送任务</li></ul><p><img src="http://img.itboyhub.com/2022/08/20220825121035.png" alt></p><p>这个一般用来把消息发送给外部参与者。</p><ul><li>服务任务</li></ul><p><img src="http://img.itboyhub.com/2022/08/20220825121004.png" alt></p><p>这个一般由系统自动完成，其实说白了就是我们的一个自定义类，可以在一个自定义类里边完成想要做的事情。</p><ul><li>脚本任务</li></ul><p><img src="http://img.itboyhub.com/2022/08/20220825120938.png" alt></p><p>一个自动化活动。当流程执行到脚本任务时，自动执行相应的脚本。</p><ul><li>业务规则任务</li></ul><p><img src="http://img.itboyhub.com/2022/08/20220825121203.png" alt></p><p>BPMN2.0 新引入用来对接业务规则引擎，业务规则任务用于同步执行一个或多个规则。</p><ul><li>用户任务</li></ul><p><img src="http://img.itboyhub.com/2022/08/20220825121238.png" alt></p><p>用于为那些需要由人工参与者完成的工作建模。</p><p>虽然细分类别很多，但是仔细看，其实这几种又可以归为两大类：</p><ol><li>用户任务：表示人工要介入做的事情。比如同意与否，或者输入一些参数，要让人工完成任务，就需要一个表单系统，让人工输入数据，或者显示数据给人看，这也是为什么用户任务和表单系统结合在一起的原因，用户任务需要用户向引擎提交一个完成任务的动作，否则流程会暂停在这里等待。</li><li>服务任务：表示机器自动做的事情。调用服务的任务，这个服务可以是一个 Spring JavaBean，也可以是一个远程 REST 服务，流程会自动执行服务任务。</li></ol><p><strong>活动</strong></p><p>活动可以算是一种特殊的任务。活动可以调用另外一个流程使之作为当前流程的子流程去运行。活动也可以分为用户活动、脚本活动等等。从显示上来说，活动比任务边框深一些。仅此而已。</p><p><strong>网关</strong></p><p>网关要是细分起来，也有很多不同类型的网关。</p><ul><li>互斥网关</li></ul><p><img src="http://img.itboyhub.com/2022/08/20220825123232.png" alt></p><p>这种网关也叫排他性网关，我们之前请假流程中的那个网关，就是互斥网关。这种网关有且仅有一个有效出口。</p><ul><li>相容网关</li></ul><p><img src="http://img.itboyhub.com/2022/08/20220825123255.png" alt></p><p>这种网关会有多个出口，只要条件满足，都会执行。</p><ul><li>事件网关</li></ul><p><img src="http://img.itboyhub.com/2022/08/20220825123538.png" alt></p><p>事件网关是通过中间事件驱动，它在等待的事件发生后才会触发决策。基于事件的网关允许基于事件作出决策。</p><ul><li>并行网关</li></ul><p><img src="http://img.itboyhub.com/2022/08/20220825123325.png" alt></p><p>并行网关一般是成对出现的，上面生产笔记本的那个流程中，生产屏幕、键盘等并行操作，就是通过并行网关来实现的。</p><p>好啦，这就是关于流程引擎的一些基本概念，捋顺了这些基本概念，在回过头看我们前面几篇关于流程引擎的文章，应该会有一些不一样的理解：</p><ul><li><a href="https://mp.weixin.qq.com/s/Pd0MEkZu12vdmGGBT9ZV-w" target="_blank" rel="noopener">Spring Boot 整合流程引擎 Flowable，so easy！</a></li><li><a href="https://mp.weixin.qq.com/s/QEXceZ0KmDKFMcYq-B4Wkg" target="_blank" rel="noopener">SpringBoot+Vue+Flowable，模拟一个请假审批流程！</a></li><li><a href="https://mp.weixin.qq.com/s/npgP8WyVHDB3PFS-zPcI5w" target="_blank" rel="noopener">49张图带领小伙伴们体验一把 Flowable-UI</a></li><li><a href="https://mp.weixin.qq.com/s/OTqIsuvCltIYkSYZCQgk3Q" target="_blank" rel="noopener">Spring Security + Vue + Flowable 怎么玩？</a></li></ul>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;关于 Flowable 松哥已经更新了好几篇文章了，不过考虑到有的小伙伴可能还从来没接触过流程引擎，因此有一些基础的内容我再来和小伙伴们梳理一下。&lt;/p&gt;
    
    </summary>
    
      <category term="TienChin" scheme="http://www.javaboy.org/categories/TienChin/"/>
    
    
      <category term="TienChin" scheme="http://www.javaboy.org/tags/TienChin/"/>
    
      <category term="Flowable" scheme="http://www.javaboy.org/tags/Flowable/"/>
    
  </entry>
  
  <entry>
    <title>Spring Security + Vue + Flowable 怎么玩？</title>
    <link href="http://www.javaboy.org/2022/0822/springsecurity-vue-flowable.html"/>
    <id>http://www.javaboy.org/2022/0822/springsecurity-vue-flowable.html</id>
    <published>2022-08-22T11:40:49.000Z</published>
    <updated>2022-12-19T11:53:14.559Z</updated>
    
    <content type="html"><![CDATA[<p>[TOC]</p><p>之前松哥发过一篇文章，和小伙伴们分享了 Spring Boot+Vue+Flowable 的具体玩法，传送门：</p><a id="more"></a><ul><li><a href="https://mp.weixin.qq.com/s/QEXceZ0KmDKFMcYq-B4Wkg" target="_blank" rel="noopener">SpringBoot+Vue+Flowable，模拟一个请假审批流程！</a></li></ul><p>不过在那篇文章中，所有涉及到用户的地方，都是手动输入的，这显然不太好，例如开启一个请假流程：</p><p><img src="http://img.itboyhub.com/2021/10/tran/20220808205124.png" alt></p><p>这个流程中需要用户输入自己的姓名，其实如果当前用户登录了，就不用输入用户名了，直接就使用当前登录的用户名。</p><p>另一方面，当我们引入了用户系统之后，当用户提交请假申请的时候，也可以指定审批人，这样看起来就更真实了。</p><p>所以，今天我们就整篇文章，我们引入 Spring Security，据此来构建用户系统，一起来看下有了用户系统的流程引擎该是什么样子。</p><h2 id="1-效果展示"><a href="#1-效果展示" class="headerlink" title="1. 效果展示"></a>1. 效果展示</h2><p>东西我已经做好了，先截个图给大家看下：</p><p><img src="http://img.itboyhub.com/2022/08/20220818192154.png" alt></p><p>这个页面分了三部分：</p><ol><li>最上面的是请假申请，用户只需要填入请假天数、请假理由，并且选择审批人即可，选择审批人的时候，可以直接指定审批人的名字，也可以选择审批人的角色，例如选择经理这个角色，那么将来只要角色为经理的任意用户登录成功之后，就可以看到自己需要审批的请假了。</li><li>中间的列表展示当前登录用户曾经提交过的请假申请，这些申请的状态分为三种，分别是已通过、已拒绝以及待审批。</li><li>下面的列表是这个用户需要审批的其他用户提交的请假申请，图片中这个用户暂无要审批的任务，如果有的话，这个地方会通过表格展示出来，表格中每一行有批准和拒绝两个按钮，点击之后就可以实现自己的操作了。</li></ol><p>这就是我们这次要实现的效果了，相比于<a href="https://mp.weixin.qq.com/s/QEXceZ0KmDKFMcYq-B4Wkg" target="_blank" rel="noopener">SpringBoot+Vue+Flowable，模拟一个请假审批流程！</a>文章的案例，这次的显然看起来更像一回事，不过本文的案例是在<a href="https://mp.weixin.qq.com/s/QEXceZ0KmDKFMcYq-B4Wkg" target="_blank" rel="noopener">上篇文章</a>案例的基础上完成的，没看过上篇文章的小伙伴建议先看下<a href="https://mp.weixin.qq.com/s/QEXceZ0KmDKFMcYq-B4Wkg" target="_blank" rel="noopener">上篇文章</a>，<a href="https://mp.weixin.qq.com/s/QEXceZ0KmDKFMcYq-B4Wkg" target="_blank" rel="noopener">上篇文章</a>中的案例，大家可以在微信公众号江南一点雨的后台回复 <strong>flowable02</strong> 获取。</p><h2 id="2-两套用户体系"><a href="#2-两套用户体系" class="headerlink" title="2. 两套用户体系"></a>2. 两套用户体系</h2><p>玩过工作流的小伙伴应该都知道，工作流中其实自带了一套用户系统，但是我们自己的系统往往也有自己的用户体系，那么如何将两者融合起来呢？或者说是否有必要将两者融合起来呢？</p><p>如果你想将自己系统的用户体系和 flowable 中的用户体系融合起来，那么整体上来说，大概就是两种办法吧：</p><ol><li>我们可以以自己系统中的用户体系为准（因为 flowable 自己的用户体系字段往往不能满足我们的需求），然后创建对应的视图即可。例如 flowable 中的用户表 ACT_ID_USER、分组表 ACT_ID_GROUP、用户分组关联表 ACT_ID_MEMBERSHIP 等等，把这些和用户体系相关的表删除掉，然后根据这些表的字段和名称，结合自己的系统用户，创建与之相同的视图。</li><li>利用 IdentityService 这个服务，当我们要操作自己的系统用户的时候，例如添加、更新、删除用户的时候，顺便调用 IdentityService 服务添加、更新、删除 flowable 中的用户。</li></ol><p>这两种思路其实都不难，也都很好实现，但是有没有可能我们就直接舍弃掉 flowable 中的用户体系直接用自己的用户体系呢？在松哥目前的项目中，这条路目前是行得通的，就是将 flowable 的用户体系抛到一边，当做没有，只用自己系统的用户体系。</p><blockquote><p>如果在读这篇文章的小伙伴中，有人在自己的系统中，有场景必须用到 flowable 自带的用户体系，欢迎留言讨论。</p></blockquote><p>本文松哥和小伙伴们展示的案例，就是完完全全使用了自己的用户体系，没有用 flowable 中的那一套用户体系。</p><p>好啦，这个问题捋清楚了，接下来我们就开搞！</p><h2 id="3-创建用户表"><a href="#3-创建用户表" class="headerlink" title="3. 创建用户表"></a>3. 创建用户表</h2><p>首先我们来创建三张表，分别是用户表 user、角色表 role 以及用户角色关联表 user_role，脚本如下：</p><figure class="highlight sql hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">SET</span> <span class="hljs-keyword">NAMES</span> utf8mb4;</span><br><span class="line"></span><br><span class="line"><span class="hljs-keyword">DROP</span> <span class="hljs-keyword">TABLE</span> <span class="hljs-keyword">IF</span> <span class="hljs-keyword">EXISTS</span> <span class="hljs-string">`role`</span>;</span><br><span class="line"></span><br><span class="line"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> <span class="hljs-string">`role`</span> (</span><br><span class="line">  <span class="hljs-string">`id`</span> <span class="hljs-built_in">int</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span> AUTO_INCREMENT,</span><br><span class="line">  <span class="hljs-string">`name`</span> <span class="hljs-built_in">varchar</span>(<span class="hljs-number">255</span>) <span class="hljs-keyword">COLLATE</span> utf8mb4_unicode_ci <span class="hljs-keyword">DEFAULT</span> <span class="hljs-literal">NULL</span>,</span><br><span class="line">  <span class="hljs-string">`nameZh`</span> <span class="hljs-built_in">varchar</span>(<span class="hljs-number">255</span>) <span class="hljs-keyword">COLLATE</span> utf8mb4_unicode_ci <span class="hljs-keyword">DEFAULT</span> <span class="hljs-literal">NULL</span>,</span><br><span class="line">  PRIMARY <span class="hljs-keyword">KEY</span> (<span class="hljs-string">`id`</span>)</span><br><span class="line">) <span class="hljs-keyword">ENGINE</span>=<span class="hljs-keyword">InnoDB</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">CHARSET</span>=utf8mb4 <span class="hljs-keyword">COLLATE</span>=utf8mb4_unicode_ci;</span><br><span class="line"></span><br><span class="line"><span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> <span class="hljs-string">`role`</span> (<span class="hljs-string">`id`</span>, <span class="hljs-string">`name`</span>, <span class="hljs-string">`nameZh`</span>)</span><br><span class="line"><span class="hljs-keyword">VALUES</span></span><br><span class="line">(<span class="hljs-number">1</span>,<span class="hljs-string">'manager'</span>,<span class="hljs-string">'经理'</span>),</span><br><span class="line">(<span class="hljs-number">2</span>,<span class="hljs-string">'team_leader'</span>,<span class="hljs-string">'组长'</span>);</span><br><span class="line"></span><br><span class="line"><span class="hljs-keyword">DROP</span> <span class="hljs-keyword">TABLE</span> <span class="hljs-keyword">IF</span> <span class="hljs-keyword">EXISTS</span> <span class="hljs-string">`user`</span>;</span><br><span class="line"></span><br><span class="line"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> <span class="hljs-string">`user`</span> (</span><br><span class="line">  <span class="hljs-string">`id`</span> <span class="hljs-built_in">int</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span> AUTO_INCREMENT,</span><br><span class="line">  <span class="hljs-string">`username`</span> <span class="hljs-built_in">varchar</span>(<span class="hljs-number">255</span>) <span class="hljs-keyword">COLLATE</span> utf8mb4_unicode_ci <span class="hljs-keyword">DEFAULT</span> <span class="hljs-literal">NULL</span>,</span><br><span class="line">  <span class="hljs-string">`password`</span> <span class="hljs-built_in">varchar</span>(<span class="hljs-number">255</span>) <span class="hljs-keyword">COLLATE</span> utf8mb4_unicode_ci <span class="hljs-keyword">DEFAULT</span> <span class="hljs-literal">NULL</span>,</span><br><span class="line">  PRIMARY <span class="hljs-keyword">KEY</span> (<span class="hljs-string">`id`</span>)</span><br><span class="line">) <span class="hljs-keyword">ENGINE</span>=<span class="hljs-keyword">InnoDB</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">CHARSET</span>=utf8mb4 <span class="hljs-keyword">COLLATE</span>=utf8mb4_unicode_ci;</span><br><span class="line"></span><br><span class="line"><span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> <span class="hljs-string">`user`</span> (<span class="hljs-string">`id`</span>, <span class="hljs-string">`username`</span>, <span class="hljs-string">`password`</span>)</span><br><span class="line"><span class="hljs-keyword">VALUES</span></span><br><span class="line">(<span class="hljs-number">1</span>,<span class="hljs-string">'javaboy'</span>,<span class="hljs-string">'&#123;noop&#125;123'</span>),</span><br><span class="line">(<span class="hljs-number">2</span>,<span class="hljs-string">'zhangsan'</span>,<span class="hljs-string">'&#123;noop&#125;123'</span>),</span><br><span class="line">(<span class="hljs-number">3</span>,<span class="hljs-string">'lisi'</span>,<span class="hljs-string">'&#123;noop&#125;123'</span>),</span><br><span class="line">(<span class="hljs-number">4</span>,<span class="hljs-string">'江南一点雨'</span>,<span class="hljs-string">'&#123;noop&#125;123'</span>);</span><br><span class="line"></span><br><span class="line"><span class="hljs-keyword">DROP</span> <span class="hljs-keyword">TABLE</span> <span class="hljs-keyword">IF</span> <span class="hljs-keyword">EXISTS</span> <span class="hljs-string">`user_role`</span>;</span><br><span class="line"></span><br><span class="line"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> <span class="hljs-string">`user_role`</span> (</span><br><span class="line">  <span class="hljs-string">`id`</span> <span class="hljs-built_in">int</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span> AUTO_INCREMENT,</span><br><span class="line">  <span class="hljs-string">`uid`</span> <span class="hljs-built_in">int</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-literal">NULL</span>,</span><br><span class="line">  <span class="hljs-string">`rid`</span> <span class="hljs-built_in">int</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-literal">NULL</span>,</span><br><span class="line">  PRIMARY <span class="hljs-keyword">KEY</span> (<span class="hljs-string">`id`</span>)</span><br><span class="line">) <span class="hljs-keyword">ENGINE</span>=<span class="hljs-keyword">InnoDB</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">CHARSET</span>=utf8mb4 <span class="hljs-keyword">COLLATE</span>=utf8mb4_unicode_ci;</span><br><span class="line"><span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> <span class="hljs-string">`user_role`</span> (<span class="hljs-string">`id`</span>, <span class="hljs-string">`uid`</span>, <span class="hljs-string">`rid`</span>)</span><br><span class="line"><span class="hljs-keyword">VALUES</span></span><br><span class="line">(<span class="hljs-number">1</span>,<span class="hljs-number">1</span>,<span class="hljs-number">1</span>),</span><br><span class="line">(<span class="hljs-number">2</span>,<span class="hljs-number">4</span>,<span class="hljs-number">1</span>),</span><br><span class="line">(<span class="hljs-number">3</span>,<span class="hljs-number">2</span>,<span class="hljs-number">2</span>),</span><br><span class="line">(<span class="hljs-number">4</span>,<span class="hljs-number">3</span>,<span class="hljs-number">2</span>);</span><br></pre></td></tr></table></figure><p>我也大概说下我的用户：</p><ol><li>一共四个用户，分别是 javaboy、江南一点雨、zhangsan、lisi。</li><li>一共两个角色，分别是经理和组长。</li><li>javaboy 和江南一点雨是经理，zhangsan 和 lisi 是组长。</li></ol><p>这就是我的用户表了。</p><h2 id="4-配置系统登录"><a href="#4-配置系统登录" class="headerlink" title="4. 配置系统登录"></a>4. 配置系统登录</h2><p>简单起见，我就不自己写系统登录页面了，简单配置一下 Spring Security 即可。</p><p>小伙伴们看到，第三小节中，我的用户密码用的是 <code>{noop}123</code>，这就表示我 Spring Security 加密方案用的是 DelegatingPasswordEncoder，Spring Security 原本默认的加密方案也是这个。不过当我们在项目中引入 flowable 的依赖 <code>flowable-spring-boot-starter</code> 之后，这个将 Spring Security 默认的 PasswordEncoder 改成了 NoOpPasswordEncoder，所以我需要首先在 applicaiton.properties 中重新指定 Spring Security 使用的 PasswordEncoder，配置方式如下：</p><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flowable.idm.password-encoder=spring_delegating</span><br></pre></td></tr></table></figure><p>接下来提供一个用户类（涉及到 Spring Security 基本用法的我就不啰嗦了）：</p><figure class="highlight java hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">User</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">UserDetails</span> </span>&#123;</span><br><span class="line">    <span class="hljs-keyword">private</span> Integer id;</span><br><span class="line">    <span class="hljs-keyword">private</span> String username;</span><br><span class="line">    <span class="hljs-keyword">private</span> String password;</span><br><span class="line">    <span class="hljs-keyword">private</span> List&lt;Role&gt; roles;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-meta">@Override</span></span><br><span class="line">    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">getUsername</span><span class="hljs-params">()</span> </span>&#123;</span><br><span class="line">        <span class="hljs-keyword">return</span> username;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-meta">@Override</span></span><br><span class="line">    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">isAccountNonExpired</span><span class="hljs-params">()</span> </span>&#123;</span><br><span class="line">        <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-meta">@Override</span></span><br><span class="line">    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">isAccountNonLocked</span><span class="hljs-params">()</span> </span>&#123;</span><br><span class="line">        <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-meta">@Override</span></span><br><span class="line">    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">isCredentialsNonExpired</span><span class="hljs-params">()</span> </span>&#123;</span><br><span class="line">        <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-meta">@Override</span></span><br><span class="line">    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">isEnabled</span><span class="hljs-params">()</span> </span>&#123;</span><br><span class="line">        <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="hljs-meta">@Override</span></span><br><span class="line">    <span class="hljs-keyword">public</span> Collection&lt;? extends GrantedAuthority&gt; getAuthorities() &#123;</span><br><span class="line">        <span class="hljs-keyword">if</span> (roles != <span class="hljs-keyword">null</span> &amp;&amp; roles.size() &gt; <span class="hljs-number">0</span>) &#123;</span><br><span class="line">            <span class="hljs-keyword">return</span> roles.stream().map(r -&gt; <span class="hljs-keyword">new</span> SimpleGrantedAuthority(r.getName())).collect(Collectors.toList());</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-meta">@Override</span></span><br><span class="line">    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">getPassword</span><span class="hljs-params">()</span> </span>&#123;</span><br><span class="line">        <span class="hljs-keyword">return</span> password;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="hljs-comment">//省略其他 getter/setter</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>提供一个自己的 UserDetailsService，如下：</p><figure class="highlight java hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-meta">@Service</span></span><br><span class="line"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyUserDetailsService</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">UserDetailsService</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-meta">@Autowired</span></span><br><span class="line">    UserMapper userMapper;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-meta">@Override</span></span><br><span class="line">    <span class="hljs-function"><span class="hljs-keyword">public</span> UserDetails <span class="hljs-title">loadUserByUsername</span><span class="hljs-params">(String username)</span> <span class="hljs-keyword">throws</span> UsernameNotFoundException </span>&#123;</span><br><span class="line">        User user = userMapper.loadUserByUsername(username);</span><br><span class="line">        <span class="hljs-keyword">if</span> (user != <span class="hljs-keyword">null</span>) &#123;</span><br><span class="line">            user.setRoles(userMapper.getUserRolesByUserId(user.getId()));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="hljs-keyword">return</span> user;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>一些基本的增删改查我就不展示了，这个 MyUserDetailsService 只需要注册到 Spring 容器中即可，也不需要额外的配置。</p><p>最后再简单配置一下 Spring Security，关闭掉 CSRF 攻击防御机制，否则将来的 POST 请求处理起来会比较麻烦：</p><figure class="highlight java hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-meta">@Configuration</span></span><br><span class="line"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SecurityConfig</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-meta">@Bean</span></span><br><span class="line">    <span class="hljs-function">SecurityFilterChain <span class="hljs-title">securityFilterChain</span><span class="hljs-params">(HttpSecurity http)</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        http.csrf().disable();</span><br><span class="line">        http</span><br><span class="line">                .authorizeRequests()</span><br><span class="line">                .anyRequest().authenticated()</span><br><span class="line">                .and()</span><br><span class="line">                .formLogin();</span><br><span class="line">        <span class="hljs-keyword">return</span> http.build();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>好啦，有了这些东西之后，以后再访问系统就必须得先登录才能访问了。</p><h2 id="5-修改流程图"><a href="#5-修改流程图" class="headerlink" title="5. 修改流程图"></a>5. 修改流程图</h2><p>接下来我们的流程图要改一下。</p><p>我们先来回顾一下<a href="https://mp.weixin.qq.com/s/QEXceZ0KmDKFMcYq-B4Wkg" target="_blank" rel="noopener">上篇文章</a>中的流程图：</p><p><img src="http://img.itboyhub.com/2021/10/tran/20220808211237.png" alt></p><p>大家看到，在这张图中，有两个 UserTask（就是有用户图标的那个），在<a href="https://mp.weixin.qq.com/s/QEXceZ0KmDKFMcYq-B4Wkg" target="_blank" rel="noopener">上篇文章</a>中，请假审批组固定是 managers（也就是说，如果用户属于 managers 这个组，就具备审批别人请假的权限），但是现在我们引入了用户体系，用户在提交请假申请的时候，用户可以指定自己的请假申请由谁审批！所以这个地方不能再硬编码了，应该改为动态的，根据前端传来的参数，来设置这个 UserTask 应该由谁来处理，具体修改内容如下：</p><figure class="highlight xml hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-tag">&lt;<span class="hljs-name">userTask</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"approveTask"</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"Approve or reject request"</span>&gt;</span></span><br><span class="line">    <span class="hljs-tag">&lt;<span class="hljs-name">extensionElements</span>&gt;</span></span><br><span class="line">        <span class="hljs-tag">&lt;<span class="hljs-name">flowable:taskListener</span> <span class="hljs-attr">event</span>=<span class="hljs-string">"create"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"org.javaboy.flowable03.listener.SettingApproveUser"</span>/&gt;</span></span><br><span class="line">    <span class="hljs-tag">&lt;/<span class="hljs-name">extensionElements</span>&gt;</span></span><br><span class="line"><span class="hljs-tag">&lt;/<span class="hljs-name">userTask</span>&gt;</span></span><br></pre></td></tr></table></figure><p>小伙伴们看到，我这里为这个 UserTask 添加了一个监听器，当系统执行到这个监听器的时候，我将在这个监听器中来设置这个 UserTask 由谁来处理，我们来看下这个监听器的内容：</p><figure class="highlight java hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SettingApproveUser</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">TaskListener</span> </span>&#123;</span><br><span class="line">    <span class="hljs-meta">@Override</span></span><br><span class="line">    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">notify</span><span class="hljs-params">(DelegateTask delegateTask)</span> </span>&#123;</span><br><span class="line">        String approveType = (String) delegateTask.getVariable(<span class="hljs-string">"approveType"</span>);</span><br><span class="line">        <span class="hljs-keyword">if</span> (<span class="hljs-string">"by_user"</span>.equals(approveType)) &#123;</span><br><span class="line">            delegateTask.setAssignee((String) delegateTask.getVariable(<span class="hljs-string">"approveUser"</span>));</span><br><span class="line">        &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-string">"by_role"</span>.equals(approveType)) &#123;</span><br><span class="line">            Object approveRole = delegateTask.getVariable(<span class="hljs-string">"approveRole"</span>);</span><br><span class="line">            delegateTask.addCandidateGroup((String) approveRole);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>小伙伴们看到，这里涉及到了三个变量，分别是：</p><ul><li>approveType：这个表示审批的类型，是指定一个审批人还是指定一个审批角色，其中 by_user 表示指定一个具体的审批人，by_role 表示指定一个审批角色。</li><li>approveUser：如果 approveType 的值是 by_user，那么就调用 setAssignee 来设置这个 UserTask 的处理人。</li><li>approveRole：如果 approveType 的值是 by_role，那么就调用 addCandidateGroup 方法来设置这个 UserTask 的候选组，也就是这个 UserTask 将来由这个组中的用户进行处理。</li></ul><p>流程图中的第二个 UserTask 我们也改一下，不过这次只改一下名字，将来通过这个变量来传递一下流程的审批人即可，修改后的 UserTask 如下：</p><figure class="highlight xml hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-tag">&lt;<span class="hljs-name">userTask</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"holidayApprovedTask"</span> <span class="hljs-attr">flowable:assignee</span>=<span class="hljs-string">"$&#123;approveUser&#125;"</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"Holiday approved"</span>/&gt;</span></span><br></pre></td></tr></table></figure><blockquote><p>不过这个地方改不改其实都行，改一下更容易理解一些。</p></blockquote><p>好啦，流程图我们现在就调整好啦。</p><p>接下来我们就来看具体功能的实现了。</p><h2 id="6-提交请假申请"><a href="#6-提交请假申请" class="headerlink" title="6. 提交请假申请"></a>6. 提交请假申请</h2><h3 id="6-1-页面设计"><a href="#6-1-页面设计" class="headerlink" title="6.1 页面设计"></a>6.1 页面设计</h3><p>先来看看页面，选择审批人：</p><p><img src="http://img.itboyhub.com/2022/08/20220818210723.png" alt></p><p>也可以选择审批角色：</p><p><img src="http://img.itboyhub.com/2022/08/20220818210809.png" alt></p><p>从数据库中加载所有用户和角色，这个比较简单，我就不贴代码了，大家在公众号江南一点雨后台回复 flowable03 可以下载本文源代码。</p><p>基于上面展示的页面，当前端点击提交请假申请按钮的时候，我们提交的数据如下：</p><figure class="highlight js hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">afl: &#123;</span><br><span class="line">    days: <span class="hljs-number">3</span>,</span><br><span class="line">    reason: <span class="hljs-string">'休息一下'</span>,</span><br><span class="line">    approveType: <span class="hljs-string">'by_user'</span>,</span><br><span class="line">    approveUser: <span class="hljs-string">''</span>,</span><br><span class="line">    approveRole: <span class="hljs-string">''</span>,</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure><p>approveType 表示审批人的类型，by_user 是提交给一个具体的人，by_role 是提交给某一个角色。approveUser 和 approveRole 则表示具体的审批人或者审批角色，根据 approveType 的取值，后面这两个二选一。请求提交方法如下：</p><figure class="highlight js hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">submit() &#123;</span><br><span class="line">    <span class="hljs-keyword">let</span> _this = <span class="hljs-keyword">this</span>;</span><br><span class="line">    axios.post(<span class="hljs-string">'/ask_for_leave'</span>, <span class="hljs-keyword">this</span>.afl)</span><br><span class="line">        .then(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">response</span>) </span>&#123;</span><br><span class="line">            <span class="hljs-keyword">if</span> (response.data.status == <span class="hljs-number">200</span>) &#123;</span><br><span class="line">                <span class="hljs-comment">//提交成功</span></span><br><span class="line">                _this.$message.success(response.data.msg);</span><br><span class="line">                _this.search();</span><br><span class="line">            &#125; <span class="hljs-keyword">else</span> &#123;</span><br><span class="line">                <span class="hljs-comment">//提交失败</span></span><br><span class="line">                _this.$message.error(response.data.msg);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">        .catch(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">error</span>) </span>&#123;</span><br><span class="line">            <span class="hljs-built_in">console</span>.log(error);</span><br><span class="line">        &#125;);</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure><p>如果请求提交成功，就调用 <code>_this.search();</code> 方法去刷新一下历史请假列表。</p><p>前端比较简单，不啰嗦了。</p><h3 id="6-2-后台处理"><a href="#6-2-后台处理" class="headerlink" title="6.2 后台处理"></a>6.2 后台处理</h3><p>再来看看后端的处理。</p><p>先来看实体类 AskForLeaveVO，这个类用来接收前端传来的请假参数：</p><figure class="highlight java hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">AskForLeaveVO</span> </span>&#123;</span><br><span class="line">    <span class="hljs-keyword">private</span> String name;</span><br><span class="line">    <span class="hljs-keyword">private</span> Integer days;</span><br><span class="line">    <span class="hljs-keyword">private</span> String reason;</span><br><span class="line">    <span class="hljs-keyword">private</span> String approveType;</span><br><span class="line">    <span class="hljs-keyword">private</span> String approveUser;</span><br><span class="line">    <span class="hljs-keyword">private</span> String approveRole;</span><br><span class="line">    <span class="hljs-comment">// 省略 getter/setter</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>再来看看请假接口的处理：</p><figure class="highlight java hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-meta">@PostMapping</span>(<span class="hljs-string">"/ask_for_leave"</span>)</span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">public</span> RespBean <span class="hljs-title">askForLeave</span><span class="hljs-params">(@RequestBody AskForLeaveVO askForLeaveVO)</span> </span>&#123;</span><br><span class="line">    <span class="hljs-keyword">return</span> askForLeaveService.askForLeave(askForLeaveVO);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>来看一下对应的 askForLeaveService#askForLeave 方法：</p><figure class="highlight java hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-meta">@Transactional</span></span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">public</span> RespBean <span class="hljs-title">askForLeave</span><span class="hljs-params">(AskForLeaveVO askForLeaveVO)</span> </span>&#123;</span><br><span class="line">    Map&lt;String, Object&gt; variables = <span class="hljs-keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">    askForLeaveVO.setName(SecurityContextHolder.getContext().getAuthentication().getName());</span><br><span class="line">    variables.put(<span class="hljs-string">"name"</span>, askForLeaveVO.getName());</span><br><span class="line">    variables.put(<span class="hljs-string">"days"</span>, askForLeaveVO.getDays());</span><br><span class="line">    variables.put(<span class="hljs-string">"reason"</span>, askForLeaveVO.getReason());</span><br><span class="line">    variables.put(<span class="hljs-string">"approveType"</span>, askForLeaveVO.getApproveType());</span><br><span class="line">    variables.put(<span class="hljs-string">"approveUser"</span>, askForLeaveVO.getApproveUser());</span><br><span class="line">    variables.put(<span class="hljs-string">"approveRole"</span>, askForLeaveVO.getApproveRole());</span><br><span class="line">    <span class="hljs-keyword">try</span> &#123;</span><br><span class="line">        runtimeService.startProcessInstanceByKey(<span class="hljs-string">"holidayRequest"</span>, askForLeaveVO.getName(), variables);</span><br><span class="line">        <span class="hljs-keyword">return</span> RespBean.ok(<span class="hljs-string">"已提交请假申请"</span>);</span><br><span class="line">    &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="hljs-keyword">return</span> RespBean.error(<span class="hljs-string">"提交申请失败"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>大家注意，这里提交请假的用户的用户名，不再是前端传来的，而是我们从当前登录用户中提取出来的。</p><p>当我们在这里启动流程之后，会自动执行到第 5 小节所说的那个 UserTask 中，并在监听器中为 UserTask 设置处理的用户或者角色。</p><h2 id="7-历史请假列表"><a href="#7-历史请假列表" class="headerlink" title="7. 历史请假列表"></a>7. 历史请假列表</h2><p>这个在我们<a href="https://mp.weixin.qq.com/s/QEXceZ0KmDKFMcYq-B4Wkg" target="_blank" rel="noopener">上篇文章</a>的案例中，是用户手动输入要查询的用户名，然后去查询的，现在有了登录系统之后，用户登录成功之后，系统就知道当前用户是谁了，直接根据当前登录用户名去查询历史流程信息就可以了，如下：</p><figure class="highlight java hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-function"><span class="hljs-keyword">public</span> RespBean <span class="hljs-title">searchResult</span><span class="hljs-params">()</span> </span>&#123;</span><br><span class="line">    String name = SecurityContextHolder.getContext().getAuthentication().getName();</span><br><span class="line">    List&lt;HistoryInfo&gt; infos = <span class="hljs-keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">    List&lt;HistoricProcessInstance&gt; historicProcessInstances = historyService.createHistoricProcessInstanceQuery().processInstanceBusinessKey(name)</span><br><span class="line">            .orderByProcessInstanceStartTime().desc().list();</span><br><span class="line">    <span class="hljs-keyword">for</span> (HistoricProcessInstance historicProcessInstance : historicProcessInstances) &#123;</span><br><span class="line">        HistoryInfo historyInfo = <span class="hljs-keyword">new</span> HistoryInfo();</span><br><span class="line">        historyInfo.setStatus(<span class="hljs-number">3</span>);</span><br><span class="line">        Date startTime = historicProcessInstance.getStartTime();</span><br><span class="line">        Date endTime = historicProcessInstance.getEndTime();</span><br><span class="line">        List&lt;HistoricVariableInstance&gt; historicVariableInstances = historyService.createHistoricVariableInstanceQuery()</span><br><span class="line">                .processInstanceId(historicProcessInstance.getId())</span><br><span class="line">                .list();</span><br><span class="line">        <span class="hljs-keyword">for</span> (HistoricVariableInstance historicVariableInstance : historicVariableInstances) &#123;</span><br><span class="line">            String variableName = historicVariableInstance.getVariableName();</span><br><span class="line">            Object value = historicVariableInstance.getValue();</span><br><span class="line">            <span class="hljs-keyword">if</span> (<span class="hljs-string">"reason"</span>.equals(variableName)) &#123;</span><br><span class="line">                historyInfo.setReason((String) value);</span><br><span class="line">            &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-string">"days"</span>.equals(variableName)) &#123;</span><br><span class="line">                historyInfo.setDays(Integer.parseInt(value.toString()));</span><br><span class="line">            &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-string">"approved"</span>.equals(variableName)) &#123;</span><br><span class="line">                Boolean v = (Boolean) value;</span><br><span class="line">                <span class="hljs-keyword">if</span> (v) &#123;</span><br><span class="line">                    historyInfo.setStatus(<span class="hljs-number">1</span>);</span><br><span class="line">                &#125;<span class="hljs-keyword">else</span>&#123;</span><br><span class="line">                    historyInfo.setStatus(<span class="hljs-number">2</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-string">"name"</span>.equals(variableName)) &#123;</span><br><span class="line">                historyInfo.setName((String) value);</span><br><span class="line">            &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-string">"approveUser"</span>.equals(variableName)) &#123;</span><br><span class="line">                historyInfo.setApproveUser((String) value);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        historyInfo.setStartTime(startTime);</span><br><span class="line">        historyInfo.setEndTime(endTime);</span><br><span class="line">        infos.add(historyInfo);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="hljs-keyword">return</span> RespBean.ok(<span class="hljs-string">"ok"</span>, infos);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>这里代码量虽然有点多，但是其实很好理解，就是我们先获取到当前登录的用户名，以这个用户名作为 BusinessKey 去查询所有的流程，包括已经执行结束和未结束的流程，然后再更进一步查询这些流程的变量信息。</p><p>对于一个已经执行结束的流程而言，流程变量中包含有 approved（这是审批的时候传入的），approved 的值无外乎就是 true 或者 false，对于一个尚未审批的流程而言，也就是还没执行结束的流程而言，流程变量中不含有 approved，所以在上面这段代码中，我首先设置 historyInfo 的 status 值为 3 表示流程未审批，将来要是读到了 approved 的值，那就据实设置 status 为 1 表示流程审批通过，设置 status 为 2 表示流程审批未通过。</p><p>前端在 el-table 表格中显示的时候，也是根据 status 的值分别展示不同的内容。</p><h2 id="8-待审批列表"><a href="#8-待审批列表" class="headerlink" title="8. 待审批列表"></a>8. 待审批列表</h2><p>这个是查看当前登录用户需要审批的任务，在<a href="https://mp.weixin.qq.com/s/QEXceZ0KmDKFMcYq-B4Wkg" target="_blank" rel="noopener">上篇文章</a>的案例中，我们是用户手动输入一个用户名，然后查询这个用户需要审批的任务列表。</p><p>现在不用这么麻烦了，用户登录成功之后，就可以直接查询当前用户的待审批的任务列表了：</p><figure class="highlight java hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-meta">@GetMapping</span>(<span class="hljs-string">"/list"</span>)</span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">public</span> RespBean <span class="hljs-title">leaveList</span><span class="hljs-params">()</span> </span>&#123;</span><br><span class="line">    <span class="hljs-keyword">return</span> askForLeaveService.leaveList();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>来看下具体的查询方法：</p><figure class="highlight java hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment">/**</span></span><br><span class="line"><span class="hljs-comment"> * 待审批列表</span></span><br><span class="line"><span class="hljs-comment"> *</span></span><br><span class="line"><span class="hljs-comment"> * <span class="hljs-doctag">@return</span></span></span><br><span class="line"><span class="hljs-comment"> */</span></span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">public</span> RespBean <span class="hljs-title">leaveList</span><span class="hljs-params">()</span> </span>&#123;</span><br><span class="line">    String identity = SecurityContextHolder.getContext().getAuthentication().getName();</span><br><span class="line">    <span class="hljs-comment">//找到所有分配给你的任务</span></span><br><span class="line">    List&lt;Task&gt; tasks = taskService.createTaskQuery().taskAssignee(identity).list();</span><br><span class="line">    <span class="hljs-comment">//找到所有分配给你所属角色的任务</span></span><br><span class="line">    Collection&lt;? extends GrantedAuthority&gt; authorities = SecurityContextHolder.getContext().getAuthentication().getAuthorities();</span><br><span class="line">    <span class="hljs-keyword">for</span> (GrantedAuthority authority : authorities) &#123;</span><br><span class="line">        tasks.addAll(taskService.createTaskQuery().taskCandidateGroup(authority.getAuthority()).list());</span><br><span class="line">    &#125;</span><br><span class="line">    List&lt;Map&lt;String, Object&gt;&gt; list = <span class="hljs-keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; tasks.size(); i++) &#123;</span><br><span class="line">        Task task = tasks.get(i);</span><br><span class="line">        Map&lt;String, Object&gt; variables = taskService.getVariables(task.getId());</span><br><span class="line">        variables.put(<span class="hljs-string">"id"</span>, task.getId());</span><br><span class="line">        list.add(variables);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="hljs-keyword">return</span> RespBean.ok(<span class="hljs-string">"加载成功"</span>, list);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>这个查询分两步：</p><ol><li>根据当前登录用户的名字查询这个用户需要处理的任务。</li><li>根据当前登录用户的角色查询这个角色需要处理的任务。</li></ol><p>最后将查询到的结果合并到一起，返回给前端就完事了。</p><p>好了，到此，我们的改造基本上就完成了。我主要是和大家说了实现的思路，具体的一些代码细节，大家可以在公众号江南一点雨后台回复 <code>flowable03</code> 下载。</p><h2 id="9-测试"><a href="#9-测试" class="headerlink" title="9. 测试"></a>9. 测试</h2><p>来个简单的测试吧。</p><p>首先，zhangsan 登录，登录之后提交一个请假申请，要求经理审批：</p><p><img src="http://img.itboyhub.com/2022/08/20220818213725.png" alt></p><p>可以看到，提交请假申请之后，下面的<strong>历史请假列表</strong>中就会展示出刚刚提交的请假申请，并且状态为待审批。</p><p>接下来注销登录，用 javaboy 或者江南一点雨登录，因为这两个用户都是经理，所以他俩中任意一个登录，都可以看到 zhangsan 刚刚提交的请假审批，以江南一点雨登录为例：</p><p><img src="http://img.itboyhub.com/2022/08/20220818213948.png" alt></p><p>可以看到，最下面的列表中有 zhangsan 刚刚提交的请假申请，点击批准，然后再以 zhangsan 的身份重新登录，如下：</p><p><img src="http://img.itboyhub.com/2022/08/20220818214100.png" alt></p><p>可以看到，请假已经审批通过啦～</p><p>好啦，本文就先和小伙伴们分享这么多，flowable 将来我也会录制一些视频放在 TienChin 项目中，感兴趣的小伙伴戳戳戳这里：<a href="https://mp.weixin.qq.com/s/uiX_p-e3MNFSyvV21CTk8w" target="_blank" rel="noopener">TienChin 项目配套视频来啦</a>。</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;[TOC]&lt;/p&gt;
&lt;p&gt;之前松哥发过一篇文章，和小伙伴们分享了 Spring Boot+Vue+Flowable 的具体玩法，传送门：&lt;/p&gt;
    
    </summary>
    
      <category term="TienChin" scheme="http://www.javaboy.org/categories/TienChin/"/>
    
    
      <category term="TienChin" scheme="http://www.javaboy.org/tags/TienChin/"/>
    
      <category term="Flowable" scheme="http://www.javaboy.org/tags/Flowable/"/>
    
  </entry>
  
  <entry>
    <title>好久没有送签名书了，来十本~</title>
    <link href="http://www.javaboy.org/2022/0818/springsecurity-book.html"/>
    <id>http://www.javaboy.org/2022/0818/springsecurity-book.html</id>
    <published>2022-08-18T11:40:36.000Z</published>
    <updated>2022-12-19T11:54:14.092Z</updated>
    
    <content type="html"><![CDATA[<p>松哥今年基本上都是每周送一次书的频率，不过都是送别人的书，已经忘了上次送我的签名书是啥时候了~</p><a id="more"></a><p>所以，这次跟清华大学出版社专门要了 20 本《深入浅出 Spring Security》送给大家，分两次送，这次先来十本！</p><p><img src="http://img.itboyhub.com/2021/02/20210309142654.png" alt></p><p>《深入浅出 Spring Security》这本书是松哥 2021.3 月份在清华大学出版社出版的，这本书主要是系统的和大家讲述了 Spring Security 的各种用法以及相关的源码分析，不仅有 Spring Security 常见用法，也有各种常见的请求攻击以及相应的防御策略。这本书可以说是 Spring Security 从入门到精通不可多得的系统性资料。</p><p>随着 Spring Boot 和 Spring Cloud 的普及，Spring Security 也逐渐受到重视，Spring Boot 和 Spring Cloud 的很多安全管理场景里，使用 Spring Security 的方便程度要远远高于使用 Shiro。</p><p>然而，很多时候，由于项目比较赶或者自己本身比较忙的原因，有的小伙伴用 Spring Security 可能是东一榔头西一棒，面向搜索引擎编程，需要什么东西现场搜一下，搜到了再发挥 CV 神技，项目功能完成了就完事了，再也不管了。</p><p>这样做，虽然功能实现了，但是具体是怎么实现的，其实并不清楚，而且如果出 BUG，基本上手足无措，不知道该如何解决 BUG。此时，系统学习的重要性就凸显出来了，如果我们系统的掌握了 Spring Security，那么公司项目无论需要什么样的安全管理功能，我们都能信手拈来，不再需要面向搜索引擎编程，遇到问题，也不再恐慌，仔细分析就能解决。就像现在有小伙伴在微信上问我 Spring Security 相关的问题，无论什么问题都不怵，大不了 DEBUG，走一遍源码就知道什么问题了，这就是系统学习的好处。</p><blockquote><p>当然，我这里是以 Spring Security 为例，实际上，小伙伴们在学习任何东西的时候，都建议系统化学习。系统化学习一般来说就两种路子：看书或者看官网。如果是一个自己之前从未接触过的新玩意，建议先看视频了解个大概，知道基本用法，然后再看书或者官网系统化学习。</p></blockquote><p>看书的好处是书是中文的，对英文不好的小伙伴来说，书是比较友好的；看官网的好处是官网永远是最新的。</p><p>当然，最重要的是，无论看什么，你得先动起来！千万别在看书还是看官网上纠结半年。</p><p>好了，不废话了，小伙伴们留言说说你为什么需要这本书，松哥会从留言的小伙伴中选出来十位幸运小伙伴，《深入浅出 Spring Security》包邮到家！</p><p>当然，也可以直接扫码下单：</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;松哥今年基本上都是每周送一次书的频率，不过都是送别人的书，已经忘了上次送我的签名书是啥时候了~&lt;/p&gt;
    
    </summary>
    
      <category term="Spring Security" scheme="http://www.javaboy.org/categories/Spring-Security/"/>
    
    
      <category term="TienChin" scheme="http://www.javaboy.org/tags/TienChin/"/>
    
      <category term="Spring Security" scheme="http://www.javaboy.org/tags/Spring-Security/"/>
    
  </entry>
  
  <entry>
    <title>种草 Vue3 中几个好玩的插件和配置</title>
    <link href="http://www.javaboy.org/2022/0817/vue3-plugins.html"/>
    <id>http://www.javaboy.org/2022/0817/vue3-plugins.html</id>
    <published>2022-08-17T11:40:17.000Z</published>
    <updated>2022-12-19T11:53:10.452Z</updated>
    
    <content type="html"><![CDATA[<p>小伙伴们知道 TienChin 项目前端用的是 Vue3，当我们把 Vue3 官网刷了一遍之后回来看 TienChin 项目的前端，发现还是有很多不太一样的地方，今天松哥就来和大家捋一捋 Vue3 中几个好玩的插件和配置，学完之后，相信大家对 TienChin 项目前端的很多写法就明白了。</p><a id="more"></a><h2 id="1-Vite"><a href="#1-Vite" class="headerlink" title="1. Vite"></a>1. Vite</h2><p>首先来给大家介绍一下 Vite，虽然这在 Vue3 中并不是必须的，但是考虑到 TienChin 项目前端用了这个，还是给大家稍微说两句。</p><p>Vite（法语意为 “快速的”，发音 /vit/，发音同 “veet”）是一种新型前端构建工具，能够显著提升前端开发体验。它主要由两部分组成：</p><ol><li>一个开发服务器，它基于 原生 ES 模块 提供了 丰富的内建功能，如速度快到惊人的 模块热更新（HMR）。</li><li>一套构建指令，它使用 Rollup 打包你的代码，并且它是预配置的，可输出用于生产环境的高度优化过的静态资源。</li></ol><p>Vite 意在提供开箱即用的配置，同时它的插件 API 和 JavaScript API 带来了高度的可扩展性，并有完整的类型支持。</p><p>如果小伙伴们绝得陌生，那么不妨回忆下我们之前在 vhr 中给大家介绍的 Webpack，其实这个 Vite 相当于就是 Webpack。相比于 Webpack 的传统工具，Vite 最大的特点就是<strong>快</strong>。</p><p>Vite 通过在一开始将应用中的模块区分为<strong>依赖</strong>和<strong>源码</strong>两类，改进了开发服务器启动时间，因为依赖变化小而源码才是经常会变的东西。</p><p>不知道小伙伴们看到这里有没有想到我们 Java 中也有一个类似的玩意，那就是 Spring Boot 热加载。</p><blockquote><p>Spring Boot 的热加载中用到了两个类加载器：一个是 base classloader，专门用来加载一些第三方的类；还有一个是 restart classloader，专门用来加载我们自己写的类。热加载的时候，只需要 restart classloader 工作即可。</p></blockquote><p>好了，对于我们 Java 工程师来说，大家知道 Vite 是一个项目构建工具就可以了，接下来的例子我要通过 Vite 来和大家演示。</p><h2 id="2-自动导入常见方法"><a href="#2-自动导入常见方法" class="headerlink" title="2. 自动导入常见方法"></a>2. 自动导入常见方法</h2><p>在 TienChin 项目中，小伙伴们看到，很多原本需要导入之后才能用的方法，竟然都不需要导入就可以使用。</p><p>我创建一个项目来给大家演示看下。</p><p>我们用 Vite 来构建一个项目。</p><p>如果你的 npm 版本是 6.x，那么执行如下命令创建一个 Vue3 工程：</p><figure class="highlight shell hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm create vite@latest my-vue-app --template vue</span><br></pre></td></tr></table></figure><p>如果你的 npm 版本是 7+，那么执行如下命令创建一个 Vue3 工程：</p><figure class="highlight shell hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm create vite@latest my-vue-app -- --template vue</span><br></pre></td></tr></table></figure><p>这个 Vue 工程创建成功之后，没有 router 啥的，需要我们自己安装上，这个常规操作我就不多说了。</p><h3 id="2-1-传统写法"><a href="#2-1-传统写法" class="headerlink" title="2.1 传统写法"></a>2.1 传统写法</h3><p>现在我举一个简单的例子，比如说在 MyVue01 这个页面上有一个按钮，点击之后，可以跳转到 MyVue02 这个页面，那么我们的点击事件可以按照如下的方式来写：</p><figure class="highlight js hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;script setup&gt;</span><br><span class="line">    <span class="hljs-keyword">import</span> &#123;useRouter&#125; <span class="hljs-keyword">from</span> <span class="hljs-string">'vue-router'</span>;</span><br><span class="line">    <span class="hljs-keyword">const</span> router = useRouter();</span><br><span class="line">    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">go</span>(<span class="hljs-params"></span>) </span>&#123;</span><br><span class="line">        router.push(<span class="hljs-string">"/my02"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&lt;<span class="hljs-regexp">/script&gt;</span></span><br></pre></td></tr></table></figure><p>首先我们需要从 vue-router 中导入 useRouter 函数，然后调用该函数可以获取到 router 对象，再调用 router 中的 push 方法就可以完成页面跳转了。</p><p>以前在 Vue2 中，我们一般都是通过 this.$router 来获取到 router 对象，然后通过 router 对象来实现页面导航操作。但是在 Vue3 中，没有 this 了，不过 Vue3 中提供了一个 getCurrentInstance 方法来获取当前 Vue 实例，所以页面跳转，我们也可以按照下面这种方式来写：</p><figure class="highlight js hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;script setup&gt;</span><br><span class="line">    <span class="hljs-keyword">import</span> &#123;getCurrentInstance&#125; <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-keyword">const</span> &#123;proxy&#125; = getCurrentInstance();</span><br><span class="line"></span><br><span class="line">    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">go</span>(<span class="hljs-params"></span>) </span>&#123;</span><br><span class="line">        proxy.$router.push(<span class="hljs-string">"/my02"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&lt;<span class="hljs-regexp">/script&gt;</span></span><br></pre></td></tr></table></figure><p>这里的 proxy 就类似于以前 Vue2 中的 this。</p><p>松哥这里是以 router 为例来和大家演示，如果是 Vuex/Pinia，也有类似的写法，我就不挨个演示了。</p><p>无论是上面那种写法，都需要首先导入一个函数，然后才能开始使用。然而我们在 TienChin 项目的前端代码中，虽然也有导入，但是像上面这两个例子中导入都是没有的，那是怎么回事？</p><p>这就借助于一个自动导入的工具了。</p><h3 id="2-2-自动导入"><a href="#2-2-自动导入" class="headerlink" title="2.2 自动导入"></a>2.2 自动导入</h3><p>前端有一个工具插件叫做 <code>unplugin-auto-import</code>，通过这个插件可以实现一些方法的自动导入。该方法的使用步骤如下：</p><ol><li>安装插件：</li></ol><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i unplugin-auto-import -D</span><br></pre></td></tr></table></figure><p>由于这个插件只是一个开发辅助工具而已，所以安装的时候加上 -D 参数，这样就会安装到 devDependencies 中了。</p><ol start="2"><li>配置插件：</li></ol><p>插件的配置是在项目根目录下的 vite.config.js 文件中进行配置的，内容如下：</p><figure class="highlight js hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">import</span> &#123;defineConfig&#125; <span class="hljs-keyword">from</span> <span class="hljs-string">'vite'</span></span><br><span class="line"><span class="hljs-keyword">import</span> vue <span class="hljs-keyword">from</span> <span class="hljs-string">'@vitejs/plugin-vue'</span></span><br><span class="line"><span class="hljs-keyword">import</span> AutoImport <span class="hljs-keyword">from</span> <span class="hljs-string">'unplugin-auto-import/vite'</span></span><br><span class="line"></span><br><span class="line"><span class="hljs-comment">// https://vitejs.dev/config/</span></span><br><span class="line"><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> defineConfig(&#123;</span><br><span class="line">    plugins: [vue(), AutoImport(&#123;</span><br><span class="line">        <span class="hljs-comment">// 可以自定义文件生成的位置，默认是根目录下，使用ts的建议放src目录下</span></span><br><span class="line">        <span class="hljs-comment">// dts: 'src/auto-imports.d.ts',</span></span><br><span class="line">        imports: [<span class="hljs-string">'vue'</span>,<span class="hljs-string">'vue-router'</span>]</span><br><span class="line">    &#125;)]</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>小伙伴们注意注释掉的代码，这个插件配置好之后，启动项目，默认会在 <code>node_modules/unplugin-auto-import/auto-imports.d.ts</code> 位置生成一个文件，但是配置 dts 属性可以修改这个文件生成的位置。</p><p>imports 则是指需要自动导入的方法都是哪里的方法，以我们前文中的两个案例为例，useRouter 是 vue-router 中的方法，getCurrentInstance 方法则是 vue 中的，所以这里导入我选择了 vue 和 vue-router，当然，小伙伴们在开发中，如果有需要，也可以导入 Vuex/Pinia 等。</p><p>配置好了插件之后，我们当我们再次需要使用上面那些方法的时候，就不需要导入了，直接用即可：</p><figure class="highlight js hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;script setup&gt;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-keyword">const</span> &#123;proxy&#125; = getCurrentInstance();</span><br><span class="line"></span><br><span class="line">    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">go</span>(<span class="hljs-params"></span>) </span>&#123;</span><br><span class="line">        proxy.$router.push(<span class="hljs-string">"/my02"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&lt;<span class="hljs-regexp">/script&gt;</span></span><br></pre></td></tr></table></figure><p>useRouter 也不需要导入了。</p><figure class="highlight js hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;script setup&gt;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-keyword">const</span> router = useRouter();</span><br><span class="line">    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">go</span>(<span class="hljs-params"></span>) </span>&#123;</span><br><span class="line">        router.push(<span class="hljs-string">"/my02"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&lt;<span class="hljs-regexp">/script&gt;</span></span><br></pre></td></tr></table></figure><p>以后，凡是 vue 和 vue-router 中的方法都是不需要导入就可以使用了，其他组件中的方法则还是跟以前一样，必须导入之后才可以使用。</p><h2 id="3-组件去后缀"><a href="#3-组件去后缀" class="headerlink" title="3. 组件去后缀"></a>3. 组件去后缀</h2><p>以前在 Vue2 中，我们导入组件的时候，可能都习惯省略 <code>.vue</code> 后缀，毕竟用 WebStorm 开发的时候，系统自动导入的时候也会帮我们省略掉这个后缀，写法类似下面这样：</p><figure class="highlight js hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">import</span> MyVue01 <span class="hljs-keyword">from</span> <span class="hljs-string">"../views/MyVue01"</span>;</span><br><span class="line"><span class="hljs-keyword">import</span> MyVue02 <span class="hljs-keyword">from</span> <span class="hljs-string">"../views/MyVue02"</span>;</span><br></pre></td></tr></table></figure><p>但是现在在 Vite 中，如果还是这样写就会报错，类似下面这样：</p><p><img src="http://img.itboyhub.com/2021/10/tran/20220810220740.png" alt></p><p>现在必须要写后缀了，但是有的人就是不习惯写后缀，那怎么办？我们可以在 vite.config.js 中添加如下配置，这样就可以不用写 <code>.vue</code>、<code>.js</code> 等后缀了。</p><figure class="highlight js hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">import</span> &#123;defineConfig&#125; <span class="hljs-keyword">from</span> <span class="hljs-string">'vite'</span></span><br><span class="line"><span class="hljs-keyword">import</span> vue <span class="hljs-keyword">from</span> <span class="hljs-string">'@vitejs/plugin-vue'</span></span><br><span class="line"><span class="hljs-keyword">import</span> AutoImport <span class="hljs-keyword">from</span> <span class="hljs-string">'unplugin-auto-import/vite'</span></span><br><span class="line"></span><br><span class="line"><span class="hljs-comment">// https://vitejs.dev/config/</span></span><br><span class="line"><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> defineConfig(&#123;</span><br><span class="line">    plugins: [vue(), AutoImport(&#123;</span><br><span class="line">        <span class="hljs-comment">// 可以自定义文件生成的位置，默认是根目录下，使用ts的建议放src目录下</span></span><br><span class="line">        <span class="hljs-comment">// dts: 'src/auto-imports.d.ts',</span></span><br><span class="line">        imports: [<span class="hljs-string">'vue'</span>,<span class="hljs-string">'vue-router'</span>]</span><br><span class="line">    &#125;)],</span><br><span class="line">    resolve: &#123;</span><br><span class="line">        extensions: [<span class="hljs-string">'.js'</span>, <span class="hljs-string">'.ts'</span>, <span class="hljs-string">'.jsx'</span>, <span class="hljs-string">'.tsx'</span>, <span class="hljs-string">'.json'</span>, <span class="hljs-string">'.vue'</span>]</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>好了，现在大家明白了为什么 TienChin 项目前端都不写 <code>.vue</code> 了吧。</p><h2 id="4-name-属性问题"><a href="#4-name-属性问题" class="headerlink" title="4. name 属性问题"></a>4. name 属性问题</h2><p>以前在 Vue2 中，我们可以通过如下方式给一个 Vue 组件设置名称：</p><figure class="highlight js hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">    <span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> &#123;</span><br><span class="line">        name: <span class="hljs-string">"MyVue03"</span>,</span><br><span class="line">        mounted() &#123;</span><br><span class="line">            <span class="hljs-built_in">console</span>.log(<span class="hljs-string">"MyVue03"</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&lt;<span class="hljs-regexp">/script&gt;</span></span><br></pre></td></tr></table></figure><p>在 Vue3 中，我们如果将 setup 写到 script 节点中的话，就没法定义 name 了，如果还需要使用 name 属性的话，那么可以再定义一个 script 节点，专门用来配置 name 属性，如下：</p><figure class="highlight js hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&lt;script setup&gt;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-keyword">import</span> &#123;useRouter&#125; <span class="hljs-keyword">from</span> <span class="hljs-string">'vue-router'</span>;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-keyword">const</span> router = useRouter();</span><br><span class="line"></span><br><span class="line">    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">go</span>(<span class="hljs-params"></span>) </span>&#123;</span><br><span class="line">        router.push(<span class="hljs-string">"/my02"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&lt;<span class="hljs-regexp">/script&gt;</span></span><br><span class="line"><span class="hljs-regexp"></span></span><br><span class="line"><span class="hljs-regexp">&lt;script&gt;</span></span><br><span class="line"><span class="hljs-regexp">    export default &#123;</span></span><br><span class="line"><span class="hljs-regexp">        name: "JavaboyVue"</span></span><br><span class="line"><span class="hljs-regexp">    &#125;</span></span><br><span class="line"><span class="hljs-regexp">&lt;/</span>script&gt;</span><br></pre></td></tr></table></figure><p>提示，我们在调试页面中，就可以看到自定义的组件名了：</p><p><img src="http://img.itboyhub.com/2021/10/tran/20220811194842.png" alt></p><p>不过这种写法多多少还是有点费事。</p><p>通过 <code>vite-plugin-vue-setup-extend</code> 插件可以简化在 Vue3 中设置 name 属性，安装该插件之后，我们就可以直接在 script 节点中定义 name 属性的值了，安装方式如下：</p><figure class="highlight shell hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install vite-plugin-vue-setup-extend -D</span><br></pre></td></tr></table></figure><p>装好之后，在 vite.config.js 中再进行配置一下，如下：</p><figure class="highlight js hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">import</span> &#123;defineConfig&#125; <span class="hljs-keyword">from</span> <span class="hljs-string">'vite'</span></span><br><span class="line"><span class="hljs-keyword">import</span> vue <span class="hljs-keyword">from</span> <span class="hljs-string">'@vitejs/plugin-vue'</span></span><br><span class="line"><span class="hljs-keyword">import</span> AutoImport <span class="hljs-keyword">from</span> <span class="hljs-string">'unplugin-auto-import/vite'</span></span><br><span class="line"><span class="hljs-keyword">import</span> VueSetupExtend <span class="hljs-keyword">from</span> <span class="hljs-string">'vite-plugin-vue-setup-extend'</span></span><br><span class="line"></span><br><span class="line"><span class="hljs-comment">// https://vitejs.dev/config/</span></span><br><span class="line"><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> defineConfig(&#123;</span><br><span class="line">    plugins: [</span><br><span class="line">        vue(),</span><br><span class="line">        AutoImport(&#123;</span><br><span class="line">            <span class="hljs-comment">// 可以自定义文件生成的位置，默认是根目录下，使用ts的建议放src目录下</span></span><br><span class="line">            <span class="hljs-comment">// dts: 'src/auto-imports.d.ts',</span></span><br><span class="line">            imports: [<span class="hljs-string">'vue'</span>, <span class="hljs-string">'vue-router'</span>]</span><br><span class="line">        &#125;),</span><br><span class="line">        VueSetupExtend()</span><br><span class="line">    ],</span><br><span class="line">    resolve: &#123;</span><br><span class="line">        extensions: [<span class="hljs-string">'.js'</span>, <span class="hljs-string">'.ts'</span>, <span class="hljs-string">'.jsx'</span>, <span class="hljs-string">'.tsx'</span>, <span class="hljs-string">'.json'</span>, <span class="hljs-string">'.vue'</span>]</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>VueSetupExtend 就是 <code>vite-plugin-vue-setup-extend</code> 插件的配置。</p><p>配置完成后，我们就可以通过如下方式来定义 name 属性了：</p><figure class="highlight js hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;script setup name=<span class="hljs-string">"JavaboyVue"</span>&gt;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-keyword">import</span> &#123;useRouter&#125; <span class="hljs-keyword">from</span> <span class="hljs-string">'vue-router'</span>;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-keyword">const</span> router = useRouter();</span><br><span class="line"></span><br><span class="line">    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">go</span>(<span class="hljs-params"></span>) </span>&#123;</span><br><span class="line">        router.push(<span class="hljs-string">"/my02"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&lt;<span class="hljs-regexp">/script&gt;</span></span><br></pre></td></tr></table></figure><p>直接在 script 节点中加一个 name 属性就行了。</p><p>好啦，今天就先和大家介绍这么多吧～TienChin 项目的前端还用到一个 VueUse 工具，这个松哥后面再抽空和大家介绍～</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;小伙伴们知道 TienChin 项目前端用的是 Vue3，当我们把 Vue3 官网刷了一遍之后回来看 TienChin 项目的前端，发现还是有很多不太一样的地方，今天松哥就来和大家捋一捋 Vue3 中几个好玩的插件和配置，学完之后，相信大家对 TienChin 项目前端的很多写法就明白了。&lt;/p&gt;
    
    </summary>
    
      <category term="TienChin" scheme="http://www.javaboy.org/categories/TienChin/"/>
    
    
      <category term="TienChin" scheme="http://www.javaboy.org/tags/TienChin/"/>
    
      <category term="Vue3" scheme="http://www.javaboy.org/tags/Vue3/"/>
    
  </entry>
  
  <entry>
    <title>49张图带领小伙伴们体验一把 Flowable-UI</title>
    <link href="http://www.javaboy.org/2022/0815/flowable-ui.html"/>
    <id>http://www.javaboy.org/2022/0815/flowable-ui.html</id>
    <published>2022-08-15T11:40:04.000Z</published>
    <updated>2022-12-19T11:53:18.134Z</updated>
    
    <content type="html"><![CDATA[<p>不知道小伙伴们有没发发现，IDEA 中似乎没有一个特别称手的流程绘制工具，大家注意我说的是称手，不是能用。</p><a id="more"></a><p>我之前用过下图这个插件：</p><p><img src="http://img.itboyhub.com/2021/10/tran/20220813213904.png" alt></p><p>评价就是两个字：能用！</p><p>官方提供了一个 flowable-ui，功能还比较强大，可以一试，今天我就来和小伙伴们简单介绍一下这个 flowable-ui 的使用，用熟了，将来我们可以使用这个来绘制流程图。</p><h2 id="1-Flowable-UI"><a href="#1-Flowable-UI" class="headerlink" title="1. Flowable-UI"></a>1. Flowable-UI</h2><p>Flowable-UI 说白了就是一堆 Web 应用，提供了四方面的功能：</p><ul><li>Flowable IDM: 身份管理应用。为所有 Flowable UI 应用提供单点登录认证功能，并且为拥有 IDM 管理员权限的用户提供了管理用户、组与权限的功能。</li><li>Flowable Modeler: 让具有建模权限的用户可以创建流程模型、表单、选择表与应用定义。</li><li>Flowable Task: 运行时任务应用，这个提供了启动流程实例、编辑任务表单、完成任务，以及查询流程实例与任务的功能。</li><li>Flowable Admin: 管理应用。让具有管理员权限的用户可以查询 BPMN、DMN、Form 及 Content 引擎，并提供了许多选项用于修改流程实例、任务、作业等。管理应用通过 REST API 连接至引擎，并与 Flowable Task 应用及 Flowable REST 应用一同部署。</li></ul><p>简单来说：</p><ul><li>创建用户、分配角色用 Flowable IDM。</li><li>画流程图用户 Flowable Modeler。</li><li>测试、体验流程用 Flowable Task。</li><li>后台管理相关的用 Flowable Admin。</li></ul><h2 id="2-安装方式"><a href="#2-安装方式" class="headerlink" title="2. 安装方式"></a>2. 安装方式</h2><p>前面说的几个应用，所有其他的应用都需要 Flowable IDM 提供认证。每个应用的 WAR 文件可以部署在相同的 Servlet 容器（如Apache Tomcat）中，也可以部署在不同的容器中。由于每个应用使用相同的 cookie 进行认证，因此应用需要运行在相同的域名下。</p><p>由于这些应用是基于 Spring Boot2.0 开发的，因此也可以直接作为独立应用来直接运行，通过执行 <code>java -jar xxx.war</code> 的方式来启动这些应用。</p><p>所以直接启动这些应用并不是麻烦事，反而是比较简单的。不过我看了下他这个还支持 Docker 安装，所以我还是用 Docker 吧，更省事，将来不想要了删除也方便（对 Docker 不熟悉的小伙伴可以在微信公众号后台回复 docker，有松哥写的入门教程）。</p><p>docker 安装的话，直接如下命令即可：</p><figure class="highlight shell hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -d --name flowableui -p 8086:8080 flowable/flowable-ui</span><br></pre></td></tr></table></figure><p>没什么特别需要配置的地方，指定一下容器名字和端口映射即可。</p><p><img src="http://img.itboyhub.com/2021/10/tran/20220814122352.png" alt></p><p>装好之后，浏览器输入 <code>http://localhost:8086/flowable-ui</code> 进行访问，此时会弹出来如下页面：</p><p><img src="http://img.itboyhub.com/2021/10/tran/20220814122546.png" alt></p><p>默认情况下，登录的用户名是 admin，密码是 test，注意别把密码写错了。</p><p>登录成功之后，如果看到如下页面，就表示安装成功了（一般来说应该不会有安装问题）：</p><p><img src="http://img.itboyhub.com/2021/10/tran/20220814122652.png" alt></p><p>装好之后，接下来我们就来逐步体验这里的功能，我从简单的开始讲起。</p><h2 id="3-身份管理（IDM）"><a href="#3-身份管理（IDM）" class="headerlink" title="3. 身份管理（IDM）"></a>3. 身份管理（IDM）</h2><p>身份管理就是用户、用户组的管理，我们点进到身份管理页面之后，可以看到如下内容：</p><p><img src="http://img.itboyhub.com/2021/10/tran/20220814123210.png" alt></p><p>可以看到，默认只有一个 admin 用户，也就是我们刚刚登录时候的用户。</p><h3 id="3-1-用户管理"><a href="#3-1-用户管理" class="headerlink" title="3.1 用户管理"></a>3.1 用户管理</h3><p>接下来点击左边的创建用户按钮，我们可以创建新的用户出来：</p><p><img src="http://img.itboyhub.com/2021/10/tran/20220814123341.png" alt></p><p>填入用户的基本信息和密码即可。</p><p>我一共创建了四个用户，最终结果如下：</p><p><img src="http://img.itboyhub.com/2021/10/tran/20220814123521.png" alt></p><h3 id="3-2-组管理"><a href="#3-2-组管理" class="headerlink" title="3.2 组管理"></a>3.2 组管理</h3><p>接下来点击上面的<strong>组</strong>，我们可以创建用户组，这个用户组相当于我们在 vhr 中所说的角色，给用户分组，相当于给用户分配一个角色。</p><p>默认情况下，没有任何组，组是空的：</p><p><img src="http://img.itboyhub.com/2021/10/tran/20220814123700.png" alt></p><p>我们点击创建组按钮，先来创建一个经理组：</p><p><img src="http://img.itboyhub.com/2021/10/tran/20220814123814.png" alt></p><p>组添加成功之后，点击添加用户按钮，为用户组中添加用户：</p><p><img src="http://img.itboyhub.com/2021/10/tran/20220814123905.png" alt></p><p>假设 zhangsan 和 zhangsi 两个人是经理，最终添加结果如下：</p><p><img src="http://img.itboyhub.com/2021/10/tran/20220814124014.png" alt></p><p>利用相同的方式，我再创建一个组长的组，并为之添加两个用户 lisi 和 liwu。</p><p><img src="http://img.itboyhub.com/2021/10/tran/20220814124400.png" alt></p><h3 id="3-3-权限控制"><a href="#3-3-权限控制" class="headerlink" title="3.3 权限控制"></a>3.3 权限控制</h3><p>我们前面创建的用户现在是没有任何权限的，例如现在如果使用 zhangsan/123 进行登录，登录成功后页面是空的，没有任何东西：</p><p><img src="http://img.itboyhub.com/2021/10/tran/20220814124657.png" alt></p><p>所以我们要为用户添加相应的权限。点击顶部的权限控制一栏，如下：</p><p><img src="http://img.itboyhub.com/2021/10/tran/20220814164138.png" alt></p><p>我们可以为这五种访问分别设置对应的用户/用户组：</p><ul><li>访问 idm 应用：这个就是访问身份管理应用，如果用户没有访问这个的权限，那么用户在登录成功的后的首页上就看不到身份管理应用程序这个菜单项。</li><li>访问 admin 应用：这个是访问管理员应用程式，如果没有没有这个的访问权限，那么用户在登录成功之后的首页上就看不到管理员应用程式这个菜单项。</li><li>访问 modeler 应用：这个是访问建模器应用程序，如果没有没有这个的访问权限，那么用户在登录成功之后的首页上就看不到建模器应用程序这个菜单项。</li><li>访问 workflow 应用：这个是访问任务应用程序，如果没有没有这个的访问权限，那么用户在登录成功之后的首页上就看不到任务应用程序这个菜单项。</li><li>访问 REST API：这个是指用户通过 REST API 访问工作流的权限。</li></ul><p>以访问 idm 应用为例，在设置的时候，我们可以直接设置用户，也可以设置用户组，设置用户组的话，则这个组中的所有用户都能访问这个菜单项。</p><p><img src="http://img.itboyhub.com/2021/10/tran/20220814164852.png" alt></p><p>我这里设置的是经理可以访问所有应用，而组长只可以访问 workflow 应用。</p><p><img src="http://img.itboyhub.com/2021/10/tran/20220814165425.png" alt></p><h2 id="4-管理员（Admin）"><a href="#4-管理员（Admin）" class="headerlink" title="4. 管理员（Admin）"></a>4. 管理员（Admin）</h2><p>接下来是管理员应用程式，这个里边的功能相对来说简单一些，而且主要是数据查看，需要自己配置的比较少：</p><p><img src="http://img.itboyhub.com/2021/10/tran/20220814165835.png" alt></p><p>这是一个总览的页面，上面有流程引擎、CMMN引擎、App 引擎等各种菜单。这个因为用的不多，我也就不啰嗦了，小伙伴们可以自行体验一把。</p><h2 id="5-建模器（Modeler）"><a href="#5-建模器（Modeler）" class="headerlink" title="5. 建模器（Modeler）"></a>5. 建模器（Modeler）</h2><p>接下来的建模器算是我们在使用 Flowable-UI 时最最常用的功能了，因为画流程图就是在这里画。</p><h3 id="5-1-绘制流程图"><a href="#5-1-绘制流程图" class="headerlink" title="5.1 绘制流程图"></a>5.1 绘制流程图</h3><p><img src="http://img.itboyhub.com/2021/10/tran/20220814170304.png" alt></p><p>点击创建流程，可以开始一个流程图的绘制：</p><p><img src="http://img.itboyhub.com/2021/10/tran/20220814170449.png" alt></p><p>我们来看一下初始页面：</p><p><img src="http://img.itboyhub.com/2021/10/tran/20220814170559.png" alt></p><p>左边是菜单栏，里边是绘制流程图的各种组件，下边是流程图的各种属性了。其他东西大家看一下就懂了，我就不多说了。下边没有什么需要配置的，我就设置了一下版本号。</p><p>接下来我绘制一个简单的流程，如下图（一个流程启动之后，经过两个 UserTask 然后就结束了）：</p><p><img src="http://img.itboyhub.com/2021/10/tran/20220814171300.png" alt></p><p>绘制的时候，光标放在上一个组件上，然后会自动提示后面的组件，直接点击即可：</p><p><img src="http://img.itboyhub.com/2021/10/tran/20220814171422.png" alt></p><p>如果想要的组件没有提示，那么就只能在左边菜单中寻找，找到之后拖过来就行了。</p><p>这两个流程中的 UserTask 节点我也不做额外的设置，就设置一下每一个 UserTask 应该由谁来处理就可以了。假设第一个节点是组长来处理，第二个节点是经理处理，我们来看如何配置。</p><p>选中第一个 UserTask 之后，然后在下方找到分配用户，设置任务分配人：</p><p><img src="http://img.itboyhub.com/2021/10/tran/20220814172137.png" alt></p><blockquote><p>另外我这里啰嗦一句，每一个组件都需要设置组件的主键 ID（下方的第一个属性），当然也可以不设置，不设置这里会自动生成一个随机字符串，当然随机生成的可读性肯定是不如自己设置的可读性好了。</p></blockquote><p>大家看到有四种不同的用户选项，我这里选择候选组，也就是将来由指定的用户组中的用户来处理这一个任务：</p><p><img src="http://img.itboyhub.com/2021/10/tran/20220814172621.png" alt></p><p>选择完成之后，点击保存按钮：</p><p><img src="http://img.itboyhub.com/2021/10/tran/20220814172949.png" alt></p><p>利用相同的方式，给第二个 UserTask 也设置由经理进行处理。</p><p>好了，我们就绘制这样一个简单流程。</p><p>绘制完成后，点击左上角的勾进行检查，查看是流程图绘制是否正确，有的时候流程节点之间的连线起点和终点可能并没有放入正确的位置，肉眼不容易看到，点击左上角的勾可以帮我们检查一下。</p><p><img src="http://img.itboyhub.com/2021/10/tran/20220814173446.png" alt></p><p><img src="http://img.itboyhub.com/2021/10/tran/20220814173505.png" alt></p><p>验证完成没有问题，点击左上角的保存按钮对当前流程图进行保存。</p><p>保存完成后，就可以在流程首页看到我们刚刚绘制的流程图了：</p><p><img src="http://img.itboyhub.com/2021/10/tran/20220814173623.png" alt></p><p>点击流程图就可以查看流程图的详情，点击右上角的下载按钮，就可以下载这个流程图对应的 XML 文件了，将 XML 文件拷贝到我们的项目中，就可以开始开发啦。</p><p><img src="http://img.itboyhub.com/2021/10/tran/20220814173755.png" alt></p><h3 id="5-2-发布应用程序"><a href="#5-2-发布应用程序" class="headerlink" title="5.2 发布应用程序"></a>5.2 发布应用程序</h3><p>当然，我们也可以直接现场测试我们刚刚绘制好的流程图。</p><p>点击上方的应用程序，点击右上方的创建应用程序：</p><p><img src="http://img.itboyhub.com/2021/10/tran/20220814175648.png" alt></p><p>配置应用程序的基本信息：</p><p><img src="http://img.itboyhub.com/2021/10/tran/20220814175741.png" alt></p><p>点击编辑包含的模型，为当前应用程序添加一个流程图：</p><p><img src="http://img.itboyhub.com/2021/10/tran/20220814175845.png" alt></p><p><img src="http://img.itboyhub.com/2021/10/tran/20220814175939.png" alt></p><p>完成后点击左上角的保存按钮。</p><p>保存之后，我们就可以看到刚刚定义好的应用程序了：</p><p><img src="http://img.itboyhub.com/2021/10/tran/20220814180026.png" alt></p><p>点进到这个应用程序中，点击右上角的发布按钮，可以发布该应用程序。</p><p><img src="http://img.itboyhub.com/2021/10/tran/20220814180124.png" alt></p><p>发布之后，我们就可以在任务应用程序中来玩这个程序了。</p><h2 id="6-任务（Task）"><a href="#6-任务（Task）" class="headerlink" title="6. 任务（Task）"></a>6. 任务（Task）</h2><p>经过前面的步骤之后，现在我们重新回到主页面，就可以发现除了刚刚一开始默认的四个菜单之外，现在还额外多了一个，就是我们刚刚新建的应用程序：</p><p><img src="http://img.itboyhub.com/2021/10/tran/20220814180420.png" alt></p><p>我们可以直接点击 my_first_app 进入到任务应用程序中，也可以先进入到任务应用程序中，然后选择 my_first_app，都行。我以后者为例和大家演示一下吧：</p><p>首先进来之后，默认情况下是没有要执行的任务：</p><p><img src="http://img.itboyhub.com/2021/10/tran/20220814180557.png" alt></p><p>点击到流程中，如下：</p><p><img src="http://img.itboyhub.com/2021/10/tran/20220814180719.png" alt></p><p>默认情况下，也是没有正在执行的流程，我们现在可以点击启动流程按钮，来启动一个新的流程：</p><p><img src="http://img.itboyhub.com/2021/10/tran/20220814180818.png" alt></p><p>点击启动流程按钮之后，左边会展示出来所有的流程实例，我们现在只有一个发布的流程，所以选中该流程，点击右边的启动流程按钮：</p><p><img src="http://img.itboyhub.com/2022/08/20220814181951.png" alt></p><p>启动流程之后，点击显示图，可以查看流程走到哪一步了：</p><p><img src="http://img.itboyhub.com/2022/08/20220814182240.png" alt></p><p>点击活动任务，查看自己需要完成的任务。点击之后发现并没有需要完成的任务：</p><p><img src="http://img.itboyhub.com/2022/08/20220814182324.png" alt></p><p>这是因为当前用户是 admin，而我们流程中第一个 UserTask 应该是由组长来处理的，所以我们现在注销登录，先以 zhangsan 的身份登录，因为 zhangsan 的角色是经理，所以他登录上来应该也是没有任务的：</p><p><img src="http://img.itboyhub.com/2022/08/20220814182640.png" alt></p><p>注意在筛选条件中选择我是其中一个候选人的任务（还是没有）：</p><p><img src="http://img.itboyhub.com/2022/08/20220814184328.png" alt></p><p>再以 lisi 的身份登录，lisi 是组长，如下（也记得修改一下筛选条件）：</p><p><img src="http://img.itboyhub.com/2022/08/20220814184515.png" alt></p><p>先点击认领按钮，认领该任务，然后点击完成按钮，完成自己的审批：</p><p><img src="http://img.itboyhub.com/2022/08/20220814184646.png" alt></p><p>完成之后，然后点击到流程中，然后点击左上角的显示图，如下：</p><p><img src="http://img.itboyhub.com/2022/08/20220814184721.png" alt></p><p><img src="http://img.itboyhub.com/2022/08/20220814184816.png" alt></p><p>此时可以看到，流程已经向后走了一步了。</p><p>接下来该经理审批了。</p><p>我们注销登录，再以 zhangsan 的身份登录，然后重复 lisi 的步骤，就可以完成这个流程了。</p><p>最终执行结果如下图：</p><p><img src="http://img.itboyhub.com/2022/08/20220814185503.png" alt></p><p>流程执行完毕。</p><blockquote><p>如果流程中涉及到排他性网关，似乎里无法测试，如果有小伙伴知道这里如何测试带有排他性网关的流程，欢迎留言告知。</p></blockquote><h2 id="7-小结"><a href="#7-小结" class="headerlink" title="7. 小结"></a>7. 小结</h2><p>今天的图有点多，希望小伙伴们对 flowable-ui 这个工具有一个基本的认知，好啦，有问题欢迎留言讨论。</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;不知道小伙伴们有没发发现，IDEA 中似乎没有一个特别称手的流程绘制工具，大家注意我说的是称手，不是能用。&lt;/p&gt;
    
    </summary>
    
      <category term="TienChin" scheme="http://www.javaboy.org/categories/TienChin/"/>
    
    
      <category term="TienChin" scheme="http://www.javaboy.org/tags/TienChin/"/>
    
      <category term="Flowable" scheme="http://www.javaboy.org/tags/Flowable/"/>
    
  </entry>
  
  <entry>
    <title>SpringBoot+Vue+Flowable，模拟一个请假审批流程！</title>
    <link href="http://www.javaboy.org/2022/0810/flowable-ask-for-leave.html"/>
    <id>http://www.javaboy.org/2022/0810/flowable-ask-for-leave.html</id>
    <published>2022-08-10T11:39:46.000Z</published>
    <updated>2022-12-19T11:53:22.807Z</updated>
    
    <content type="html"><![CDATA[<p>小伙伴们知道松哥最近在录 TienChin 项目视频，这个项目会用到工作流，为了帮助小伙伴们更好的理解这个项目，松哥最近会出几篇文章和大伙聊一聊工作流 flowable 的使用，算是给 TienChin 项目的第一个铺垫，当然，在 TienChin 项目的系列视频中，我也会和大家详细聊一聊 flowable 流程引擎的使用。</p><a id="more"></a><p>今天我就先写一个简单的请假流程，让小伙伴们对 flowable 先有一个直观的认知。</p><h2 id="1-效果展示"><a href="#1-效果展示" class="headerlink" title="1. 效果展示"></a>1. 效果展示</h2><p>在正式开搞之前，我先来给小伙伴们看下我们今天要完成的效果。</p><p>简单起见，我这里并没有引入用户、角色等概念，涉及到用户的地方都是手动输入，在后续的文章中我会继续结合 Spring Security 来和大家展示引入用户之后的情况。</p><p>我们先来看看请假页面：</p><p><img src="http://img.itboyhub.com/2021/10/tran/20220808205124.png" alt></p><p>员工可以在这个页面输入姓名，请假天数以及请假理由等，然后点击按钮提交一个请假申请。</p><p>当员工提交请假申请之后，这个请假申请默认是由经理来处理的，此时经理登录之后，就可以看到员工提交上来的请求：</p><p><img src="http://img.itboyhub.com/2021/10/tran/20220808205402.png" alt></p><p>经理此时可以选择批准或者拒绝。无论是批准还是拒绝，都可以通过短信或者邮件等告知员工。</p><p>对于员工来说，也可以在一个页面查询自己请假流程的最终情况：</p><p><img src="http://img.itboyhub.com/2021/10/tran/20220808205620.png" alt></p><p>可能有小伙伴已经注意到了，我们这里所有涉及到用户名的地方，都需要手动输入。这是因为我为了让这个案例足够简单，暂时没有引入 Spring Security，只是单纯的和大家分享 Flowable 的用法，等小伙伴们通过这篇文章掌握了 Flowable 的基本用法之后，下篇文章我会和大家分享如何结合具体的用户来使用。</p><h2 id="2-工程创建"><a href="#2-工程创建" class="headerlink" title="2. 工程创建"></a>2. 工程创建</h2><p>我就直接来和小伙伴们展示 Spring Boot 中 flowable 的用法了。</p><p>首先我们创建一个 Spring Boot 项目，创建的时候引入 Web 和 MySQL 驱动依赖即可，项目创建成功之后，再引入 flowable 依赖，最终的依赖文件如下：</p><figure class="highlight xml hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span></span><br><span class="line">    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span></span><br><span class="line">    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span></span><br><span class="line"><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span></span><br><span class="line"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span></span><br><span class="line">    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.flowable<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span></span><br><span class="line">    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>flowable-spring-boot-starter<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>6.7.2<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span></span><br><span class="line"><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span></span><br><span class="line"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span></span><br><span class="line">    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>mysql<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span></span><br><span class="line">    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>mysql-connector-java<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>runtime<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span></span><br><span class="line"><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>项目创建成功之后，首先需要我们在 application.properties 中配置一下数据库连接信息，如下：</p><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">spring.datasource.username=root</span><br><span class="line">spring.datasource.password=123</span><br><span class="line">spring.datasource.url=jdbc:mysql:///flowable02?serverTimezone=Asia/Shanghai&amp;useSSL=false&amp;nullCatalogMeansCurrent=true</span><br></pre></td></tr></table></figure><p>配置完成之后，当 Spring Boot 项目第一次启动的时候，会自动创建出来对应的表和需要的数据。</p><p>同时，Spring Boot 项目也会自动创建并暴露 Flowable 中的 ProcessEngine、CmmnEngine、DmnEngine、FormEngine、ContentEngine 及 IdmEngine 等 Bean。</p><p>并且所有的 Flowable 服务都暴露为 Spring Bean。例如 RuntimeService、TaskService、HistoryService 等等服务，我们都可以在需要使用的时候，直接注入就可以使用了。</p><p>同时：</p><ul><li>resources/processes 目录下的任何 BPMN 2.0 流程定义都会被自动部署，所以在 Spring Boot 项目中，我们只需要将自己的流程文件放对位置即可，剩下的事情就会自动完成。</li><li>cases 目录下的任何 CMMN 1.1 事例都会被自动部署。</li><li>forms 目录下的任何 Form 定义都会被自动部署。</li></ul><h2 id="3-流程图分析"><a href="#3-流程图分析" class="headerlink" title="3. 流程图分析"></a>3. 流程图分析</h2><p>今天这个例子比较简单，就是一个请假流程，我暂时先不跟小伙伴们去扯画流程图的事，咱们直接用一个官网现成的请假流程图：</p><p><img src="http://img.itboyhub.com/2021/10/tran/20220808211237.png" alt></p><p>我们先来简单分析一下这张图：</p><ol><li>最左侧的圆圈叫做启动事件(start event)，这表示一个流程实例的起点。</li><li>一个流程启动之后，首先到达第一个有用户图标的矩形中，这个矩形称为一个 User Task，在这个 User Task 中，经理可以选择批准亦或者拒绝。</li><li>UserTask 的下一步是一个菱形，这个称作排他网关（Exclusive Gateway）,这个会将请求路由到不同的地方。</li><li>先说批准，如果在第一个矩形中，经理选择了批准，那么就会进入到一个带有齿轮图标的矩形中，在这个矩形中我们我们可以额外做一些事情，然后又会调用到一个 UserTask，最终完成整个流程。</li><li>如果经理选择了拒绝，则会进入到下面的发邮件的矩形中，在这个中我们可以给员工发送一个通知，告知他请假没有通过。</li><li>当系统走到最右边的圆圈之后，就表示这个流程执行结束了。</li></ol><p>这个流程图对应的 XML 文件位于 src/main/resources/processes/holiday-request.bpmn20.xml 位置，其内容如下：</p><figure class="highlight xml hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="hljs-tag">&lt;<span class="hljs-name">definitions</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">"http://www.omg.org/spec/BPMN/20100524/MODEL"</span> <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="hljs-tag">             <span class="hljs-attr">xmlns:flowable</span>=<span class="hljs-string">"http://flowable.org/bpmn"</span></span></span><br><span class="line"><span class="hljs-tag">             <span class="hljs-attr">typeLanguage</span>=<span class="hljs-string">"http://www.w3.org/2001/XMLSchema"</span> <span class="hljs-attr">expressionLanguage</span>=<span class="hljs-string">"http://www.w3.org/1999/XPath"</span></span></span><br><span class="line"><span class="hljs-tag">             <span class="hljs-attr">targetNamespace</span>=<span class="hljs-string">"http://www.flowable.org/processdef"</span>&gt;</span></span><br><span class="line">    <span class="hljs-tag">&lt;<span class="hljs-name">process</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"holidayRequest"</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"Holiday Request"</span> <span class="hljs-attr">isExecutable</span>=<span class="hljs-string">"true"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="hljs-tag">&lt;<span class="hljs-name">startEvent</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"startEvent"</span>/&gt;</span></span><br><span class="line">        <span class="hljs-tag">&lt;<span class="hljs-name">sequenceFlow</span> <span class="hljs-attr">sourceRef</span>=<span class="hljs-string">"startEvent"</span> <span class="hljs-attr">targetRef</span>=<span class="hljs-string">"approveTask"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="hljs-tag">&lt;<span class="hljs-name">userTask</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"approveTask"</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"Approve or reject request"</span> <span class="hljs-attr">flowable:candidateGroups</span>=<span class="hljs-string">"managers"</span>/&gt;</span></span><br><span class="line">        <span class="hljs-tag">&lt;<span class="hljs-name">sequenceFlow</span> <span class="hljs-attr">sourceRef</span>=<span class="hljs-string">"approveTask"</span> <span class="hljs-attr">targetRef</span>=<span class="hljs-string">"decision"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="hljs-tag">&lt;<span class="hljs-name">exclusiveGateway</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"decision"</span>/&gt;</span></span><br><span class="line">        <span class="hljs-tag">&lt;<span class="hljs-name">sequenceFlow</span> <span class="hljs-attr">sourceRef</span>=<span class="hljs-string">"decision"</span> <span class="hljs-attr">targetRef</span>=<span class="hljs-string">"externalSystemCall"</span>&gt;</span></span><br><span class="line">            <span class="hljs-tag">&lt;<span class="hljs-name">conditionExpression</span> <span class="hljs-attr">xsi:type</span>=<span class="hljs-string">"tFormalExpression"</span>&gt;</span></span><br><span class="line">                &lt;![CDATA[</span><br><span class="line">          $&#123;approved&#125;</span><br><span class="line">        ]]&gt;</span><br><span class="line">            <span class="hljs-tag">&lt;/<span class="hljs-name">conditionExpression</span>&gt;</span></span><br><span class="line">        <span class="hljs-tag">&lt;/<span class="hljs-name">sequenceFlow</span>&gt;</span></span><br><span class="line">        <span class="hljs-tag">&lt;<span class="hljs-name">sequenceFlow</span>  <span class="hljs-attr">sourceRef</span>=<span class="hljs-string">"decision"</span> <span class="hljs-attr">targetRef</span>=<span class="hljs-string">"rejectLeave"</span>&gt;</span></span><br><span class="line">            <span class="hljs-tag">&lt;<span class="hljs-name">conditionExpression</span> <span class="hljs-attr">xsi:type</span>=<span class="hljs-string">"tFormalExpression"</span>&gt;</span></span><br><span class="line">                &lt;![CDATA[</span><br><span class="line">          $&#123;!approved&#125;</span><br><span class="line">        ]]&gt;</span><br><span class="line">            <span class="hljs-tag">&lt;/<span class="hljs-name">conditionExpression</span>&gt;</span></span><br><span class="line">        <span class="hljs-tag">&lt;/<span class="hljs-name">sequenceFlow</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="hljs-tag">&lt;<span class="hljs-name">serviceTask</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"externalSystemCall"</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"Enter holidays in external system"</span></span></span><br><span class="line"><span class="hljs-tag">                     <span class="hljs-attr">flowable:class</span>=<span class="hljs-string">"org.javaboy.flowable02.flowable.Approve"</span>/&gt;</span></span><br><span class="line">        <span class="hljs-tag">&lt;<span class="hljs-name">sequenceFlow</span> <span class="hljs-attr">sourceRef</span>=<span class="hljs-string">"externalSystemCall"</span> <span class="hljs-attr">targetRef</span>=<span class="hljs-string">"holidayApprovedTask"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="hljs-tag">&lt;<span class="hljs-name">userTask</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"holidayApprovedTask"</span> <span class="hljs-attr">flowable:assignee</span>=<span class="hljs-string">"$&#123;employee&#125;"</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"Holiday approved"</span>/&gt;</span></span><br><span class="line">        <span class="hljs-tag">&lt;<span class="hljs-name">sequenceFlow</span> <span class="hljs-attr">sourceRef</span>=<span class="hljs-string">"holidayApprovedTask"</span> <span class="hljs-attr">targetRef</span>=<span class="hljs-string">"approveEnd"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="hljs-tag">&lt;<span class="hljs-name">serviceTask</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"rejectLeave"</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"Send out rejection email"</span></span></span><br><span class="line"><span class="hljs-tag">                     <span class="hljs-attr">flowable:class</span>=<span class="hljs-string">"org.javaboy.flowable02.flowable.Reject"</span>/&gt;</span></span><br><span class="line">        <span class="hljs-tag">&lt;<span class="hljs-name">sequenceFlow</span> <span class="hljs-attr">sourceRef</span>=<span class="hljs-string">"rejectLeave"</span> <span class="hljs-attr">targetRef</span>=<span class="hljs-string">"rejectEnd"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="hljs-tag">&lt;<span class="hljs-name">endEvent</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"approveEnd"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="hljs-tag">&lt;<span class="hljs-name">endEvent</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"rejectEnd"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="hljs-tag">&lt;/<span class="hljs-name">process</span>&gt;</span></span><br><span class="line"><span class="hljs-tag">&lt;/<span class="hljs-name">definitions</span>&gt;</span></span><br></pre></td></tr></table></figure><p>很多想学习流程引擎的小伙伴都会被这个 XML 文件劝退，但是！！！</p><p>如果你愿意静下心来认真阅读这个 XML 文件，你会发现流程引擎原来如此简单！</p><p>我们来挨个看下这里的每一个节点：</p><ol><li>process：这表示一个流程，例如本文和大家分享的请假就是一个流程。</li><li>startEvent：这表示流程的开始，这就是一个开始事件。</li><li>userTask：这就是一个具体的流程节点了，flowable:candidateGroups 属性表示这个节点该由哪个用户组中的用户来处理。</li><li>sequenceFlow：这就是连接各个流程节点之间的线条，这个里边一般有两个属性，sourceRef 和 targetRef，前者表示线条的起点，后者表示线条的终点。</li><li>exclusiveGateway：表示一个排他性网关，也就是那个菱形选择框。</li><li>从排他性网关出来的线条有两个，大家注意看上面的代码，这两个线条中都涉及到一个变量 approved，如果这个变量为 true，则 targeRef 就是 externalSystemCall；如果这个变量为 false，则 targetRef 就是 rejectLeave。</li><li>serviceTask：这就是我们定义的一个具体的外部服务，如果在整个流程执行的过程中，你有一些需要自己完成的事情，那么可以通过 serviceTask 来实现，这个节点会有一个 flowable:class 属性，这个属性的值就是一个自定义类。</li><li>另外，上文中部分节点中还涉及到变量 ${}，这个变量是在流程执行的过程中传入进来的。</li></ol><p>总而言之，只要小伙伴们静下心来认真阅读一下上面的 XML，你会发现 So Easy！</p><h2 id="4-请假申请"><a href="#4-请假申请" class="headerlink" title="4. 请假申请"></a>4. 请假申请</h2><p>好了，接下来我们就来看一个具体的请假申请。由于请假流程只要放对位置，就会自动加载，所以我们并不需要手动加载请假流程，直接开始一个请假申请流程即可。</p><h3 id="4-1-服务端接口"><a href="#4-1-服务端接口" class="headerlink" title="4.1 服务端接口"></a>4.1 服务端接口</h3><p>首先我们需要一个实体类来接受前端传来的请假参数：用户名、请假天数以及请假理由：</p><figure class="highlight java hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">AskForLeaveVO</span> </span>&#123;</span><br><span class="line">    <span class="hljs-keyword">private</span> String name;</span><br><span class="line">    <span class="hljs-keyword">private</span> Integer days;</span><br><span class="line">    <span class="hljs-keyword">private</span> String reason;</span><br><span class="line">    <span class="hljs-comment">// 省略 getter/setter</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>再拿出祖传的 RespBean，以便响应数据方便一些：</p><figure class="highlight java hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">RespBean</span> </span>&#123;</span><br><span class="line">    <span class="hljs-keyword">private</span> Integer status;</span><br><span class="line">    <span class="hljs-keyword">private</span> String msg;</span><br><span class="line">    <span class="hljs-keyword">private</span> Object data;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> RespBean <span class="hljs-title">ok</span><span class="hljs-params">(String msg, Object data)</span> </span>&#123;</span><br><span class="line">        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> RespBean(<span class="hljs-number">200</span>, msg, data);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> RespBean <span class="hljs-title">ok</span><span class="hljs-params">(String msg)</span> </span>&#123;</span><br><span class="line">        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> RespBean(<span class="hljs-number">200</span>, msg, <span class="hljs-keyword">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> RespBean <span class="hljs-title">error</span><span class="hljs-params">(String msg, Object data)</span> </span>&#123;</span><br><span class="line">        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> RespBean(<span class="hljs-number">500</span>, msg, data);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> RespBean <span class="hljs-title">error</span><span class="hljs-params">(String msg)</span> </span>&#123;</span><br><span class="line">        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> RespBean(<span class="hljs-number">500</span>, msg, <span class="hljs-keyword">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-title">RespBean</span><span class="hljs-params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-title">RespBean</span><span class="hljs-params">(Integer status, String msg, Object data)</span> </span>&#123;</span><br><span class="line">        <span class="hljs-keyword">this</span>.status = status;</span><br><span class="line">        <span class="hljs-keyword">this</span>.msg = msg;</span><br><span class="line">        <span class="hljs-keyword">this</span>.data = data;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="hljs-comment">// 省略 getter/setter</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>接下来我们提供一个处理请假申请的接口：</p><figure class="highlight java hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-meta">@RestController</span></span><br><span class="line"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">AskForLeaveController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-meta">@Autowired</span></span><br><span class="line">    AskForLeaveService askForLeaveService;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-meta">@PostMapping</span>(<span class="hljs-string">"/ask_for_leave"</span>)</span><br><span class="line">    <span class="hljs-function"><span class="hljs-keyword">public</span> RespBean <span class="hljs-title">askForLeave</span><span class="hljs-params">(@RequestBody AskForLeaveVO askForLeaveVO)</span> </span>&#123;</span><br><span class="line">        <span class="hljs-keyword">return</span> askForLeaveService.askForLeave(askForLeaveVO);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>核心逻辑在 AskForLeaveService 中，来继续看：</p><figure class="highlight java hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-meta">@Service</span></span><br><span class="line"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">AskForLeaveService</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-meta">@Autowired</span></span><br><span class="line">    RuntimeService runtimeService;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-meta">@Transactional</span></span><br><span class="line">    <span class="hljs-function"><span class="hljs-keyword">public</span> RespBean <span class="hljs-title">askForLeave</span><span class="hljs-params">(AskForLeaveVO askForLeaveVO)</span> </span>&#123;</span><br><span class="line">        Map&lt;String, Object&gt; variables = <span class="hljs-keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">        variables.put(<span class="hljs-string">"name"</span>, askForLeaveVO.getName());</span><br><span class="line">        variables.put(<span class="hljs-string">"days"</span>, askForLeaveVO.getDays());</span><br><span class="line">        variables.put(<span class="hljs-string">"reason"</span>, askForLeaveVO.getReason());</span><br><span class="line">        <span class="hljs-keyword">try</span> &#123;</span><br><span class="line">            runtimeService.startProcessInstanceByKey(<span class="hljs-string">"holidayRequest"</span>, askForLeaveVO.getName(), variables);</span><br><span class="line">            <span class="hljs-keyword">return</span> RespBean.ok(<span class="hljs-string">"已提交请假申请"</span>);</span><br><span class="line">        &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="hljs-keyword">return</span> RespBean.error(<span class="hljs-string">"提交申请失败"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>小伙伴们看一下，在提交请假申请的时候，分别传入了 name、days 以及 reason 三个参数，我们将这三个参数放入到一个 Map 中，然后通过 RuntimeService#startProcessInstanceByKey 方法来开启一个流程，开启流程的时候一共传入了三个参数：</p><ol><li>第一个参数表示流程引擎的名字，这就是我们刚才在流程的 XML 文件中定义的名字。</li><li>第二个参数表示当前这个流程的 key，我用了申请人的名字，将来我们可以通过申请人的名字查询这个人曾经提交的所有申请流程。</li><li>第三个参数就是我们的变量了。</li></ol><p>好了，这服务端就写好了。</p><h3 id="4-2-前端页面"><a href="#4-2-前端页面" class="headerlink" title="4.2 前端页面"></a>4.2 前端页面</h3><p>接下来我们来开发前端页面。</p><p>前端我使用 Vue+ElementUI+Axios，咱们这个案例比较简单，就没有必要搭建单页面了，直接用普通的 HTML 就行了。另外，Vue 我是用了 Vue3：</p><figure class="highlight html hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"en"</span>&gt;</span></span><br><span class="line"><span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span></span><br><span class="line">    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">"UTF-8"</span>&gt;</span></span><br><span class="line">    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>Title<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span></span><br><span class="line">    <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"https://unpkg.com/axios/dist/axios.min.js"</span>&gt;</span><span class="hljs-undefined"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></span><br><span class="line">    <span class="hljs-comment">&lt;!-- Import style --&gt;</span></span><br><span class="line">    <span class="hljs-tag">&lt;<span class="hljs-name">link</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">"stylesheet"</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"//unpkg.com/element-plus/dist/index.css"</span>/&gt;</span></span><br><span class="line">    <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"https://unpkg.com/vue@3"</span>&gt;</span><span class="hljs-undefined"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></span><br><span class="line">    <span class="hljs-comment">&lt;!-- Import component library --&gt;</span></span><br><span class="line">    <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"//unpkg.com/element-plus"</span>&gt;</span><span class="hljs-undefined"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></span><br><span class="line"><span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span></span><br><span class="line"><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span></span><br><span class="line"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"app"</span>&gt;</span></span><br><span class="line">    <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>开始一个请假流程<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span></span><br><span class="line">    <span class="hljs-tag">&lt;<span class="hljs-name">table</span>&gt;</span></span><br><span class="line">        <span class="hljs-tag">&lt;<span class="hljs-name">tr</span>&gt;</span></span><br><span class="line">            <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>请输入姓名：<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span></span><br><span class="line">            <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span></span><br><span class="line">                <span class="hljs-tag">&lt;<span class="hljs-name">el-input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"text"</span> <span class="hljs-attr">v-model</span>=<span class="hljs-string">"afl.name"</span>/&gt;</span></span><br><span class="line">            <span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span></span><br><span class="line">        <span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span></span><br><span class="line">        <span class="hljs-tag">&lt;<span class="hljs-name">tr</span>&gt;</span></span><br><span class="line">            <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>请输入请假天数：<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span></span><br><span class="line">            <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span></span><br><span class="line">                <span class="hljs-tag">&lt;<span class="hljs-name">el-input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"text"</span> <span class="hljs-attr">v-model</span>=<span class="hljs-string">"afl.days"</span>/&gt;</span></span><br><span class="line">            <span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span></span><br><span class="line">        <span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span></span><br><span class="line">        <span class="hljs-tag">&lt;<span class="hljs-name">tr</span>&gt;</span></span><br><span class="line">            <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>请输入请假理由：<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span></span><br><span class="line">            <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span></span><br><span class="line">                <span class="hljs-tag">&lt;<span class="hljs-name">el-input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"text"</span> <span class="hljs-attr">v-model</span>=<span class="hljs-string">"afl.reason"</span>/&gt;</span></span><br><span class="line">            <span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span></span><br><span class="line">        <span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span></span><br><span class="line">    <span class="hljs-tag">&lt;/<span class="hljs-name">table</span>&gt;</span></span><br><span class="line">    <span class="hljs-tag">&lt;<span class="hljs-name">el-button</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"primary"</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">"submit"</span>&gt;</span>提交请假申请<span class="hljs-tag">&lt;/<span class="hljs-name">el-button</span>&gt;</span></span><br><span class="line"><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="line"><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="hljs-undefined"></span></span><br><span class="line"><span class="hljs-undefined">    Vue.createApp(</span></span><br><span class="line"><span class="hljs-undefined">        &#123;</span></span><br><span class="line"><span class="hljs-undefined">            data() &#123;</span></span><br><span class="line"><span class="hljs-javascript">                <span class="hljs-keyword">return</span> &#123;</span></span><br><span class="line"><span class="hljs-undefined">                    afl: &#123;</span></span><br><span class="line"><span class="hljs-javascript">                        name: <span class="hljs-string">'javaboy'</span>,</span></span><br><span class="line"><span class="hljs-undefined">                        days: 3,</span></span><br><span class="line"><span class="hljs-javascript">                        reason: <span class="hljs-string">'休息一下'</span></span></span><br><span class="line"><span class="hljs-undefined">                    &#125;</span></span><br><span class="line"><span class="hljs-undefined">                &#125;</span></span><br><span class="line"><span class="hljs-undefined">            &#125;,</span></span><br><span class="line"><span class="hljs-undefined">            methods: &#123;</span></span><br><span class="line"><span class="hljs-undefined">                submit() &#123;</span></span><br><span class="line"><span class="hljs-javascript">                    <span class="hljs-keyword">let</span> _this = <span class="hljs-keyword">this</span>;</span></span><br><span class="line"><span class="hljs-javascript">                    axios.post(<span class="hljs-string">'/ask_for_leave'</span>, <span class="hljs-keyword">this</span>.afl)</span></span><br><span class="line"><span class="hljs-javascript">                        .then(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">response</span>) </span>&#123;</span></span><br><span class="line"><span class="hljs-javascript">                            <span class="hljs-keyword">if</span> (response.data.status == <span class="hljs-number">200</span>) &#123;</span></span><br><span class="line"><span class="hljs-javascript">                                <span class="hljs-comment">//提交成功</span></span></span><br><span class="line"><span class="hljs-undefined">                                _this.$message.success(response.data.msg);</span></span><br><span class="line"><span class="hljs-javascript">                            &#125; <span class="hljs-keyword">else</span> &#123;</span></span><br><span class="line"><span class="hljs-javascript">                                <span class="hljs-comment">//提交失败</span></span></span><br><span class="line"><span class="hljs-undefined">                                _this.$message.error(response.data.msg);</span></span><br><span class="line"><span class="hljs-undefined">                            &#125;</span></span><br><span class="line"><span class="hljs-undefined">                        &#125;)</span></span><br><span class="line"><span class="hljs-javascript">                        .catch(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">error</span>) </span>&#123;</span></span><br><span class="line"><span class="hljs-javascript">                            <span class="hljs-built_in">console</span>.log(error);</span></span><br><span class="line"><span class="hljs-undefined">                        &#125;);</span></span><br><span class="line"><span class="hljs-undefined">                &#125;</span></span><br><span class="line"><span class="hljs-undefined">            &#125;</span></span><br><span class="line"><span class="hljs-undefined">        &#125;</span></span><br><span class="line"><span class="hljs-javascript">    ).use(ElementPlus).mount(<span class="hljs-string">'#app'</span>)</span></span><br><span class="line"><span class="hljs-undefined"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></span><br><span class="line"><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span></span><br><span class="line"><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><p>这个页面有几个需要注意的点：</p><ol><li>通过 Vue.createApp 来创建一个 Vue 实例，这跟以前 Vue2 中直接 new 一个 Vue 实例不一样。</li><li>在最下面，通过 use 来配置 ElementPlus 插件，这个跟 Vue2 也不一样。在 Vue2 中，如果我们单纯的在 HTML 页面中引用 ElementUI 并不需要这个步骤。</li><li>剩下的东西就比较简单了，上面先引入 Vue3、Axios 以及 ElementPlus，然后三个输入框，点击按钮提交请求，参数就是三个输入框中的数据，提交成功或者失败，分别弹个框出来提示一下就行了。</li></ol><p>好啦，这就写好了。</p><p>然而，提交完成后，没有一个直观的展示，虽然前端提示说提交成功了，但是究竟成功没，还得眼见为实。</p><h2 id="5-任务展示"><a href="#5-任务展示" class="headerlink" title="5. 任务展示"></a>5. 任务展示</h2><p>好了，接下来我们要做的事情就是把用户提交的流程展示出来。</p><p>按理说，比如经理登录成功之后，系统页面就自动展示出来经理需要审批的流程，但是我们当前这个例子为了简单，就没有登录这个操作了，需要需要用户将来在网页上选一下自己的身份，接下来就会展示出这个身份所对应的需要操作的流程。</p><p>我们来看任务接口：</p><figure class="highlight java hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-meta">@GetMapping</span>(<span class="hljs-string">"/list"</span>)</span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">public</span> RespBean <span class="hljs-title">leaveList</span><span class="hljs-params">(String identity)</span> </span>&#123;</span><br><span class="line">    <span class="hljs-keyword">return</span> askForLeaveService.leaveList(identity);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>这个请求参数 identity 就表示当前用户的身份（本来应该是登录后自动获取，但是因为我们目前没有登录，所以这个参数是由前端传递过来）。来继续看 askForLeaveService 中的方法：</p><figure class="highlight java hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-meta">@Service</span></span><br><span class="line"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">AskForLeaveService</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-meta">@Autowired</span></span><br><span class="line">    TaskService taskService;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-function"><span class="hljs-keyword">public</span> RespBean <span class="hljs-title">leaveList</span><span class="hljs-params">(String identity)</span> </span>&#123;</span><br><span class="line">        List&lt;Task&gt; tasks = taskService.createTaskQuery().taskCandidateGroup(identity).list();</span><br><span class="line">        List&lt;Map&lt;String, Object&gt;&gt; list = <span class="hljs-keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; tasks.size(); i++) &#123;</span><br><span class="line">            Task task = tasks.get(i);</span><br><span class="line">            Map&lt;String, Object&gt; variables = taskService.getVariables(task.getId());</span><br><span class="line">            variables.put(<span class="hljs-string">"id"</span>, task.getId());</span><br><span class="line">            list.add(variables);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="hljs-keyword">return</span> RespBean.ok(<span class="hljs-string">"加载成功"</span>, list);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Task 就是流程中要做的每一件事情，我们首先通过 TaskService，查询出来这个用户需要处理的任务，例如前端前传来的是 managers，那么这里就是查询所有需要由 managers 用户组处理的任务。</p><p>这段代码要结合流程图一起来理解，小伙伴们回顾下我们流程图中有如下一句：</p><figure class="highlight xml hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-tag">&lt;<span class="hljs-name">userTask</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"approveTask"</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"Approve or reject request"</span> <span class="hljs-attr">flowable:candidateGroups</span>=<span class="hljs-string">"managers"</span>/&gt;</span></span><br></pre></td></tr></table></figure><p>这意思就是说这个 userTask 是由 managers 这个组中的用户来处理，所以上面 Java 代码中的查询就是查询 managers 这个组中的用户需要审批的任务。</p><p>我们将所有需要审批的任务查询出来后，通过 taskId 可以进一步查询到这个任务中当时传入的各种变量，我们将这些数据封装成一个对象，并最终返回到前端。</p><p>最后，我们再来看下前端页面：</p><figure class="highlight html hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"en"</span>&gt;</span></span><br><span class="line"><span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span></span><br><span class="line">    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">"UTF-8"</span>&gt;</span></span><br><span class="line">    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>Title<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span></span><br><span class="line">    <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"https://unpkg.com/axios/dist/axios.min.js"</span>&gt;</span><span class="hljs-undefined"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></span><br><span class="line">    <span class="hljs-comment">&lt;!-- Import style --&gt;</span></span><br><span class="line">    <span class="hljs-tag">&lt;<span class="hljs-name">link</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">"stylesheet"</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"//unpkg.com/element-plus/dist/index.css"</span>/&gt;</span></span><br><span class="line">    <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"https://unpkg.com/vue@3"</span>&gt;</span><span class="hljs-undefined"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></span><br><span class="line">    <span class="hljs-comment">&lt;!-- Import component library --&gt;</span></span><br><span class="line">    <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"//unpkg.com/element-plus"</span>&gt;</span><span class="hljs-undefined"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></span><br><span class="line"><span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span></span><br><span class="line"><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span></span><br><span class="line"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"app"</span>&gt;</span></span><br><span class="line">    <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span></span><br><span class="line">        <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>请选择你的身份：<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="line">        <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span></span><br><span class="line">            <span class="hljs-tag">&lt;<span class="hljs-name">el-select</span> <span class="hljs-attr">name</span>=<span class="hljs-string">""</span> <span class="hljs-attr">id</span>=<span class="hljs-string">""</span> <span class="hljs-attr">v-model</span>=<span class="hljs-string">"identity"</span> @<span class="hljs-attr">change</span>=<span class="hljs-string">"initTasks"</span>&gt;</span></span><br><span class="line">                <span class="hljs-tag">&lt;<span class="hljs-name">el-option</span> <span class="hljs-attr">:value</span>=<span class="hljs-string">"iden"</span> <span class="hljs-attr">v-for</span>=<span class="hljs-string">"(iden,index) in identities"</span> <span class="hljs-attr">:key</span>=<span class="hljs-string">"index"</span> <span class="hljs-attr">:label</span>=<span class="hljs-string">"iden"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">el-option</span>&gt;</span></span><br><span class="line">            <span class="hljs-tag">&lt;/<span class="hljs-name">el-select</span>&gt;</span></span><br><span class="line">            <span class="hljs-tag">&lt;<span class="hljs-name">el-button</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"primary"</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">"initTasks"</span>&gt;</span>刷新一下<span class="hljs-tag">&lt;/<span class="hljs-name">el-button</span>&gt;</span></span><br><span class="line">        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="line">    <span class="hljs-tag">&lt;<span class="hljs-name">el-table</span> <span class="hljs-attr">border</span> <span class="hljs-attr">strip</span> <span class="hljs-attr">:data</span>=<span class="hljs-string">"tasks"</span>&gt;</span></span><br><span class="line">        <span class="hljs-tag">&lt;<span class="hljs-name">el-table-column</span> <span class="hljs-attr">prop</span>=<span class="hljs-string">"name"</span> <span class="hljs-attr">label</span>=<span class="hljs-string">"姓名"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">el-table-column</span>&gt;</span></span><br><span class="line">        <span class="hljs-tag">&lt;<span class="hljs-name">el-table-column</span> <span class="hljs-attr">prop</span>=<span class="hljs-string">"days"</span> <span class="hljs-attr">label</span>=<span class="hljs-string">"请假天数"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">el-table-column</span>&gt;</span></span><br><span class="line">        <span class="hljs-tag">&lt;<span class="hljs-name">el-table-column</span> <span class="hljs-attr">prop</span>=<span class="hljs-string">"reason"</span> <span class="hljs-attr">label</span>=<span class="hljs-string">"请假原因"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">el-table-column</span>&gt;</span></span><br><span class="line">        <span class="hljs-tag">&lt;<span class="hljs-name">el-table-column</span> <span class="hljs-attr">lable</span>=<span class="hljs-string">"操作"</span>&gt;</span></span><br><span class="line">            <span class="hljs-tag">&lt;<span class="hljs-name">template</span> #<span class="hljs-attr">default</span>=<span class="hljs-string">"scope"</span>&gt;</span></span><br><span class="line">                <span class="hljs-tag">&lt;<span class="hljs-name">el-button</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"primary"</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">"approveOrReject(scope.row.id,true,scope.row.name)"</span>&gt;</span>批准<span class="hljs-tag">&lt;/<span class="hljs-name">el-button</span>&gt;</span></span><br><span class="line">                <span class="hljs-tag">&lt;<span class="hljs-name">el-button</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"danger"</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">"approveOrReject(scope.row.id,false,scope.row.name)"</span>&gt;</span>拒绝<span class="hljs-tag">&lt;/<span class="hljs-name">el-button</span>&gt;</span></span><br><span class="line">            <span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span></span><br><span class="line">        <span class="hljs-tag">&lt;/<span class="hljs-name">el-table-column</span>&gt;</span></span><br><span class="line">    <span class="hljs-tag">&lt;/<span class="hljs-name">el-table</span>&gt;</span></span><br><span class="line"><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="line"><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="hljs-undefined"></span></span><br><span class="line"><span class="hljs-undefined">    Vue.createApp(</span></span><br><span class="line"><span class="hljs-undefined">        &#123;</span></span><br><span class="line"><span class="hljs-undefined">            data() &#123;</span></span><br><span class="line"><span class="hljs-javascript">                <span class="hljs-keyword">return</span> &#123;</span></span><br><span class="line"><span class="hljs-undefined">                    tasks: [],</span></span><br><span class="line"><span class="hljs-undefined">                    identities: [</span></span><br><span class="line"><span class="hljs-javascript">                        <span class="hljs-string">'managers'</span></span></span><br><span class="line"><span class="hljs-undefined">                    ],</span></span><br><span class="line"><span class="hljs-javascript">                    identity: <span class="hljs-string">''</span></span></span><br><span class="line"><span class="hljs-undefined">                &#125;</span></span><br><span class="line"><span class="hljs-undefined">            &#125;,</span></span><br><span class="line"><span class="hljs-undefined">            methods: &#123;</span></span><br><span class="line"><span class="hljs-undefined">                initTasks() &#123;</span></span><br><span class="line"><span class="hljs-javascript">                    <span class="hljs-keyword">let</span> _this = <span class="hljs-keyword">this</span>;</span></span><br><span class="line"><span class="hljs-javascript">                    axios.get(<span class="hljs-string">'/list?identity='</span> + <span class="hljs-keyword">this</span>.identity)</span></span><br><span class="line"><span class="hljs-javascript">                        .then(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">response</span>) </span>&#123;</span></span><br><span class="line"><span class="hljs-undefined">                            _this.tasks = response.data.data;</span></span><br><span class="line"><span class="hljs-undefined">                        &#125;)</span></span><br><span class="line"><span class="hljs-javascript">                        .catch(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">error</span>) </span>&#123;</span></span><br><span class="line"><span class="hljs-javascript">                            <span class="hljs-built_in">console</span>.log(error);</span></span><br><span class="line"><span class="hljs-undefined">                        &#125;);</span></span><br><span class="line"><span class="hljs-undefined">                &#125;</span></span><br><span class="line"><span class="hljs-undefined">            &#125;</span></span><br><span class="line"><span class="hljs-undefined">        &#125;</span></span><br><span class="line"><span class="hljs-javascript">    ).use(ElementPlus).mount(<span class="hljs-string">'#app'</span>)</span></span><br><span class="line"><span class="hljs-undefined"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></span><br><span class="line"><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span></span><br><span class="line"><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><p>大家看到，首先有一个下拉框，我们在这个下拉框中来选择用户的身份。选择完成后，触发 initTasks 方法，然后在这个方法中，发起网络请求，最终将请求结果渲染出来。</p><p>最终效果如下：</p><p><img src="http://img.itboyhub.com/2021/10/tran/20220808205402.png" alt></p><p>当然用户也可以点击刷新按钮，刷新列表。</p><p>这样，当第五小节中，员工提交了一个请假审批之后，我们在这个列表中就可以查看到员工提交的请假审批了（在流程图中，我们直接设置了用户的请假审批固定提交给 managers，在后续的文章中，松哥会教大家如何把这个提交的目标用户变成一个动态的）。</p><h2 id="6-请假审批"><a href="#6-请假审批" class="headerlink" title="6. 请假审批"></a>6. 请假审批</h2><p>接下来经理就可以选择批准或者是拒绝这请假了。</p><p>首先我们封装一个实体类用来接受前端传来的请求：</p><figure class="highlight java hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ApproveRejectVO</span> </span>&#123;</span><br><span class="line">    <span class="hljs-keyword">private</span> String taskId;</span><br><span class="line">    <span class="hljs-keyword">private</span> Boolean approve;</span><br><span class="line">    <span class="hljs-keyword">private</span> String name;</span><br><span class="line">    <span class="hljs-comment">// 省略 getter/setter</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>参数都好理解，approve 为 true 表示申请通过，false 表示申请被拒绝。</p><p>接下来我们来看接口：</p><figure class="highlight java hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-meta">@PostMapping</span>(<span class="hljs-string">"/handler"</span>)</span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">public</span> RespBean <span class="hljs-title">askForLeaveHandler</span><span class="hljs-params">(@RequestBody ApproveRejectVO approveRejectVO)</span> </span>&#123;</span><br><span class="line">    <span class="hljs-keyword">return</span> askForLeaveService.askForLeaveHandler(approveRejectVO);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>看具体的 askForLeaveHandler 方法：</p><figure class="highlight java hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-meta">@Service</span></span><br><span class="line"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">AskForLeaveService</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-meta">@Autowired</span></span><br><span class="line">    TaskService taskService;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-function"><span class="hljs-keyword">public</span> RespBean <span class="hljs-title">askForLeaveHandler</span><span class="hljs-params">(ApproveRejectVO approveRejectVO)</span> </span>&#123;</span><br><span class="line">        <span class="hljs-keyword">try</span> &#123;</span><br><span class="line">            <span class="hljs-keyword">boolean</span> approved = approveRejectVO.getApprove();</span><br><span class="line">            Map&lt;String, Object&gt; variables = <span class="hljs-keyword">new</span> HashMap&lt;String, Object&gt;();</span><br><span class="line">            variables.put(<span class="hljs-string">"approved"</span>, approved);</span><br><span class="line">            variables.put(<span class="hljs-string">"employee"</span>, approveRejectVO.getName());</span><br><span class="line">            Task task = taskService.createTaskQuery().taskId(approveRejectVO.getTaskId()).singleResult();</span><br><span class="line">            taskService.complete(task.getId(), variables);</span><br><span class="line">            <span class="hljs-keyword">if</span> (approved) &#123;</span><br><span class="line">                <span class="hljs-comment">//如果是同意，还需要继续走一步</span></span><br><span class="line">                Task t = taskService.createTaskQuery().processInstanceId(task.getProcessInstanceId()).singleResult();</span><br><span class="line">                taskService.complete(t.getId());</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="hljs-keyword">return</span> RespBean.ok(<span class="hljs-string">"操作成功"</span>);</span><br><span class="line">        &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="hljs-keyword">return</span> RespBean.error(<span class="hljs-string">"操作失败"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>大家注意这个审批流程：</p><ol><li>审批时需要两个参数，approved 和 employee，approved 为 true，就会自动进入到审批通过的流程中，approved 为 false 则会自动进入到拒绝流程中。</li><li>通过 taskService，结合 taskId，从流程中查询出对应的 task，然后调用 taskService.complete 方法传入 taskId 和 变量，以使流程向下走。</li><li>小伙伴们再回顾一下我们前面的流程图，如果请求被批准备了，那么在执行完自定义的 Approve 逻辑后，就会进入到 Holiday approved 这个 userTask 中，注意此时并不会继续向下走了（还差一步到结束事件）；如果是请求拒绝，则在执行完自定义的 Reject 逻辑后，就进入到结束事件了，这个流程就结束了。</li><li>针对第三条，所以代码中我们还需要额外再加一步，如果是 approved 为 true，那么就再从当前流程中查询出来需要执行的 task，再调用 complete 继续走一步，此时就到了结束事件了，这个流程就结束了。注意这次的查询是根据当前流程的 ID 查询的，一个流程就是一条线，这条线上有很多 Task，我们可以从 Task 中获取到流程的 ID。</li></ol><p>好啦，接口就写好了。</p><p>当然，这里还涉及到两个自定义的逻辑，就是批准或者拒绝之后的自定义逻辑，这个其实很好写，如下：</p><figure class="highlight java hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Approve</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">JavaDelegate</span> </span>&#123;</span><br><span class="line">    <span class="hljs-meta">@Override</span></span><br><span class="line">    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">execute</span><span class="hljs-params">(DelegateExecution execution)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="hljs-string">"申请通过:"</span>+execution.getVariables());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>我们自定义类实现 JavaDelegate 接口即可，然后我们在 execute 方法中做自己想要做的事情即可，execution 中有这个流程中的所有变量。我们可以在这里发邮件（公众号江南一点雨后台回复 666 有发邮件教程）、发短信等等。Reject 的定义方式也是类似的。这些自定义类写好之后，将来配置到流程图中即可（可查看上文的流程图）。</p><p>最后再来看看前端提交方法就简单了（页面源码上文已经列出）：</p><figure class="highlight js hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">approveOrReject(taskId, approve,name) &#123;</span><br><span class="line">    <span class="hljs-keyword">let</span> _this = <span class="hljs-keyword">this</span>;</span><br><span class="line">    axios.post(<span class="hljs-string">'/handler'</span>, &#123;<span class="hljs-attr">taskId</span>: taskId, <span class="hljs-attr">approve</span>: approve,<span class="hljs-attr">name</span>:name&#125;)</span><br><span class="line">        .then(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">response</span>) </span>&#123;</span><br><span class="line">            _this.initTasks();</span><br><span class="line">        &#125;)</span><br><span class="line">        .catch(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">error</span>) </span>&#123;</span><br><span class="line">            <span class="hljs-built_in">console</span>.log(error);</span><br><span class="line">        &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>这就一个普通的 Ajax 请求，批准的话第二个参数就为 true，拒绝的话第二个参数就为 false。</p><h2 id="7-结果查询"><a href="#7-结果查询" class="headerlink" title="7. 结果查询"></a>7. 结果查询</h2><p>最后，每个用户都可以查看自己曾经的申请记录。本来这个登录之后就可以展示了，但是因为我们没有登录，所以这里也是需要手动输入查询的用户，然后根据用户名查询这个用户的历史记录，我们先来看查询接口：</p><figure class="highlight java hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-meta">@GetMapping</span>(<span class="hljs-string">"/search"</span>)</span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">public</span> RespBean <span class="hljs-title">searchResult</span><span class="hljs-params">(String name)</span> </span>&#123;</span><br><span class="line">    <span class="hljs-keyword">return</span> askForLeaveService.searchResult(name);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>参数就是要查询的用户名。具体的查询流程如下：</p><figure class="highlight java hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-function"><span class="hljs-keyword">public</span> RespBean <span class="hljs-title">searchResult</span><span class="hljs-params">(String name)</span> </span>&#123;</span><br><span class="line">    List&lt;HistoryInfo&gt; historyInfos = <span class="hljs-keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">    List&lt;HistoricProcessInstance&gt; historicProcessInstances = historyService.createHistoricProcessInstanceQuery().processInstanceBusinessKey(name).finished().orderByProcessInstanceEndTime().desc().list();</span><br><span class="line">    <span class="hljs-keyword">for</span> (HistoricProcessInstance historicProcessInstance : historicProcessInstances) &#123;</span><br><span class="line">        HistoryInfo historyInfo = <span class="hljs-keyword">new</span> HistoryInfo();</span><br><span class="line">        Date startTime = historicProcessInstance.getStartTime();</span><br><span class="line">        Date endTime = historicProcessInstance.getEndTime();</span><br><span class="line">        List&lt;HistoricVariableInstance&gt; historicVariableInstances = historyService.createHistoricVariableInstanceQuery()</span><br><span class="line">                .processInstanceId(historicProcessInstance.getId())</span><br><span class="line">                .list();</span><br><span class="line">        <span class="hljs-keyword">for</span> (HistoricVariableInstance historicVariableInstance : historicVariableInstances) &#123;</span><br><span class="line">            String variableName = historicVariableInstance.getVariableName();</span><br><span class="line">            Object value = historicVariableInstance.getValue();</span><br><span class="line">            <span class="hljs-keyword">if</span> (<span class="hljs-string">"reason"</span>.equals(variableName)) &#123;</span><br><span class="line">                historyInfo.setReason((String) value);</span><br><span class="line">            &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-string">"days"</span>.equals(variableName)) &#123;</span><br><span class="line">                historyInfo.setDays(Integer.parseInt(value.toString()));</span><br><span class="line">            &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-string">"approved"</span>.equals(variableName)) &#123;</span><br><span class="line">                historyInfo.setStatus((Boolean) value);</span><br><span class="line">            &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-string">"name"</span>.equals(variableName)) &#123;</span><br><span class="line">                historyInfo.setName((String) value);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        historyInfo.setStartTime(startTime);</span><br><span class="line">        historyInfo.setEndTime(endTime);</span><br><span class="line">        historyInfos.add(historyInfo);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="hljs-keyword">return</span> RespBean.ok(<span class="hljs-string">"ok"</span>, historyInfos);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol><li>我们当时在开启流程的时候，传入了一个参数 key，这里就是再次通过这个 key，也就是用户名去查询历史流程，查询的时候还加上了 finished 方法，这个表示要查询的流程必须是执行完毕的流程，对于没有执行完毕的流程，这里不查询，查完之后，按照流程最后的处理时间进行排序。</li><li>遍历第一步的查询结果，从 HistoricProcessInstance 中提取出每一个流程的详细信息，并存入到集合中，并最终返回。</li><li>这里涉及到两个历史数据查询，createHistoricProcessInstanceQuery 用来查询历史流程，而 createHistoricVariableInstanceQuery 则主要是用来查询流程变量的。</li></ol><p>最后，前端通过表格展示这个数据即可：</p><figure class="highlight html hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"en"</span>&gt;</span></span><br><span class="line"><span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span></span><br><span class="line">    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">"UTF-8"</span>&gt;</span></span><br><span class="line">    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>Title<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span></span><br><span class="line">    <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"https://unpkg.com/axios/dist/axios.min.js"</span>&gt;</span><span class="hljs-undefined"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></span><br><span class="line">    <span class="hljs-comment">&lt;!-- Import style --&gt;</span></span><br><span class="line">    <span class="hljs-tag">&lt;<span class="hljs-name">link</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">"stylesheet"</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"//unpkg.com/element-plus/dist/index.css"</span>/&gt;</span></span><br><span class="line">    <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"https://unpkg.com/vue@3"</span>&gt;</span><span class="hljs-undefined"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></span><br><span class="line">    <span class="hljs-comment">&lt;!-- Import component library --&gt;</span></span><br><span class="line">    <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"//unpkg.com/element-plus"</span>&gt;</span><span class="hljs-undefined"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></span><br><span class="line"><span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span></span><br><span class="line"><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span></span><br><span class="line"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"app"</span>&gt;</span></span><br><span class="line">    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">style</span>=<span class="hljs-string">"margin-top: 50px"</span>&gt;</span></span><br><span class="line">        <span class="hljs-tag">&lt;<span class="hljs-name">el-input</span> <span class="hljs-attr">v-model</span>=<span class="hljs-string">"name"</span> <span class="hljs-attr">style</span>=<span class="hljs-string">"width: 300px"</span> <span class="hljs-attr">placeholder</span>=<span class="hljs-string">"请输入用户名"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">el-input</span>&gt;</span></span><br><span class="line">        <span class="hljs-tag">&lt;<span class="hljs-name">el-button</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"primary"</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">"search"</span>&gt;</span>查询<span class="hljs-tag">&lt;/<span class="hljs-name">el-button</span>&gt;</span></span><br><span class="line">    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span></span><br><span class="line">        <span class="hljs-tag">&lt;<span class="hljs-name">el-table</span> <span class="hljs-attr">border</span> <span class="hljs-attr">strip</span> <span class="hljs-attr">:data</span>=<span class="hljs-string">"historyInfos"</span>&gt;</span></span><br><span class="line">            <span class="hljs-tag">&lt;<span class="hljs-name">el-table-column</span> <span class="hljs-attr">prop</span>=<span class="hljs-string">"name"</span> <span class="hljs-attr">label</span>=<span class="hljs-string">"姓名"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">el-table-column</span>&gt;</span></span><br><span class="line">            <span class="hljs-tag">&lt;<span class="hljs-name">el-table-column</span> <span class="hljs-attr">prop</span>=<span class="hljs-string">"startTime"</span> <span class="hljs-attr">label</span>=<span class="hljs-string">"提交时间"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">el-table-column</span>&gt;</span></span><br><span class="line">            <span class="hljs-tag">&lt;<span class="hljs-name">el-table-column</span> <span class="hljs-attr">prop</span>=<span class="hljs-string">"endTime"</span> <span class="hljs-attr">label</span>=<span class="hljs-string">"审批时间"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">el-table-column</span>&gt;</span></span><br><span class="line">            <span class="hljs-tag">&lt;<span class="hljs-name">el-table-column</span> <span class="hljs-attr">prop</span>=<span class="hljs-string">"reason"</span> <span class="hljs-attr">label</span>=<span class="hljs-string">"事由"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">el-table-column</span>&gt;</span></span><br><span class="line">            <span class="hljs-tag">&lt;<span class="hljs-name">el-table-column</span> <span class="hljs-attr">prop</span>=<span class="hljs-string">"days"</span> <span class="hljs-attr">label</span>=<span class="hljs-string">"天数"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">el-table-column</span>&gt;</span></span><br><span class="line">            <span class="hljs-tag">&lt;<span class="hljs-name">el-table-column</span> <span class="hljs-attr">label</span>=<span class="hljs-string">"状态"</span>&gt;</span></span><br><span class="line">                <span class="hljs-tag">&lt;<span class="hljs-name">template</span> #<span class="hljs-attr">default</span>=<span class="hljs-string">"scope"</span>&gt;</span></span><br><span class="line">                    <span class="hljs-tag">&lt;<span class="hljs-name">el-tag</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"success"</span> <span class="hljs-attr">v-if</span>=<span class="hljs-string">"scope.row.status"</span>&gt;</span>已通过<span class="hljs-tag">&lt;/<span class="hljs-name">el-tag</span>&gt;</span></span><br><span class="line">                    <span class="hljs-tag">&lt;<span class="hljs-name">el-tag</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"danger"</span> <span class="hljs-attr">v-else</span>&gt;</span>已拒绝<span class="hljs-tag">&lt;/<span class="hljs-name">el-tag</span>&gt;</span></span><br><span class="line">                <span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span></span><br><span class="line">            <span class="hljs-tag">&lt;/<span class="hljs-name">el-table-column</span>&gt;</span></span><br><span class="line">        <span class="hljs-tag">&lt;/<span class="hljs-name">el-table</span>&gt;</span></span><br><span class="line">    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="line"><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="line"><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="hljs-undefined"></span></span><br><span class="line"><span class="hljs-undefined">    Vue.createApp(</span></span><br><span class="line"><span class="hljs-undefined">        &#123;</span></span><br><span class="line"><span class="hljs-undefined">            data() &#123;</span></span><br><span class="line"><span class="hljs-javascript">                <span class="hljs-keyword">return</span> &#123;</span></span><br><span class="line"><span class="hljs-undefined">                    historyInfos: [],</span></span><br><span class="line"><span class="hljs-javascript">                    name: <span class="hljs-string">'zhangsan'</span></span></span><br><span class="line"><span class="hljs-undefined">                &#125;</span></span><br><span class="line"><span class="hljs-undefined">            &#125;,</span></span><br><span class="line"><span class="hljs-undefined">            methods: &#123;</span></span><br><span class="line"><span class="hljs-undefined">                search() &#123;</span></span><br><span class="line"><span class="hljs-javascript">                    <span class="hljs-keyword">let</span> _this = <span class="hljs-keyword">this</span>;</span></span><br><span class="line"><span class="hljs-javascript">                    axios.get(<span class="hljs-string">'/search?name='</span> + <span class="hljs-keyword">this</span>.name)</span></span><br><span class="line"><span class="hljs-javascript">                        .then(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">response</span>) </span>&#123;</span></span><br><span class="line"><span class="hljs-javascript">                            <span class="hljs-keyword">if</span> (response.data.status == <span class="hljs-number">200</span>) &#123;</span></span><br><span class="line"><span class="hljs-undefined">                                _this.historyInfos=response.data.data;</span></span><br><span class="line"><span class="hljs-javascript">                            &#125; <span class="hljs-keyword">else</span> &#123;</span></span><br><span class="line"><span class="hljs-undefined">                                _this.$message.error(response.data.msg);</span></span><br><span class="line"><span class="hljs-undefined">                            &#125;</span></span><br><span class="line"><span class="hljs-undefined">                        &#125;)</span></span><br><span class="line"><span class="hljs-javascript">                        .catch(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">error</span>) </span>&#123;</span></span><br><span class="line"><span class="hljs-javascript">                            <span class="hljs-built_in">console</span>.log(error);</span></span><br><span class="line"><span class="hljs-undefined">                        &#125;);</span></span><br><span class="line"><span class="hljs-undefined">                &#125;</span></span><br><span class="line"><span class="hljs-undefined">        &#125;</span></span><br><span class="line"><span class="hljs-javascript">    ).use(ElementPlus).mount(<span class="hljs-string">'#app'</span>)</span></span><br><span class="line"><span class="hljs-undefined"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></span><br><span class="line"><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span></span><br><span class="line"><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><p>这个都是一些常规操作，我就不多说了，最终展示效果如下：</p><p><img src="http://img.itboyhub.com/2021/10/tran/20220808205620.png" alt></p><h2 id="8-小结"><a href="#8-小结" class="headerlink" title="8. 小结"></a>8. 小结</h2><p>好啦，一个简单的请假流程，让大家对 Flowable 的玩法有一个基本的认知，下篇文章松哥来和大家继续完善本文。Flowable 的视频将会出现在 TienChin 项目中，大家不要错过哦：<a href="https://mp.weixin.qq.com/s/uiX_p-e3MNFSyvV21CTk8w" target="_blank" rel="noopener">TienChin 项目配套视频来啦</a>。</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;小伙伴们知道松哥最近在录 TienChin 项目视频，这个项目会用到工作流，为了帮助小伙伴们更好的理解这个项目，松哥最近会出几篇文章和大伙聊一聊工作流 flowable 的使用，算是给 TienChin 项目的第一个铺垫，当然，在 TienChin 项目的系列视频中，我也会和大家详细聊一聊 flowable 流程引擎的使用。&lt;/p&gt;
    
    </summary>
    
      <category term="TienChin" scheme="http://www.javaboy.org/categories/TienChin/"/>
    
    
      <category term="TienChin" scheme="http://www.javaboy.org/tags/TienChin/"/>
    
      <category term="Flowable" scheme="http://www.javaboy.org/tags/Flowable/"/>
    
  </entry>
  
  <entry>
    <title>写给 Java 程序员的前端 Promise 教程</title>
    <link href="http://www.javaboy.org/2022/0808/promise.html"/>
    <id>http://www.javaboy.org/2022/0808/promise.html</id>
    <published>2022-08-08T11:39:30.000Z</published>
    <updated>2022-12-19T11:53:06.860Z</updated>
    
    <content type="html"><![CDATA[<p>[TOC]</p><p>小伙伴们知道，松哥最近在录 TienChin 项目，用的 RuoYi-Vue 脚手架，前端关于网络请求的地方，很多都涉及到了 Promise，为了让小伙伴们能更好的理解前端代码，咱们抽空整一篇文章和大家聊聊整个 Promise。</p><a id="more"></a><h2 id="1-为什么需要-Promise"><a href="#1-为什么需要-Promise" class="headerlink" title="1. 为什么需要 Promise"></a>1. 为什么需要 Promise</h2><p>假设我现在有这样一个需求，用户先去登录，登录成功之后，再去服务端获取用户信息，获取到用户信息之后再去服务端获取前端的动态菜单。一般我们的 Ajax 请求都是异步形式，为了确保上一步操作成功再执行下一个请求，所以最终发出的请求伪代码类似下面这样：</p><figure class="highlight js hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">$.ajax(&#123;</span><br><span class="line">    url:<span class="hljs-string">'/login'</span>,</span><br><span class="line">    data:loginForm,</span><br><span class="line">    success: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">data</span>) </span>&#123;</span><br><span class="line">        <span class="hljs-comment">//登录成功</span></span><br><span class="line">        $.ajax(&#123;</span><br><span class="line">            url:<span class="hljs-string">'/getInfo'</span>,</span><br><span class="line">            success: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">userInfo</span>) </span>&#123;</span><br><span class="line">                <span class="hljs-comment">//获取用户信息成功</span></span><br><span class="line">                $.ajax(&#123;</span><br><span class="line">                    url: <span class="hljs-string">'/getMenus'</span>,</span><br><span class="line">                    success: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">menus</span>) </span>&#123;</span><br><span class="line">                        <span class="hljs-comment">//获取菜单成功</span></span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>为了确保一个异步任务执行完成后，再执行下一个异步任务，我们不得不在回调函数中不停的写下去，上面我举的例子是三个请求嵌套，实际上可能会更多。。。这就是前端所谓的回调地狱。而 Promise 就是来解决回调地狱的。</p><h2 id="2-Promise"><a href="#2-Promise" class="headerlink" title="2. Promise"></a>2. Promise</h2><p>Promise 从字面上理解，就是承诺，承诺将来在某一个时间会做某一件事。通过 Promise 我们可以将异步任务执行的代码和处理的代码完全分离开。</p><p>还是第一小节这个例子，如果我们用 Promise 写，那么方式如下：</p><figure class="highlight js hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">login</span>(<span class="hljs-params">resolve, reject</span>) </span>&#123;</span><br><span class="line">    setTimeout(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="hljs-keyword">let</span> number = <span class="hljs-built_in">Math</span>.random();</span><br><span class="line">        <span class="hljs-keyword">if</span> (number &gt; <span class="hljs-number">0.5</span>) &#123;</span><br><span class="line">            resolve(<span class="hljs-string">"login success"</span>)</span><br><span class="line">        &#125; <span class="hljs-keyword">else</span> &#123;</span><br><span class="line">            reject(<span class="hljs-string">"login failed"</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;, <span class="hljs-number">2000</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getInfo</span>(<span class="hljs-params">resolve, reject</span>) </span>&#123;</span><br><span class="line">    setTimeout(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="hljs-keyword">let</span> number = <span class="hljs-built_in">Math</span>.random();</span><br><span class="line">        <span class="hljs-keyword">if</span> (number &gt; <span class="hljs-number">0.5</span>) &#123;</span><br><span class="line">            resolve(<span class="hljs-string">"getInfo success"</span>)</span><br><span class="line">        &#125; <span class="hljs-keyword">else</span> &#123;</span><br><span class="line">            reject(<span class="hljs-string">"getInfo failed"</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;, <span class="hljs-number">2000</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getMenus</span>(<span class="hljs-params">resolve, reject</span>) </span>&#123;</span><br><span class="line">    setTimeout(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="hljs-keyword">let</span> number = <span class="hljs-built_in">Math</span>.random();</span><br><span class="line">        <span class="hljs-keyword">if</span> (number &gt; <span class="hljs-number">0.5</span>) &#123;</span><br><span class="line">            resolve(<span class="hljs-string">"getMenus success"</span>)</span><br><span class="line">        &#125; <span class="hljs-keyword">else</span> &#123;</span><br><span class="line">            reject(<span class="hljs-string">"getMenus failed"</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;, <span class="hljs-number">2000</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="hljs-keyword">new</span> <span class="hljs-built_in">Promise</span>(login).then(<span class="hljs-function"><span class="hljs-params">data</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">"login:"</span>, data);</span><br><span class="line">    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Promise</span>(getInfo);</span><br><span class="line">&#125;).then(<span class="hljs-function"><span class="hljs-params">data</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">"getInfo:"</span>, data);</span><br><span class="line">    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Promise</span>(getMenus);</span><br><span class="line">&#125;).then(<span class="hljs-function"><span class="hljs-params">data</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">"getMenus"</span>, data);</span><br><span class="line">&#125;).catch(<span class="hljs-function"><span class="hljs-params">err</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">"err:"</span>, err);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>我们在 Promise 中写异步任务执行的代码，在上面的案例中，松哥通过 setTImeout 方法模拟了一个耗时操作，异步任务执行完毕后，我们调用 resolve 方法返回调用的结果（会进入到下一步的 then 中），也可以调用 reject 方法表示调用失败（会进入到 catch 中）。</p><h2 id="3-then"><a href="#3-then" class="headerlink" title="3. then"></a>3. then</h2><p>then 中的返回值可以分为三种情况。</p><h3 id="3-1-正常-return"><a href="#3-1-正常-return" class="headerlink" title="3.1 正常 return"></a>3.1 正常 return</h3><p>then 中方法的参数，是上一个 Promise 对象 resolve 的值，一个 Promise 对象可以有多个 then，例如上面案例的登录功能，我们可以一直 then 下去：</p><figure class="highlight js hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">login</span>(<span class="hljs-params">resolve, reject</span>) </span>&#123;</span><br><span class="line">    setTimeout(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="hljs-keyword">let</span> number = <span class="hljs-built_in">Math</span>.random();</span><br><span class="line">        <span class="hljs-keyword">if</span> (number &gt; <span class="hljs-number">0.5</span>) &#123;</span><br><span class="line">            resolve(<span class="hljs-string">"login success"</span>)</span><br><span class="line">        &#125; <span class="hljs-keyword">else</span> &#123;</span><br><span class="line">            reject(<span class="hljs-string">"login failed"</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;, <span class="hljs-number">2000</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="hljs-keyword">new</span> <span class="hljs-built_in">Promise</span>(login).then(<span class="hljs-function"><span class="hljs-params">data</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">"then1:"</span>, data);</span><br><span class="line">    <span class="hljs-keyword">return</span> data;</span><br><span class="line">&#125;).then(<span class="hljs-function"><span class="hljs-params">data</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">"then2:"</span>, data);</span><br><span class="line">    <span class="hljs-keyword">return</span> data;</span><br><span class="line">&#125;).then(<span class="hljs-function"><span class="hljs-params">data</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">"then3:"</span>, data);</span><br><span class="line">&#125;).catch(<span class="hljs-function"><span class="hljs-params">err</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">"err:"</span>, err);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>这样可以一直返回，这有点像我们 Java 中的流式编程。</p><h3 id="3-2-抛出异常"><a href="#3-2-抛出异常" class="headerlink" title="3.2 抛出异常"></a>3.2 抛出异常</h3><p>在 then 中，我们可以对返回结果进行判断，不满足条件也可以直接抛出异常，这样就会进入到最近的 catch 代码块中。如下案例：</p><figure class="highlight js hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">login</span>(<span class="hljs-params">resolve, reject</span>) </span>&#123;</span><br><span class="line">    setTimeout(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="hljs-keyword">let</span> number = <span class="hljs-built_in">Math</span>.random();</span><br><span class="line">        <span class="hljs-keyword">if</span> (number &gt; <span class="hljs-number">0.5</span>) &#123;</span><br><span class="line">            resolve(<span class="hljs-string">"login success"</span>)</span><br><span class="line">        &#125; <span class="hljs-keyword">else</span> &#123;</span><br><span class="line">            reject(<span class="hljs-string">"login failed"</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;, <span class="hljs-number">2000</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="hljs-keyword">new</span> <span class="hljs-built_in">Promise</span>(login).then(<span class="hljs-function"><span class="hljs-params">data</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">"then1:"</span>, data);</span><br><span class="line">    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">"出错啦"</span>);</span><br><span class="line">&#125;).then(<span class="hljs-function"><span class="hljs-params">data</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">"then2:"</span>, data);</span><br><span class="line">    <span class="hljs-keyword">return</span> data;</span><br><span class="line">&#125;).then(<span class="hljs-function"><span class="hljs-params">data</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">"then3:"</span>, data);</span><br><span class="line">&#125;).catch(<span class="hljs-function"><span class="hljs-params">err</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">"err:"</span>, err);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>像上面这段代码，如果进入到第一个 then 中，第一个 then 直接抛出异常，这样直接就进入到 catch 中了，后面的 then 就都不会执行了。</p><h3 id="3-3-返回-Promise"><a href="#3-3-返回-Promise" class="headerlink" title="3.3 返回 Promise"></a>3.3 返回 Promise</h3><p>第三种情况就是 then 中也可以返回一个 Promise 对象，这个就如同我们第二小节的案例，我这里就不再赘述了。</p><p>就说一句，如果 then 中返回的是一个 Promise 对象，那么接下来的 then 其实是这个 Promise 对象的 then，而不是一开始的 Promise 的 then 了。例如如下伪代码：</p><figure class="highlight js hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">A.then(<span class="hljs-function">(<span class="hljs-params">data</span>)=&gt;</span>&#123;<span class="hljs-keyword">return</span> B&#125;).then(xxx)</span><br></pre></td></tr></table></figure><p>假设 A 和 B 都是 Promise 对象，那么第二个 then 方法是 B 的 then。</p><p>好啦，这就是 then 中的三种返回值情况。</p><h2 id="4-catch"><a href="#4-catch" class="headerlink" title="4. catch"></a>4. catch</h2><p>catch 主要是用来处理异常的情况，两种情况下会进入到 catch 中：</p><ul><li>Promise 执行的时候通过 reject 返回数据。</li><li>then 中抛出 Error</li></ul><p>出了问题，就由<strong>最近的</strong> catch 来处理。</p><h2 id="5-finally"><a href="#5-finally" class="headerlink" title="5. finally"></a>5. finally</h2><p>最后还有一个 finally 用来兜底，这一套下来感觉有点像我们 Java 中的 try-catch-finally，也就是前面无论如何，最终 finally 中的代码都会执行。不过不同于 Java 中的 finally，Promise 中的 finally 在最终执行完毕后，还可以继续 then。。。前端的蜜汁操作。</p><h2 id="6-其他方法"><a href="#6-其他方法" class="headerlink" title="6. 其他方法"></a>6. 其他方法</h2><p>最后，我们再来看看 Promise 中的其他静态方法。</p><h3 id="6-1-Promise-all"><a href="#6-1-Promise-all" class="headerlink" title="6.1 Promise.all()"></a>6.1 Promise.all()</h3><p>Promise.all() 方法可以接收多个 Promise 对象，并且只返回一个 Promise 实例，这个方法会等所有输入的 Promise 对象的 resolve 方法都返回的时候，或者所有输入的 Promise 对象中有一个 reject 的时候，这个 all 就会执行结束，来看如下一个案例：</p><figure class="highlight js hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">const</span> promise1 = <span class="hljs-built_in">Promise</span>.resolve(<span class="hljs-number">3</span>);</span><br><span class="line"><span class="hljs-keyword">const</span> promise2 = <span class="hljs-number">42</span>;</span><br><span class="line"><span class="hljs-keyword">const</span> promise3 = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">    setTimeout(resolve, <span class="hljs-number">3000</span>, <span class="hljs-string">'foo'</span>);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="hljs-built_in">Promise</span>.all([promise1, promise2, promise3]).then(<span class="hljs-function">(<span class="hljs-params">values</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="hljs-built_in">console</span>.log(values);</span><br><span class="line">&#125;).catch(<span class="hljs-function"><span class="hljs-params">err</span>=&gt;</span>&#123;</span><br><span class="line">    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">"err"</span>, err);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>当 promise1、promise2 以及 promise3 都执行了 resolve 的时候，就会进入到 then 中，这三个中有任意一个执行了 reject 就会进入到 catch 中。</p><h3 id="6-2-Promise-race"><a href="#6-2-Promise-race" class="headerlink" title="6.2 Promise.race()"></a>6.2 Promise.race()</h3><p>Promise.race() 方法可以接收多个 Promise 对象，一旦迭代器中的某个 Promise resolve 或 reject，返回的 Promise 就会 resolve 或 reject。</p><p>和 all 方法的区别在于，race 方法是谁执行的快，就用谁的结果。我们来看如下一段代码：</p><figure class="highlight js hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">const</span> promise1 = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">    setTimeout(resolve, <span class="hljs-number">500</span>, <span class="hljs-string">'one'</span>);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="hljs-keyword">const</span> promise2 = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">    setTimeout(reject, <span class="hljs-number">600</span>, <span class="hljs-string">'two'</span>);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="hljs-built_in">Promise</span>.race([promise1, promise2]).then(<span class="hljs-function">(<span class="hljs-params">value</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="hljs-built_in">console</span>.log(value);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>promise1 执行时间短，promise2 执行时间长，所以最终结果就是 promise1 的结果。</p><h3 id="6-3-Promise-reject"><a href="#6-3-Promise-reject" class="headerlink" title="6.3 Promise.reject()"></a>6.3 Promise.reject()</h3><p>Promise.reject() 方法返回一个带有 reject 原因的 Promise 对象。来看如下一段代码：</p><figure class="highlight js hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">resolved</span>(<span class="hljs-params">result</span>) </span>&#123;</span><br><span class="line">    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'Resolved'</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">rejected</span>(<span class="hljs-params">result</span>) </span>&#123;</span><br><span class="line">    <span class="hljs-built_in">console</span>.error(result);</span><br><span class="line">&#125;</span><br><span class="line"><span class="hljs-built_in">Promise</span>.reject(<span class="hljs-string">"error"</span>).then(resolved).catch(rejected);</span><br></pre></td></tr></table></figure><p>这个执行的时候就会进入到 catch 中。</p><h3 id="6-4-Promise-resolve"><a href="#6-4-Promise-resolve" class="headerlink" title="6.4 Promise.resolve()"></a>6.4 Promise.resolve()</h3><p>Promise.resolve(value) 方法返回一个以给定值解析后的 Promise 对象。</p><figure class="highlight js hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">const</span> promise1 = <span class="hljs-built_in">Promise</span>.resolve(<span class="hljs-number">3</span>);</span><br><span class="line">promise1.then(<span class="hljs-function"><span class="hljs-params">data</span>=&gt;</span>&#123;</span><br><span class="line">    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">"data"</span>, data);</span><br><span class="line">&#125;,err=&gt;&#123;</span><br><span class="line">    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">"err"</span>, err);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>这个用法比较简单，没啥好说的。</p><p>还有一些其他方法我就不一一列举了，感兴趣的小伙伴们可以看看 MDN 上的相关讲解：<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Promise" target="_blank" rel="noopener">https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Promise</a>。</p><p>好啦，这个东西搞懂了，我们再去看 TienChin 项目的前端，就会非常容易了！</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;[TOC]&lt;/p&gt;
&lt;p&gt;小伙伴们知道，松哥最近在录 TienChin 项目，用的 RuoYi-Vue 脚手架，前端关于网络请求的地方，很多都涉及到了 Promise，为了让小伙伴们能更好的理解前端代码，咱们抽空整一篇文章和大家聊聊整个 Promise。&lt;/p&gt;
    
    </summary>
    
      <category term="TienChin" scheme="http://www.javaboy.org/categories/TienChin/"/>
    
    
      <category term="TienChin" scheme="http://www.javaboy.org/tags/TienChin/"/>
    
      <category term="Vue3" scheme="http://www.javaboy.org/tags/Vue3/"/>
    
  </entry>
  
  <entry>
    <title>手把手教你用 Jenkins 自动部署 SpringBoot！</title>
    <link href="http://www.javaboy.org/2022/0804/jenkins-springboot.html"/>
    <id>http://www.javaboy.org/2022/0804/jenkins-springboot.html</id>
    <published>2022-08-04T11:39:12.000Z</published>
    <updated>2022-12-19T11:53:26.567Z</updated>
    
    <content type="html"><![CDATA[<p>[TOC]</p><h2 id="1-什么是-CI-CD"><a href="#1-什么是-CI-CD" class="headerlink" title="1. 什么是 CI/CD"></a>1. 什么是 CI/CD</h2><p>CI/CD 是一种通过在应用开发阶段引入自动化来频繁向客户交付应用的方法。</p><a id="more"></a><p>CI/CD 的核心概念可以总结为三点：</p><ul><li>持续集成</li><li>持续交付</li><li>持续部署</li></ul><p>CI/CD 主要针对在集成新代码时所引发的问题（俗称”集成地狱”）。</p><p>为什么会有集成地狱这个“雅称”呢？大家想想我们一个项目部署的过程，<code>拉取代码-&gt;构建-&gt;测试-&gt;打包-&gt;部署</code>，如果我们经常需要部署项目，特别是在微服务时代，服务特别多的情况下，不停的测试打包部署，那估计得有个人一整天专门做这事了，而这事又是繁琐的重复无意义的。</p><p>具体而言，CI/CD 可让持续自动化和持续监控贯穿于应用的整个生命周期（从集成和测试阶段，到交付和部署），这些关联的事务通常被统称为”CI/CD 管道”，由开发和运维团队以敏捷方式协同支持。</p><h3 id="1-1-CI（Continuous-Integration）"><a href="#1-1-CI（Continuous-Integration）" class="headerlink" title="1.1 CI（Continuous Integration）"></a>1.1 CI（Continuous Integration）</h3><p>CI/CD 中的”CI”始终指持续集成，它属于开发人员的自动化流程。成功的 CI 意味着应用代码的新更改会定期构建、测试并合并到代码仓库中，该解决方案可以解决在一次开发中有太多应用分支，从而导致相互冲突的问题。</p><h3 id="1-2-CD（Continuous-Delivery-Continuous-Deployment）"><a href="#1-2-CD（Continuous-Delivery-Continuous-Deployment）" class="headerlink" title="1.2 CD（Continuous Delivery/Continuous Deployment）"></a>1.2 CD（Continuous Delivery/Continuous Deployment）</h3><p>CI/CD 中的”CD”指的是持续交付和/或持续部署，这些相关概念有时会交叉使用。两者都事关管道后续阶段的自动化，但它们有时也会单独使用，用于说明自动化程度。</p><p>持续交付（Continuous Delivery）通常是指开发人员对应用的更改会自动进行错误测试并上传到代码仓库（如 GitHub、GitLab 等），然后由运维团队将其部署到实时生产环境中。这旨在解决开发和运维团队之间可见性及沟通较差的问题。因此，持续交付的目的就是确保尽可能减少部署新代码时所需的工作量。</p><p>持续部署（Continuous Deployment）指的是自动将开发人员的更改从代码仓库发布到生产环境，以供客户使用。通过一套全自动化的流程，来解决手动测试、编译、打包等操作。持续部署以持续交付的优势为根基，实现了管道后续阶段的自动化。</p><h2 id="2-什么是-Jenkins"><a href="#2-什么是-Jenkins" class="headerlink" title="2. 什么是 Jenkins"></a>2. 什么是 Jenkins</h2><p>前面说的 CI/CD 算是一种思想，思想要落地，就需要对应的工具。</p><p>Jenkins 是一款开源的 CI/CD 软件，可以算是 CI/CD 软件领导者，它提供了超过 1000 个插件来支持构建、部署、自动化，基本上能够满足任何项目的需要。</p><p>整体来说，Jenkins 有如下六大特点：</p><ul><li>持续集成和持续交付</li></ul><p>作为一个可扩展的自动化服务器，Jenkins 可以用作简单的 CI 服务器，或者变成任何项目的持续交付中心。</p><ul><li>简易安装</li></ul><p>Jenkins 是一个基于 Java 的独立程序，可以立即运行，包含 Windows、Mac OS X 和其他类 Unix 操作系统。</p><ul><li>配置简单</li></ul><p>Jenkins 可以通过其网页界面轻松设置和配置，其中包括即时错误检查和内置帮助。</p><ul><li>插件</li></ul><p>通过更新中心中的 1000 多个插件，Jenkins 集成了持续集成和持续交付工具链中几乎所有的工具。</p><ul><li>扩展</li></ul><p>Jenkins 可以通过其插件架构进行扩展，从而为 Jenkins 可以做的事提供几乎无限的可能性。</p><ul><li>分布式</li></ul><p>Jenkins 可以轻松地在多台机器上分配工作，帮助更快速地跨多个平台推动构建、测试和部署。</p><p>其实 Jenkins 有很多好玩的用法，今天我还是想先通过一个简单的案例，先来和大家捋一捋如何使用 Jenkins 来实现一个 Spring Boot 项目的自动发布部署，这样大家对 Jenkins 现有一个直观的认知，各种其他使用细节松哥在以后的文章中再来和大家细聊。</p><h2 id="3-准备工作"><a href="#3-准备工作" class="headerlink" title="3. 准备工作"></a>3. 准备工作</h2><h3 id="3-1-整体规划"><a href="#3-1-整体规划" class="headerlink" title="3.1 整体规划"></a>3.1 整体规划</h3><p>我们先来通过如下一张图片来看下 Jenkins 在整个流程中扮演的角色：</p><p><img src="http://img.itboyhub.com/2021/10/tran/jenkins01.png" alt></p><p>结合第一二小节的介绍，这张图应该很好理解。</p><h3 id="3-2-准备代码"><a href="#3-2-准备代码" class="headerlink" title="3.2 准备代码"></a>3.2 准备代码</h3><p>提前准备好测试代码，并上传到代码仓库中。为了更加逼真一些，小伙伴们可以将这个代码仓库设置为私有的，这样将来可以检验 Jenkins 中的配置是否正确。</p><p>考虑到 GitHub 网络有时候不稳定，我这里使用了 Gitee，一个很简单的 Spring Boot 工程，里边有一个 hello 接口，仅此而已。</p><p>我的代码仓库地址（私有仓库）：</p><ul><li><a href="https://gitee.com/lenve/jenkins_demo.git" target="_blank" rel="noopener">https://gitee.com/lenve/jenkins_demo.git</a></li></ul><h3 id="3-3-准备服务器"><a href="#3-3-准备服务器" class="headerlink" title="3.3 准备服务器"></a>3.3 准备服务器</h3><p>理论上，我们需要一台服务器用来跑 Jenkins，还需要一台服务器作为我的应用服务器，但是我手头没有多余的服务器，所以我就将 Jenkins 和我的 Spring Boot 项目部署到一台服务器上，在接下来的文章中我会和大家说明每个配置是针对 Jenkins 的还是针对 Spring Boot 的。</p><p>另外，有的小伙伴可能是在虚拟机上做实验，因为将来我们的代码提交到 Gitee 之后，Gitee 会通过一个 POST 请求将这个事件告知 Jenkins，进而触发 Jenkins 的构建操作。所以这就要求 Gitee 能够访问到你的 Jenkins 服务器，所以如果你的 Jenkins 刚好搭建在服务器上，这事就很容易了，但如果是搭建在虚拟机里，就得通过花生壳之类的内网穿透工具来辅助你的工作了，比较麻烦，而且花生壳网速也慢。</p><p><strong>不过小伙伴们不必担心，如果你在虚拟上搭建的 Jenkins，并且不愿意折腾花生壳，那么也可以通过手动构建/定时构建的方式去完成项目构建的。</strong></p><h2 id="4-搭建-Jenkins"><a href="#4-搭建-Jenkins" class="headerlink" title="4. 搭建 Jenkins"></a>4. 搭建 Jenkins</h2><p>为了省事，我决定用 Docker  搭建 Jenkins，一行命令搞定。</p><p>为了操作方便，我们将 Jenkins 的工作目录映射到我的宿主机中来，因此首先在宿主机中准备一个数据目录（不是必须）：</p><figure class="highlight shell hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-meta">#</span><span class="hljs-bash"> 创建 jenkins 目录</span></span><br><span class="line">mkdir /data/jenkins_home/</span><br><span class="line"><span class="hljs-meta">#</span><span class="hljs-bash"> 修改目录的所有者，以便于 Jenkins 容器能够操作该目录</span></span><br><span class="line">chown -R 1000:1000 /data/jenkins_home/</span><br></pre></td></tr></table></figure><p>接下来创建并启动 Jenkins 容器，同时挂载数据卷：</p><figure class="highlight shell hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -d --name jenkins -p 8088:8080 -p 50000:50000 -v /data/jenkins_home:/var/jenkins_home jenkins/jenkins</span><br></pre></td></tr></table></figure><p>由于 Jenkins 在运行的时候需要用到 maven，所以有的人会选择将 maven 目录也作为挂载点，但是我觉得没有必要，特别是对于初学者而言，这块很容易出错，不如将 maven 将来直接拷贝到 Jenkins 容器中，这样反而省事一些。</p><p>执行如上命令，安装成功之后，浏览器输入 <code>http://localhost:8088</code> 就可以访问了。</p><p><img src="http://img.itboyhub.com/2021/10/tran/jenkins02.png" alt></p><p>然后稍等片刻，就可以访问 Jenkins 了：</p><p><img src="http://img.itboyhub.com/2021/10/tran/jenkins03.png" alt></p><p>访问之前，首先需要解锁 Jenkins，解锁密码位置网页上列出来了，但是由于我们创建容器的时候设置了数据卷，所以，现在直接去宿主机的 <code>/data/jenkins_home/secrets/initialAdminPassword</code> 位置查看初始化密码，如下：</p><p><img src="http://img.itboyhub.com/2021/10/tran/jenkins04.png" alt></p><p>在网页中，输入密码然后继续。接下来会让我们选择需要的插件，第一次使用，安装推荐插件即可。</p><p><img src="http://img.itboyhub.com/2021/10/tran/jenkins05.png" alt></p><p><img src="http://img.itboyhub.com/2021/10/tran/jenkins06.png" alt></p><p>如果因为网络原因安装失败，可以点击重试按钮进行重试。</p><p>接下来创建一个新的用户，也可以不创建新的用户，直接使用 admin 即可：</p><p><img src="http://img.itboyhub.com/2021/10/tran/jenkins07.png" alt></p><p>再设置 Jenkins 访问地址：</p><p><img src="http://img.itboyhub.com/2021/10/tran/image-20220803095540329.png" alt></p><p>这个页面有乱码，不过不影响，设置完成后，我们点击保存并完成按钮即可。接下来就可以进入到 Jenkins 中了。</p><p>整个过程执行完毕后，建议执行如下命令重启一下 Jenkins，因为有的插件需要重启之后才会生效。</p><figure class="highlight shell hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker restart jenkins</span><br></pre></td></tr></table></figure><h2 id="5-安装插件"><a href="#5-安装插件" class="headerlink" title="5. 安装插件"></a>5. 安装插件</h2><p>Jenkins 启动成功之后，接下来我们安装三个必要的插件：</p><ul><li>Maven Integration：Maven 构建工具</li><li>Publish Over SSH：整个工具，将来把 Jenkins 打包好的 jar 上传到应用服务器上。</li><li>Gitee：协助使用 Gitee 仓库。</li></ul><p>安装步骤如下：</p><p>点击左边的系统管理，然后点击右边的插件管理，进行配置。</p><p><img src="http://img.itboyhub.com/2021/10/tran/image-20220803095956610.png" alt></p><p>然后在可选插件中，搜索 Maven Integration 和 Publish Over SSH 以及 Gitee 三个插件：</p><p><img src="http://img.itboyhub.com/2021/10/tran/image-20220803100309138.png" alt><br><img src="http://img.itboyhub.com/2021/10/tran/image-20220803102729071.png" alt></p><p>搜索完成后，点击 Install without restart。</p><p>安装成功之后，重启 Jenkins。</p><p><img src="http://img.itboyhub.com/2021/10/tran/image-20220803100415646.png" alt></p><p>建议执行 <code>docker restart jenkins</code> 去重启，点击网页上的重启，会卡很久，还是执行 docker 重启命令靠谱一些。</p><h2 id="6-配置-Jenkins"><a href="#6-配置-Jenkins" class="headerlink" title="6. 配置 Jenkins"></a>6. 配置 Jenkins</h2><h3 id="6-1-基本的环境配置"><a href="#6-1-基本的环境配置" class="headerlink" title="6.1 基本的环境配置"></a>6.1 基本的环境配置</h3><p>插件安装成功之后，接下来我们开启 Jenkins 的配置，在正式开始配置之前，先做一点准备工作。</p><p>这个需要我们提前准备好 Maven，由于 Jenkins 容器中已经包含一个 JDK 了，所以我们可以不用提前准备 JDK，只需要提前准备 Maven 即可。为了避免权限问题，我们可以直接将 Maven 上传到 jenkins 容器中，然后去配置即可。</p><p>如下将宿主机中的 maven 拷贝到 Jenkins 容器中：</p><figure class="highlight shell hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-meta">#</span><span class="hljs-bash"> 这个命令表示将宿主机中的 maven 目录拷贝到 jenkins 容器中的 /opt/ 目录下</span></span><br><span class="line">docker cp maven jenkins:/opt/</span><br></pre></td></tr></table></figure><p>接下来就可以开始配置了，配置的位置如下图：</p><p><img src="http://img.itboyhub.com/2021/10/tran/image-20220803100754206.png" alt></p><h3 id="6-2-JDK"><a href="#6-2-JDK" class="headerlink" title="6.2 JDK"></a>6.2 JDK</h3><p>首先我们来配置 JDK，Jenkins 中默认安装了 JDK，我们只需要将其配置配出出来即可：</p><p><img src="http://img.itboyhub.com/2021/10/tran/image-20220803101719496.png" alt></p><p>别名随意取，JAVA_HOME 则根据实际情况配置。</p><h3 id="6-3-Maven"><a href="#6-3-Maven" class="headerlink" title="6.3 Maven"></a>6.3 Maven</h3><p>Maven 就是我们刚刚上传到 docker 中期中的 Maven，配置一下位置即可，Jenkins 将来会自动从 Gitee 上将代码拉下来，然后就利用你这里配置的 Maven 进行构建：</p><p><img src="http://img.itboyhub.com/2021/10/tran/image-20220803102006235.png" alt></p><p>名字随意取，MAVEN_HOME 则是前面刚刚上传到容器中的 MAVEN 目录。</p><h3 id="6-4-Git"><a href="#6-4-Git" class="headerlink" title="6.4 Git"></a>6.4 Git</h3><p>配置 Git，由于 Jenkins 容器中已经存在 git 了，所以这里不需要额外安装 git，默认即可。</p><p><img src="http://img.itboyhub.com/2021/10/tran/image-20220803101813123.png" alt></p><p>所有都配置完成，点击保存按钮。</p><h3 id="6-5-远程的凭证配置"><a href="#6-5-远程的凭证配置" class="headerlink" title="6.5 远程的凭证配置"></a>6.5 远程的凭证配置</h3><p>接下来还需要我们配置两个远程登录凭证。</p><h4 id="6-5-1-应用服务器信息"><a href="#6-5-1-应用服务器信息" class="headerlink" title="6.5.1 应用服务器信息"></a>6.5.1 应用服务器信息</h4><p>应用服务器，就是将来 Jenkins 将代码构建成 jar 包后，要上传的服务器的信息（地址、用户名以及密码）。</p><p>配置步骤如下，首先找到配置的位置：</p><p><img src="http://img.itboyhub.com/2021/10/tran/image-20220803102239648.png" alt></p><p>往下拉找到 Publish Over SSH，然后点击新增，开始配置，Hostname 位置填写你服务器的域名或者 IP：</p><p><img src="http://img.itboyhub.com/2021/10/tran/image-20220803102548136222.png" alt></p><p>配置成功后，点击测试连接进行测试，确保连接是成功的。</p><blockquote><p>有的小伙伴反馈这里用户名密码会导致 jar 包上传失败，要在应用服务器上生成 ssh 密钥对，然后将私钥配置给 Jenkins（这块大家结合自己情况来看，如果后面 jar 上传失败，可以回来改一下这里）。</p></blockquote><h4 id="6-5-2-Gitee-的信息"><a href="#6-5-2-Gitee-的信息" class="headerlink" title="6.5.2 Gitee 的信息"></a>6.5.2 Gitee 的信息</h4><p>接下来我们配置 Gitee 的信息。</p><p>首先配置仓库的基本信息：</p><p><img src="http://img.itboyhub.com/2021/10/tran/image-20220803103153589.png" alt></p><p>接下来配置 Gitee 的凭证，要根据这些凭证，才能从 Gitee 上拉取代码下来，点击 <code>添加-&gt;Jenkins</code>，添加凭证：</p><p><img src="http://img.itboyhub.com/2021/10/tran/image-20220803103418033.png" alt></p><p>添加成功之后，就可以选择这个令牌了。</p><p>最后点击测试连接，确保可以连上 Gitee。</p><p>所有配置工作都做完了，接下来我们就可以开始构建一个项目了。</p><h2 id="7-开始一个项目的构建"><a href="#7-开始一个项目的构建" class="headerlink" title="7. 开始一个项目的构建"></a>7. 开始一个项目的构建</h2><p>首先我们新建一个任务</p><p><img src="http://img.itboyhub.com/2021/10/tran/image-20220803103735394.png" alt></p><p>接下来我们选择构建一个 Maven 项目</p><p><img src="http://img.itboyhub.com/2021/10/tran/image-20220803103830497.png" alt></p><p>点击确定之后，拉到源码管理位置，开始配置。</p><p>首先选择 Git，填入 Gitee 上的仓库地址，然后凭证就写 Gitee 的用户名/密码。</p><p><img src="http://img.itboyhub.com/2021/10/tran/image-20220803104223941.png" alt></p><p>这里有一个需要注意的地方，就是默认的分支名称，GitHub 上现在默认的主分支名称是 main，Gitee 似乎还是 master，这个无所谓了，但是小伙伴们注意图片下面的分支，按你实际的情况填写。</p><p>这里也要添加凭证信息：</p><p><img src="http://img.itboyhub.com/2021/10/tran/image-202208031041261312222.png" alt></p><p>这里也要注意下，有小伙伴反馈 Gitee 上的用户名和用户空间不是一回事（如果用的 GitHub 就不存在这个问题），我这里用户名位置实际填入用户空间名（如果你也不知道什么是用户空间，那么恭喜你，直接写用户名就行了）。</p><p>加上时间，我们看下打印的过程：</p><p><img src="http://img.itboyhub.com/2021/10/tran/image-20220803104517156.png" alt></p><p>接下来输入项目构建命令，将来 Jenkins 从 Gitee 上拉取代码下来之后，就执行该命令对项目进行打包：</p><p><img src="http://img.itboyhub.com/2021/10/tran/image-20220803104623169.png" alt></p><p>最后，配置上传构建好的文件，并执行启动命令，如下：</p><p><img src="http://img.itboyhub.com/2021/10/tran/image-20220803104947558.png" alt></p><p>配置的详细信息：</p><p><img src="http://img.itboyhub.com/2021/10/tran/image-20220803105611407.png" alt></p><p>根据上图的配置，我们使用 root 用户登录，root 登录成功之后，默认进入到 /root 目录下，接下来会自动进入到 data 目录，然后我们的 jar 包就上传到这个位置上。</p><p>然后我们在应用服务器上也提前准备好一个 shell 脚本叫做 deploy.sh，位于 <code>/root/data</code> 目录下,这个脚本内容如下：</p><figure class="highlight shell hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">export JAVA_HOME=/opt/java</span><br><span class="line">export PATH=$JAVA_HOME/bin:$PATH</span><br><span class="line"></span><br><span class="line">JAR_PATH=/root/data</span><br><span class="line"></span><br><span class="line">JARFILE=jenkins_demo-0.0.1-SNAPSHOT.jar</span><br><span class="line"></span><br><span class="line">ps -ef | grep $JARFILE | grep -v grep | awk '&#123;print $2&#125;' | xargs kill -9</span><br><span class="line"></span><br><span class="line">java -jar $JAR_PATH/$JARFILE &gt; out.log &amp;</span><br><span class="line">if [ $? = 0 ];then</span><br><span class="line">        sleep 30</span><br><span class="line">        tail -n 50 out.log</span><br><span class="line">fi</span><br></pre></td></tr></table></figure><p>这个脚本其实很好理解，前面先配置一下环境变量，注意这个是应用服务器的环境变量，不是 Jenkins 的。</p><p>然后先检查一下，如果应用程序已经在运行了，就先将之停止掉。然后运行我们最新的 jar 即可。</p><p>另外，可以开启 SSH 操作日志，开启日志之后，就可以看到 Jenkins 中操作应用服务器其的过程了，特别是大家第一次配置的时候，容易出错，配置了日志，将来出错就知道什么原因导致的错误了。</p><p>配置方式如下图：</p><p><img src="http://img.itboyhub.com/2021/10/tran/image-20220803140603444.png" alt></p><p>至此，这个项目就配置完成了。</p><p>保存之后，点击立即构建按钮，就可以开始构建了：</p><p><img src="http://img.itboyhub.com/2021/10/tran/image-20220803140723567.png" alt></p><p>开始构建之后，可以点击构建按钮，查看构建过程：</p><p><img src="http://img.itboyhub.com/2021/10/tran/image-20220803141003923.png" alt></p><p>点击控制台输出，可以查看整个构建过程：</p><p><img src="http://img.itboyhub.com/2021/10/tran/image-20220803141130900.png" alt></p><p>构建完成后，来到应用服务器，执行 jps 命令查看运行的 Java 进程，就可以看到我们的应用程序已经跑起来了。</p><h2 id="8-自动构建"><a href="#8-自动构建" class="headerlink" title="8. 自动构建"></a>8. 自动构建</h2><p>好了，现在我们的项目还不是自动构建，也就是当我们向 Gitee 上的代码仓库提交代码之后，并不会触发 Jenkins 的自动构建，得我们手动点击构建按钮，接下来我们再来继续配置，实现自动触发构建。</p><p>为了实现自动触发构建，我们需要修改两个地方。</p><h3 id="8-1-修改-Jenkins"><a href="#8-1-修改-Jenkins" class="headerlink" title="8.1 修改 Jenkins"></a>8.1 修改 Jenkins</h3><p>首先在 Jenkins 的当前项目中，配置一下触发构建的规则：</p><p><img src="http://img.itboyhub.com/2021/10/tran/image-20220803141725213--222.png" alt></p><p>大家注意，在网页上 Jenkins 已经给出了将来要配置的 Webhook 的地址了，大家直接拷贝该地址即可。</p><h3 id="8-2-配置-Webhook"><a href="#8-2-配置-Webhook" class="headerlink" title="8.2 配置 Webhook"></a>8.2 配置 Webhook</h3><p>接下来在 Gitee 的项目中，配置 WebHook，在当前项目中，选择管理选项卡，左边菜单点击 WebHooks，然后点击添加 WebHook。</p><p><img src="http://img.itboyhub.com/2021/10/tran/image-20220803142317703222.png" alt></p><p>由于 Jenkins 是要登录之后才可以操作的，处于公网的 Jenkins 我们也不能降至设置为匿名访问，所以这里我们将 Jenkins 的用户名密码放在请求地址中，最终地址类似这样：<code>http://username:password@11.11.11.11:8088/xxxx</code>。</p><p>好啦，这就行了，配置完成后，接下来我们向 Gitee 代码仓库提交代码，提交成功之后，我们去查看是否会触发 Jenkins 自动构建功能。</p><h2 id="9-小结"><a href="#9-小结" class="headerlink" title="9. 小结"></a>9. 小结</h2><p>好啦，关于 Jenkins 还有很多好玩的用法，今天的文章限于篇幅我就先通过一个简单的案例来和大家分享一下 Jenkins 的基本用法，以便于小伙伴们对 Jenkins 建立一个直观的印象，更多的玩法，松哥将在后续的文章中和大家继续介绍，小伙伴们也可以留言说说你想看 Jenkins 怎么玩。</p><p>参考资料：</p><ul><li><a href="https://www.redhat.com/zh/topics/devops/what-is-ci-cd" target="_blank" rel="noopener">https://www.redhat.com/zh/topics/devops/what-is-ci-cd</a></li></ul>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;[TOC]&lt;/p&gt;
&lt;h2 id=&quot;1-什么是-CI-CD&quot;&gt;&lt;a href=&quot;#1-什么是-CI-CD&quot; class=&quot;headerlink&quot; title=&quot;1. 什么是 CI/CD&quot;&gt;&lt;/a&gt;1. 什么是 CI/CD&lt;/h2&gt;&lt;p&gt;CI/CD 是一种通过在应用开发阶段引入自动化来频繁向客户交付应用的方法。&lt;/p&gt;
    
    </summary>
    
      <category term="TienChin" scheme="http://www.javaboy.org/categories/TienChin/"/>
    
    
      <category term="TienChin" scheme="http://www.javaboy.org/tags/TienChin/"/>
    
      <category term="Jenkins" scheme="http://www.javaboy.org/tags/Jenkins/"/>
    
  </entry>
  
  <entry>
    <title>松哥手把手教你在 Vue3 中自定义插件</title>
    <link href="http://www.javaboy.org/2022/0801/vue3-plugins.html"/>
    <id>http://www.javaboy.org/2022/0801/vue3-plugins.html</id>
    <published>2022-08-01T11:38:52.000Z</published>
    <updated>2022-12-19T11:53:03.105Z</updated>
    
    <content type="html"><![CDATA[<p>[TOC]</p><p>最近在录 TienChin 项目，项目涉及到了 Vue 中插件的定义，因此整了这么一篇文章，手把手教大家在 Vue3 中定义插件，这个技能掌握了，就可以看懂 TienChin 前端代码了。</p><a id="more"></a><h2 id="1-Vue-插件"><a href="#1-Vue-插件" class="headerlink" title="1. Vue 插件"></a>1. Vue 插件</h2><p>在 Vue 中，一些简单的功能，我们可以直接定义为全局方法，然后挂到 Vue 上就能使用了，例如在 vhr 中，我们将网络请求方法进行封装，然后挂到了 Vue.prototype 上就可以了，类似下面这样：</p><figure class="highlight js hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">import</span> &#123;postRequest&#125; <span class="hljs-keyword">from</span> <span class="hljs-string">"./utils/api"</span>;</span><br><span class="line"></span><br><span class="line">Vue.prototype.postRequest = postRequest;</span><br></pre></td></tr></table></figure><p>然后在使用的地方，就可以通过 this.postRequest 去使用了。</p><blockquote><p>小伙伴们需要注意，这个在 Vue3 中有所变化，prototype 变为了 config.globalProperties，也就是在 Vue3 中再想要挂载全局方法，应该是 <code>const app = createApp(App);app.config.globalProperties.useDict = useDict</code> 这种形式了（具体我将在 TienChin 项目中和大家细聊）。</p></blockquote><p>这也算是一种插件定义方式，但是这种一般适用于一些工具方法，无法定义一些比较复杂的插件，复杂的插件还是得通过 Vue 中提供的插件定义方式来定义。</p><h2 id="2-自定义插件"><a href="#2-自定义插件" class="headerlink" title="2. 自定义插件"></a>2. 自定义插件</h2><h3 id="2-1-基本用法"><a href="#2-1-基本用法" class="headerlink" title="2.1 基本用法"></a>2.1 基本用法</h3><p>首先我们新建一个目录 plugins 专门用来放我们的插件，然后在这个目录中新建一个 index.js 文件用来开发插件，内容如下：</p><figure class="highlight js hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> &#123;</span><br><span class="line">    install: <span class="hljs-function">(<span class="hljs-params">app, options</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="hljs-built_in">console</span>.log(<span class="hljs-string">"我的第一个插件"</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>install 中的方法将会被自动执行。</p><p>接下来我们就可以在 main.js 中引入我们这个插件了：</p><figure class="highlight js hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">const</span> app = createApp(App);</span><br><span class="line"></span><br><span class="line"><span class="hljs-keyword">import</span> plugin <span class="hljs-keyword">from</span> <span class="hljs-string">'./plugins'</span></span><br><span class="line"></span><br><span class="line">app.use(plugin);</span><br></pre></td></tr></table></figure><p>app.use 就表示引入插件，引入插件之后，插件中的 install 方法就会被自动执行。</p><p>app.use 方法接收两个参数，第一个参数就是我们导入的插件 js 对象，第二个参数是可选的，大家看到插件定义时候的 install 方法有两个参数，第一个参数是 Vue 实例，这是自动传入的，第二个参数 options 则是我们在 app.use 中，通过第二个参数传入进来的。当然上面这个例子中松哥没有传递第二个参数。</p><p>好了，如此配置之后，接下来启动项目，控制台就可以看到有日志打出了。</p><p><img src="http://img.itboyhub.com/2021/10/tran/20220727184510.png" alt></p><p>这样的插件未免过于简单，接下来我们就给这个插件加点料。</p><h3 id="2-2-加入组件"><a href="#2-2-加入组件" class="headerlink" title="2.2 加入组件"></a>2.2 加入组件</h3><p>首先我们定义一个新的组件，如下：</p><figure class="highlight html hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span></span><br><span class="line">    <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span></span><br><span class="line">        <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"http://www.javaboy.org"</span>&gt;</span>javaboy<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span></span><br><span class="line">    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="line"><span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="hljs-undefined"></span></span><br><span class="line"><span class="hljs-javascript">    <span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> &#123;</span></span><br><span class="line"><span class="hljs-javascript">        name: <span class="hljs-string">"MyBanner"</span></span></span><br><span class="line"><span class="hljs-undefined">    &#125;</span></span><br><span class="line"><span class="hljs-undefined"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><p>然后我们现在就可以在插件中将这个组件注册为一个全局组件了，如下：</p><figure class="highlight js hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">import</span> MyBanner <span class="hljs-keyword">from</span> <span class="hljs-string">"@/plugins/components/MyBanner"</span>;</span><br><span class="line"></span><br><span class="line"><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> &#123;</span><br><span class="line">    install: <span class="hljs-function">(<span class="hljs-params">app, options</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="hljs-built_in">console</span>.log(<span class="hljs-string">"我的第一个插件"</span>)</span><br><span class="line">        app.component(<span class="hljs-string">'my-banner'</span>, MyBanner);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>首先在插件中导入这个组件，然后通过 app 进行组件注册，注册完成后，我们就可以在项目任意位置使用 <code>my-banner</code> 组件了，如下：</p><figure class="highlight html hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span></span><br><span class="line">    <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span></span><br><span class="line">        <span class="hljs-tag">&lt;<span class="hljs-name">my-banner</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">my-banner</span>&gt;</span></span><br><span class="line">    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="line"><span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span></span><br></pre></td></tr></table></figure><p>最终显示效果如下：</p><p><img src="http://img.itboyhub.com/2021/10/tran/20220727184541.png" alt></p><h3 id="2-3-加入指令"><a href="#2-3-加入指令" class="headerlink" title="2.3 加入指令"></a>2.3 加入指令</h3><p>我们甚至还可以在插件中注册一个指令，如下：</p><figure class="highlight js hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">import</span> MyBanner <span class="hljs-keyword">from</span> <span class="hljs-string">"@/plugins/components/MyBanner"</span>;</span><br><span class="line"></span><br><span class="line"><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> &#123;</span><br><span class="line">    install: <span class="hljs-function">(<span class="hljs-params">app, options</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="hljs-built_in">console</span>.log(<span class="hljs-string">"我的第一个插件"</span>)</span><br><span class="line">        app.component(<span class="hljs-string">'my-banner'</span>, MyBanner);</span><br><span class="line">        app.directive(<span class="hljs-string">"font-size"</span>, (el, binding, vnode) =&gt; &#123;</span><br><span class="line">            <span class="hljs-keyword">var</span> size = <span class="hljs-number">16</span>;</span><br><span class="line">            <span class="hljs-keyword">switch</span> (binding.arg) &#123;</span><br><span class="line">                <span class="hljs-keyword">case</span> <span class="hljs-string">"small"</span>:</span><br><span class="line">                    size = <span class="hljs-number">16</span>;</span><br><span class="line">                    <span class="hljs-keyword">break</span>;</span><br><span class="line">                <span class="hljs-keyword">case</span> <span class="hljs-string">"large"</span>:</span><br><span class="line">                    size = <span class="hljs-number">32</span>;</span><br><span class="line">                    <span class="hljs-keyword">break</span>;</span><br><span class="line">                <span class="hljs-keyword">default</span>:</span><br><span class="line">                    size = <span class="hljs-number">48</span>;</span><br><span class="line">                    <span class="hljs-keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            el.style.fontSize = size + <span class="hljs-string">"px"</span>;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>现在，我们就可以在项目中随时随地去使用这个指令了，例如在我们刚刚自定义的 my-banner 中使用这个指令：</p><figure class="highlight html hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span></span><br><span class="line">    <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span></span><br><span class="line">        <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"http://www.javaboy.org"</span> <span class="hljs-attr">v-font-size:small</span>&gt;</span>javaboy<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span></span><br><span class="line">    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="line"><span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="hljs-undefined"></span></span><br><span class="line"><span class="hljs-javascript">    <span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> &#123;</span></span><br><span class="line"><span class="hljs-javascript">        name: <span class="hljs-string">"MyBanner"</span></span></span><br><span class="line"><span class="hljs-undefined">    &#125;</span></span><br><span class="line"><span class="hljs-undefined"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><p>我们甚至可以通过 options 将指令中字体的大小动态的传进来，如下：</p><figure class="highlight js hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">import</span> MyBanner <span class="hljs-keyword">from</span> <span class="hljs-string">"@/plugins/components/MyBanner"</span>;</span><br><span class="line"></span><br><span class="line"><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> &#123;</span><br><span class="line">    install: <span class="hljs-function">(<span class="hljs-params">app, options</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="hljs-built_in">console</span>.log(<span class="hljs-string">"我的第一个插件"</span>)</span><br><span class="line">        app.component(<span class="hljs-string">'my-banner'</span>, MyBanner);</span><br><span class="line">        app.directive(<span class="hljs-string">"font-size"</span>, (el, binding, vnode) =&gt; &#123;</span><br><span class="line">            <span class="hljs-keyword">var</span> size = <span class="hljs-number">16</span>;</span><br><span class="line">            <span class="hljs-keyword">switch</span> (binding.arg) &#123;</span><br><span class="line">                <span class="hljs-keyword">case</span> <span class="hljs-string">"small"</span>:</span><br><span class="line">                    size = options.small;</span><br><span class="line">                    <span class="hljs-keyword">break</span>;</span><br><span class="line">                <span class="hljs-keyword">case</span> <span class="hljs-string">"large"</span>:</span><br><span class="line">                    size = options.large;</span><br><span class="line">                    <span class="hljs-keyword">break</span>;</span><br><span class="line">                <span class="hljs-keyword">default</span>:</span><br><span class="line">                    size = options.defaut;</span><br><span class="line">                    <span class="hljs-keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            el.style.fontSize = size + <span class="hljs-string">"px"</span>;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>options 是插件注册时候传入的一个 JSON 参数，small、large 以及 default 分别对应的字体多大，要看插件注册时传入的值：</p><figure class="highlight js hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">const</span> app = createApp(App);</span><br><span class="line"></span><br><span class="line"><span class="hljs-keyword">import</span> plugin <span class="hljs-keyword">from</span> <span class="hljs-string">'./plugins'</span></span><br><span class="line"></span><br><span class="line">app.use(plugin, &#123;<span class="hljs-attr">small</span>: <span class="hljs-number">16</span>, <span class="hljs-attr">large</span>: <span class="hljs-number">32</span>, <span class="hljs-attr">default</span>: <span class="hljs-number">48</span>&#125;);</span><br></pre></td></tr></table></figure><p>第二个参数，大家看，就是 options 参数的值。</p><blockquote><p>现在大家想想我们平时用 ElementUI 的时候，Vue.use 方法，传入 ElementUI，再传入一些其他参数，看了上面这个例子，ElementUI 引入到底是怎么个引入法现在大家就明白了吧。</p></blockquote><h3 id="2-4-provide-amp-inject"><a href="#2-4-provide-amp-inject" class="headerlink" title="2.4 provide &amp; inject"></a>2.4 provide &amp; inject</h3><p>在插件中，也可以通过 provide 来提供一个方法，在需要使用该方法的地方，通过 inject 注入方法，然后就可以使用了，如下：</p><figure class="highlight js hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">import</span> MyBanner <span class="hljs-keyword">from</span> <span class="hljs-string">"@/plugins/components/MyBanner"</span>;</span><br><span class="line"></span><br><span class="line"><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> &#123;</span><br><span class="line">    install: <span class="hljs-function">(<span class="hljs-params">app, options</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="hljs-built_in">console</span>.log(<span class="hljs-string">"我的第一个插件"</span>)</span><br><span class="line">        app.component(<span class="hljs-string">'my-banner'</span>, MyBanner);</span><br><span class="line">        app.directive(<span class="hljs-string">"font-size"</span>, (el, binding, vnode) =&gt; &#123;</span><br><span class="line">            <span class="hljs-keyword">var</span> size = <span class="hljs-number">16</span>;</span><br><span class="line">            <span class="hljs-keyword">switch</span> (binding.arg) &#123;</span><br><span class="line">                <span class="hljs-keyword">case</span> <span class="hljs-string">"small"</span>:</span><br><span class="line">                    size = options.small;</span><br><span class="line">                    <span class="hljs-keyword">break</span>;</span><br><span class="line">                <span class="hljs-keyword">case</span> <span class="hljs-string">"large"</span>:</span><br><span class="line">                    size = options.large;</span><br><span class="line">                    <span class="hljs-keyword">break</span>;</span><br><span class="line">                <span class="hljs-keyword">default</span>:</span><br><span class="line">                    size = options.defaut;</span><br><span class="line">                    <span class="hljs-keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            el.style.fontSize = size + <span class="hljs-string">"px"</span>;</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="hljs-keyword">const</span> clickMe = <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> &#123;</span><br><span class="line">            <span class="hljs-built_in">console</span>.log(<span class="hljs-string">"==========clickMe========="</span>)</span><br><span class="line">        &#125;</span><br><span class="line">        app.provide(<span class="hljs-string">'clickMe'</span>, clickMe);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>在需要使用的地方，通过 inject 注入方法后就可以使用了，如下：</p><figure class="highlight html hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span></span><br><span class="line">    <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span></span><br><span class="line">        <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"http://www.javaboy.org"</span> <span class="hljs-attr">v-font-size:small</span>&gt;</span>javaboy<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span></span><br><span class="line">    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="line"><span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="hljs-undefined"></span></span><br><span class="line"><span class="hljs-undefined"></span></span><br><span class="line"><span class="hljs-javascript">    <span class="hljs-keyword">import</span> &#123;inject&#125; <span class="hljs-keyword">from</span> <span class="hljs-string">"vue"</span>;</span></span><br><span class="line"><span class="hljs-undefined"></span></span><br><span class="line"><span class="hljs-javascript">    <span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> &#123;</span></span><br><span class="line"><span class="hljs-javascript">        name: <span class="hljs-string">"MyBanner"</span>,</span></span><br><span class="line"><span class="hljs-undefined">        mounted() &#123;</span></span><br><span class="line"><span class="hljs-javascript">            <span class="hljs-keyword">const</span> clickMe = inject(<span class="hljs-string">'clickMe'</span>);</span></span><br><span class="line"><span class="hljs-undefined">            clickMe();</span></span><br><span class="line"><span class="hljs-undefined">        &#125;</span></span><br><span class="line"><span class="hljs-undefined">    &#125;</span></span><br><span class="line"><span class="hljs-undefined"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="3-小结"><a href="#3-小结" class="headerlink" title="3. 小结"></a>3. 小结</h2><p>整体上来说，通过这种方式来自定义插件，能够实现的内容比较丰富。如果只是想挂一个全局方法来用，那么其实是没有必要定义插件的。如果只是想挂载一个全局方法，在 Vue2 中可以按照如下方式使用：</p><figure class="highlight js hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Vue.prototype.postRequest = postRequest;</span><br></pre></td></tr></table></figure><p>在 Vue3 中则可以通过如下方式：</p><figure class="highlight js hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">app.config.globalProperties.useDict = useDict</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;[TOC]&lt;/p&gt;
&lt;p&gt;最近在录 TienChin 项目，项目涉及到了 Vue 中插件的定义，因此整了这么一篇文章，手把手教大家在 Vue3 中定义插件，这个技能掌握了，就可以看懂 TienChin 前端代码了。&lt;/p&gt;
    
    </summary>
    
      <category term="TienChin" scheme="http://www.javaboy.org/categories/TienChin/"/>
    
    
      <category term="TienChin" scheme="http://www.javaboy.org/tags/TienChin/"/>
    
      <category term="Vue3" scheme="http://www.javaboy.org/tags/Vue3/"/>
    
  </entry>
  
  <entry>
    <title>七月最后一天，给小伙伴们汇报下 TienChin 项目视频进度</title>
    <link href="http://www.javaboy.org/2022/0731/tienchin-video.html"/>
    <id>http://www.javaboy.org/2022/0731/tienchin-video.html</id>
    <published>2022-07-31T11:38:38.000Z</published>
    <updated>2022-12-19T11:53:34.831Z</updated>
    
    <content type="html"><![CDATA[<p>距离上次跟小伙伴们汇报 TienChin 项目视频进度已经过去一个月啦，今天是 7 月 31 号，再来汇报一下这个月视频的进展。</p><a id="more"></a><p>其实也没啥好说的，直接上目录吧！</p><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br></pre></td><td class="code"><pre><span class="line">000.开篇.mp4</span><br><span class="line">001.运行RuoYi-Vue.mp4</span><br><span class="line">002.代码格式化.mp4</span><br><span class="line">003.项目结构大改造.mp4</span><br><span class="line">004.项目改造完善.mp4</span><br><span class="line">005.项目结构分析.mp4</span><br><span class="line">006.验证码响应结果分析.mp4</span><br><span class="line">007.验证码生成接口分析.mp4</span><br><span class="line">008.验证码配置分析.mp4</span><br><span class="line">009.验证码的校验.mp4</span><br><span class="line">010.登录流程分析.mp4</span><br><span class="line">011.登录JWT校验.mp4</span><br><span class="line">012.SpringSecurity登录配置分析.mp4</span><br><span class="line">013.自定义多数据源思路分析.mp4</span><br><span class="line">014.自定义多数据源-1.mp4</span><br><span class="line">015.自定义多数据源-2.mp4</span><br><span class="line">016.手动实现网页上切换数据源.mp4</span><br><span class="line">017.RateLimiter注解简介.mp4</span><br><span class="line">018.自定义限流注解-1.mp4</span><br><span class="line">019.自定义限流注解-2.mp4</span><br><span class="line">020.RuoYi脚手架限流注解分析.mp4</span><br><span class="line">021.幂等性实现的6中思路梳理.mp4</span><br><span class="line">022.实现JSON格式参数多次读取.mp4</span><br><span class="line">023.防止请求重复提交.mp4</span><br><span class="line">024.防止接口重复提交注解分析.mp4</span><br><span class="line">025.数据权限注解介绍.mp4</span><br><span class="line">026.数据权限案例准备工作.mp4</span><br><span class="line">027.权限注解实现思路分析.mp4</span><br><span class="line">028.自定义数据权限注解@DataScope.mp4</span><br><span class="line">029.数据权限过滤角色数据.mp4</span><br><span class="line">030.数据权限过滤用户数据.mp4</span><br><span class="line">031.数据权限注解总结.mp4</span><br><span class="line">032.操作日志记录.mp4</span><br><span class="line">033.修改日志方法名称.mp4</span><br><span class="line">034.理解Aware接口.mp4</span><br><span class="line">035.自定义注解+AOP整理.mp4</span><br><span class="line">036.TienChin细化到按钮的权限实现思路.mp4</span><br><span class="line">037.理解TienChin项目中的权限注解.mp4</span><br><span class="line">038.角色和权限概念梳理.mp4</span><br><span class="line">039.Spring Security中角色和权限的区别.mp4</span><br><span class="line">040.SpringSecurity中的权限处理逻辑.mp4</span><br><span class="line">041.SpringSecurity中使用权限通配符.mp4</span><br><span class="line">042.SpringSecurity另一种权限判断方式.mp4</span><br><span class="line">043.自定义权限表达式.mp4</span><br><span class="line">044.使用POSTMAN测试项目接口.mp4</span><br><span class="line">045.自定义TienChin项目权限判断表达式.mp4</span><br><span class="line">046.登录鉴权流程梳理.mp4</span><br><span class="line">047.运行RuoYi-Vue3.mp4</span><br><span class="line">048.动态菜单实现思路.mp4</span><br><span class="line">049.动态菜单JSON分析.mp4</span><br><span class="line">050.动态菜单的path问题.mp4</span><br><span class="line">051.服务端查询当前登录用户菜单.mp4</span><br><span class="line">052.服务端构建动态菜单.mp4</span><br><span class="line">053.动态菜单实现思路梳理.mp4</span><br><span class="line">054.Vue3中的动态菜单递归渲染.mp4</span><br><span class="line">055.前端固定路由定义.mp4</span><br><span class="line">056.前端轻量级状态管理框架Pinia.mp4</span><br><span class="line">057.前端网络请求封装思路.mp4</span><br><span class="line">058.前端登录请求执行流程.mp4</span><br><span class="line">059.前端动态菜单加载思路.mp4</span><br><span class="line">060.动态菜单为什么不能存在localStorage.mp4</span><br><span class="line">061.动态菜单为什么不能存在localStorage-2.mp4</span><br><span class="line">062.前端路由导航守卫源码分析.mp4</span><br><span class="line">063.前端动态菜单加载四个核心变量.mp4</span><br><span class="line">064.routes变量多级菜单铺平.mp4</span><br><span class="line">065.component字符串转对象.mp4</span><br><span class="line">066.前端多级菜单铺平.mp4</span><br><span class="line">067.过滤前端本地动态路由.mp4</span><br><span class="line">068.前端generateRoutes方法.mp4</span><br><span class="line">【号外001】.登录流程解析.mp4</span><br><span class="line">【号外002】.分布式事务开篇.mp4</span><br><span class="line">【号外003】.分布式事务seata三个核心概念.mp4</span><br><span class="line">【号外004】.分布式事务seata四种事务模式.mp4</span><br><span class="line">【号外005】.分布式事务seata中的at模式.mp4</span><br><span class="line">【号外006】.分布式事务安装seata-server.mp4</span><br><span class="line">【号外007】.分布式事务seata-at模式实战.mp4</span><br><span class="line">【号外008】.分布式事务seata-at模式总结.mp4</span><br><span class="line">【号外009】.多数据源如何处理事务问题.mp4</span><br><span class="line">【号外010】.分布式事务seata-at模式补充.mp4</span><br><span class="line">【号外011】.分布式事务seata-tcc模式简介.mp4</span><br><span class="line">【号外012】.分布式事务seata-tcc模式实战-1.mp4</span><br><span class="line">【号外013】.分布式事务seata-tcc模式实战-2.mp4</span><br><span class="line">【号外014】.分布式事务seata-tcc模式实战-3.mp4</span><br><span class="line">【号外015】.分布式事务seata-tcc模式实战-4.mp4</span><br><span class="line">【号外016】.分布式事务seata-tcc总结.mp4</span><br><span class="line">【号外017】.分布式事务seata-xa简介.mp4</span><br><span class="line">【号外018】.MySQL中的XA事务实践.mp4</span><br><span class="line">【号外019】.分布式事务seata-xa模式实战-1.mp4</span><br><span class="line">【号外020】.分布式事务seata-xa模式实战-2.mp4</span><br><span class="line">【号外021】.分布式事务总结-1.mp4</span><br><span class="line">【号外022】.分布式事务总结-2.mp4</span><br><span class="line">【号外023】.动态代理的两种实现方式.mp4</span><br><span class="line">【号外024】.解决多数据源注解失效问题.mp4</span><br></pre></td></tr></table></figure><p><strong>目前已经录的总共是 69+24=93 集，约 25 个小时。</strong>七月份的更新主要是跟大家把动态菜单捋清楚，然后开始逐步讲一些 Vue3 相关的内容。</p><p><strong>这套视频预计更完之后内容会比较多，所以小伙伴们其实现在就可以跟着松哥慢慢敲起来了，更完再敲积累太多容易打退堂鼓。</strong></p><p>虽然我感觉自己一直在吆喝，但是还是不少小伙伴来了第一句话是“松哥又有新教程啦？”：</p><p><img src="http://img.itboyhub.com/2021/10/tran/20220731113711.png" alt></p><p>因此这里再跟大伙啰嗦一下：</p><blockquote><p>TienChin 项目是一个健身会员管理系统，基于 RuoYi-Vue 脚手架来做，使用 Spring Boot + Vue3 开发，不同于之前的 vhr 是一个脚手架，TienChin 项目的业务完成度会超过 90%。这个项目的视频教程整体上分为两大块：第一块主要是解剖 RuoYi-Vue 脚手架，让小伙伴们能够熟练掌握这个脚手架的使用，在这个过程中，我会讲许多技术点，前面列出来的视频目录都属于这一部分的内容，这个过程中我不会带领大家从头敲一边 RuoYi-Vue 脚手架，但是对项目里边的一些技术点，会有针对性的讲解，也会写一些案例来帮助大家理解这些技术点。第二块内容则主要是业务功能的完成了，业务功能涉及到的技术点主要有：SpringBoot、Vue、MyBatis Plus、MySQL、Redis、Flowable、EasyExcel、NodeJS 等。</p></blockquote><p>目前更新的视频主要出于第一阶段。</p><p>这些视频基本上都是工作之余录制的，大部分都是早上 6-8 点之间录的，所以是付费视频，视频定价是 399，不过目前可以 7 折上车，也就是 279，之前买过 vhr 的小伙伴可在此基础上再优惠 30，即只要 249，随着视频的录制，内容越来越多，折扣力度也会变小，这个之前买过 vhr 视频得小伙伴应该都懂，无论你何时上车，当前价格都是你在未来能够买到的最低价格啦。</p><p>录视频还是蛮辛苦的，一方面赚点小钱养家糊口，另一方面也是小伙伴们的认可在支撑着我把这件事做下去，得瑟一下：</p><p><img src="http://img.itboyhub.com/2021/10/tran/996.jpg" alt></p><p><img src="http://img.itboyhub.com/2021/10/tran/995.jpg" alt></p><p><img src="http://img.itboyhub.com/2021/10/tran/013.jpeg" alt></p><p><strong>有时候看小伙伴们发的，我真的特别动容。虽然大家看我天天写文章聊技术，其实我在生活中除了工作之外很少和人交流，真的特别想给这些爱学习会说话的小伙伴们点赞，他们肯定会混的比我好。</strong></p><hr><p>好啦，最后再统一回答大家几个关于视频的问题。</p><p><strong>Q1：视频放在哪里，怎么播放？</strong></p><p>视频放在百度网盘上，下载后使用专用播放器授权播放，专用播放器一机一码一人一码。至于小伙伴们推荐的阿里网盘等，由于空间、分享文件类型等限制，并无法用在 TienChin 项目视频分发中。</p><p><strong>Q2：视频为什么不支持在线播放？</strong></p><p>在线播放的话，一般都是和平台合作，但是国内大家所熟知的平台如慕课网、csdn 学院等，平台抽成基本都是 4 成起，松哥之前还合作了一个平台拿 6 成（也就是假如 100 块钱的课，平台拿走 60）。这样的分成比例无形中会推高课程的价格，现在我自己分发，所以才能做到<strong>低价</strong>。同时为了防止视频泄露，松哥对视频做了加密处理，这样可以确保大家不会在其他地方看到一模一样的免费视频，加密后的视频只能使用专用播放器播放，因此不支持在线播放。</p><p><strong>Q3：视频可以试看吗？</strong></p><p>其实我最近在公号发的视频，大家都可以当作试看的，反正的录视频风格是不变的。和 vhr 视频相比，现在的 TienChin 项目视频音质是杠杠滴，下面三个视频是我最近发过的，小伙伴们可以当作试看的视频：</p><p><strong>Q4：可以砍价吗？</strong></p><p>不可以，这个价格已经很便宜了，没法砍了（悄悄告诉大家，从 vhr 到 tienchin，暂时没有人砍价成功过）。</p><p><strong>Q5：视频多久更新完毕？</strong></p><p>其实如果单纯带着大家写业务功能，这个项目不会花太多时间，这样虽然大家完整的做了一个项目，但是技术却不会有太多长进，而我则希望在这个过程中多整点活，能让小伙伴们技术也有一些提升，这样内容一加，最终何时更完就不确定了。不过，有一点是可以保证的，每周至少一次，每周至少更一个半小时精品视频。</p><p><strong>Q6：知识星球是什么？</strong></p><p>星球主要是用来更新视频下载地址的地方，大家在这套视频教程时遇到问题时，都可以在星球上提问，小伙伴们购买视频后，我会拉你进星球。</p><p><strong>Q7：这套视频适合哪些人看？</strong></p><p>学习这套视频，首先需要有 SSM 基础，如果没有，可以在公众号后台回复 SSM，有我录制的免费视频教程；另外也需要一些 Spring Boot 基础和 Vue 基础，要是没接触过 Spring Boot 和 Vue 的话，那么建议先看看 vhr，戳这里：<a href="https://mp.weixin.qq.com/s/aIyP77WrrswWNXaueBXj7w" target="_blank" rel="noopener">Spring Boot+Vue+微人事视频教程</a></p><p><strong>Q8：看视频有问题可以问吗？</strong></p><p>参考 Q6。</p><p><strong>Q9：这套视频我能学到啥？</strong></p><p>TienChin 项目基于 RuoYi-Vue 脚手架（Spring Boot+Vue3），这套视频学完后，小伙伴们对 RuoYi-Vue 脚手架基本上就融会贯通了，并能在 RuoYi-Vue 脚手架上随心所欲的开发常规的企业后台应用。并且对于分布式事务 seata、Flowable 流程引擎等框架也能熟练使用并掌握其原理，对于 Redis 在项目中的各种实际应用场景也会有较好的掌握。</p><hr><p><strong>好啦，七折 279 抄底就在今天啦！</strong></p><p>P.s.：可能有小伙伴加了松哥多个微信，其实没有必要重复添加，任意一个都能找到我。当然，如果你还没有松哥微信，扫码加微信，转账 279 上车吧（买过 vhr 的小伙伴可在此基础上再优惠 ¥30 哦）～</p><p><img src="http://img.itboyhub.com/2021/10/tran/20220731113838.png" alt></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;距离上次跟小伙伴们汇报 TienChin 项目视频进度已经过去一个月啦，今天是 7 月 31 号，再来汇报一下这个月视频的进展。&lt;/p&gt;
    
    </summary>
    
      <category term="TienChin" scheme="http://www.javaboy.org/categories/TienChin/"/>
    
    
      <category term="TienChin" scheme="http://www.javaboy.org/tags/TienChin/"/>
    
  </entry>
  
  <entry>
    <title>不用Swagger，那我用啥？</title>
    <link href="http://www.javaboy.org/2022/0728/openapi.html"/>
    <id>http://www.javaboy.org/2022/0728/openapi.html</id>
    <published>2022-07-28T11:38:12.000Z</published>
    <updated>2022-12-19T11:53:30.585Z</updated>
    
    <content type="html"><![CDATA[<p>[TOC]</p><p>上周松哥写了一篇文章和小伙伴们分享 Swagger3 在 Spring Boot 中的用法，评论中有不少小伙伴推荐 Spring Doc，松哥趁着休息时间抽空看了下，这个东西确实不错，不存在和 Spring Boot 之间的兼容问题，于是就撸了这篇文章和小伙伴们分享。一起来看看这个好玩的文档生成工具吧！</p><a id="more"></a><h2 id="1-OpenApi"><a href="#1-OpenApi" class="headerlink" title="1. OpenApi"></a>1. OpenApi</h2><p>在正式学习 Spring Doc 之前，先给大家介绍一下 OpenAPI。</p><p>OpenApi 是一个业界的 API 文档标准，是一个规范，这个规范目前有两大实现，分别是：</p><ul><li>SpringFox</li><li>SpringDoc</li></ul><p>其中 SpringFox 其实也就是我们之前所说的 Swagger，SpringDoc 则是我们今天要说的内容。</p><p>OpenApi 就像 JDBC 一样，制定了各种各样的规范，而 Swagger 和 SpringDoc 则类似于各种各样的数据库驱动，是具体的实现。</p><p>所以可能很多小伙伴也发现了，Swagger 和 Spring Doc 有一些相似的地方，这就是因为他们都遵守了相同的规范。</p><p>不过呢，Swagger 更新有点慢吞吞的，为了能够和新版的 Spring Boot 整合，还是 SpringDoc 更值得体验一把。</p><p>SpringDoc 支持：</p><ul><li>OpenAPI 3</li><li>Spring-boot，全版本都支持。</li><li>JSR-303 中提供的一些注解，例如 <code>@NotNull</code>、<code>@Min</code>、<code>@Max</code> 以及 <code>@Size</code> 等。</li><li>Swagger-ui：SpringDoc 提供的接口 JSON 也可以通过 Swagger-ui 展示出来。</li><li>OAuth 2</li><li>…</li></ul><h2 id="2-引入-SpringDoc"><a href="#2-引入-SpringDoc" class="headerlink" title="2. 引入 SpringDoc"></a>2. 引入 SpringDoc</h2><p>小伙伴们知道，这种生成接口文档的工具，一般来说都是两方面的功能：</p><ul><li>生成接口文档 JSON。</li><li>渲染接口文档 JSON。</li></ul><p>所以，当我们使用 SpringDoc 的时候，如果只是想要生成接口文档 JSON，那么只需要添加如下依赖即可：</p><figure class="highlight xml hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span></span><br><span class="line">    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springdoc<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span></span><br><span class="line">    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>springdoc-openapi-webmvc-core<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.6.9<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span></span><br><span class="line"><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>此时，就会针对项目中的接口自动生成接口的 JSON 文档，类似下面这样：</p><p><img src="http://img.itboyhub.com/2021/10/tran/20220725224736.png" alt></p><p>这样的 JSON 信息开发者可以自行将之绘制出来，也可以使用网上一些现成的工具例如 Knife4j 之类的。当然你要是不想费事，也可以使用 SwaggerUI 将之绘制出来，如果想使用网页，那么就不要使用上面的依赖，用下面这个依赖，不仅可以生成 JSON 接口，还可以生成渲染后的网页：</p><figure class="highlight xml hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span></span><br><span class="line">    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springdoc<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span></span><br><span class="line">    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>springdoc-openapi-ui<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.6.9<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span></span><br><span class="line"><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>网页效果如下图：</p><p><img src="http://img.itboyhub.com/2021/10/tran/20220725225230.png" alt></p><p>这个网页看着眼熟，其实就是 Swagger UI。</p><p>这个网页上有一个输入框，输入的内容是 <code>/v3/api-docs</code>，这个地址就是这个网页想要渲染的 JSON 的地址，如果开发者修改了生成的 JSON API 文档的地址，那么就需要手动在这个输入框中输入一下 JSON API 文档的地址。</p><p>默认的 JSON API 文档地址是：</p><ul><li>/v3/api-docs</li></ul><p>默认的网页 UI 地址是：</p><ul><li>/swagger-ui/index.html</li></ul><p>如果需要配置，则可以在 Spring Boot 的 application.properties 中直接进行配置：</p><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">springdoc.swagger-ui.path=/javaboy-ui</span><br><span class="line">springdoc.api-docs.path=/javaboy-api</span><br></pre></td></tr></table></figure><p>不过这两个配置并不是真的修改了访问路径，这两个相当于给访问路径取了一个别名，访问这两个时会自动重定向到对应的路径上。</p><h2 id="3-结合-Spring-Security"><a href="#3-结合-Spring-Security" class="headerlink" title="3. 结合 Spring Security"></a>3. 结合 Spring Security</h2><p>如果我们的项目中使用了 Spring Security，那么部分接口的参数可能会比较特殊，例如下面这个接口：</p><figure class="highlight java hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-meta">@RestController</span></span><br><span class="line"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">HelloController</span> </span>&#123;</span><br><span class="line">    <span class="hljs-meta">@GetMapping</span>(<span class="hljs-string">"/hello"</span>)</span><br><span class="line">    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">hello</span><span class="hljs-params">(@AuthenticationPrincipal User user)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="hljs-string">"user = "</span> + user);</span><br><span class="line">        <span class="hljs-keyword">return</span> <span class="hljs-string">"hello"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>这个接口的参数加上了一个 <code>@AuthenticationPrincipal</code> 注解表示当前登录成功的用户对象，这个参数在实际使用中，并不需要前端传递，服务端会自动注入该参数。</p><p>但是！如果使用了 SpringDoc，通过网页去调用这个接口的时候，这个参数就必须要要传递，对于这种问题，我们可以引入如下依赖自动帮我们解决：</p><figure class="highlight xml hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span></span><br><span class="line">    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springdoc<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span></span><br><span class="line">    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>springdoc-openapi-security<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.6.9<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span></span><br><span class="line"><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>这个依赖会自动帮我们忽略掉接口中带有 @AuthenticationPrincipal 注解的参数，这样我们在通过 swagger-ui 去进行接口测试的时候就不需要传递这个参数了。</p><h2 id="4-结合-Spring-Data-Rest"><a href="#4-结合-Spring-Data-Rest" class="headerlink" title="4. 结合 Spring Data Rest"></a>4. 结合 Spring Data Rest</h2><p>Spring Boot 中提供了 Spring Data Rest，结合 Jpa 可以非常方便的构建出 Restful 应用。但是这种 Restful 应用不需要开发者自己写接口，那么怎么生成接口文档呢（连接口在哪里都不知道）？针对于此，SpringDoc 也提供了相关的支持，我们一起来看下。</p><h3 id="4-1-Spring-Data-Rest"><a href="#4-1-Spring-Data-Rest" class="headerlink" title="4.1 Spring Data Rest"></a>4.1 Spring Data Rest</h3><h4 id="创建工程"><a href="#创建工程" class="headerlink" title="创建工程"></a>创建工程</h4><p>首先创建一个 Spring Boot 工程，引入 <code>Web</code> 、 <code>Jpa</code> 、 <code>MySQL</code> 、<code>Rest Repositories</code> 依赖：</p><p><img src="http://img.itboyhub.com/2021/10/tran/20220726194628.png" alt></p><h4 id="配置数据库"><a href="#配置数据库" class="headerlink" title="配置数据库"></a>配置数据库</h4><p>主要配置两个，一个是数据库，另一个是 Jpa：</p><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">spring.datasource.username=root</span><br><span class="line">spring.datasource.password=1234</span><br><span class="line">spring.datasource.url=jdbc:mysql:///test02?serverTimezone=Asia/Shanghai</span><br><span class="line"></span><br><span class="line">spring.jpa.hibernate.ddl-auto=update</span><br><span class="line">spring.jpa.show-sql=true</span><br><span class="line">spring.jpa.database=mysql</span><br><span class="line">spring.jpa.database-platform=mysql</span><br><span class="line">spring.jpa.properties.hibernate.dialect=org.hibernate.dialect.MySQL57Dialect</span><br></pre></td></tr></table></figure><p>这里的配置，和 Jpa 中的基本一致。</p><p>前面三行配置了数据库的基本信息，包括数据库连接池、数据库用户名、数据库密码、数据库连接地址以及数据库驱动名称。</p><p>接下来的五行配置了 JPA 的基本信息，分别表示生成 SQL 的方言、打印出生成的 SQL 、每次启动项目时根据实际情况选择是否更新表、数据库平台是 MySQL。</p><p>这两段配置是关于 MySQL + JPA 的配置，没用过 JPA 的小伙伴可以参考松哥之前的 JPA 文章：<a href="http://www.javaboy.org/2019/0407/springboot-jpa.html">http://www.javaboy.org/2019/0407/springboot-jpa.html</a></p><h4 id="构建实体类"><a href="#构建实体类" class="headerlink" title="构建实体类"></a>构建实体类</h4><figure class="highlight java hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-meta">@Entity</span>(name = <span class="hljs-string">"t_book"</span>)</span><br><span class="line"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Book</span> </span>&#123;</span><br><span class="line">    <span class="hljs-meta">@Id</span></span><br><span class="line">    <span class="hljs-meta">@GeneratedValue</span>(strategy = GenerationType.IDENTITY)</span><br><span class="line">    <span class="hljs-keyword">private</span> Long id;</span><br><span class="line">    <span class="hljs-meta">@Column</span>(name = <span class="hljs-string">"book_name"</span>)</span><br><span class="line">    <span class="hljs-keyword">private</span> String name;</span><br><span class="line">    <span class="hljs-keyword">private</span> String author;</span><br><span class="line">    <span class="hljs-comment">//省略 getter/setter</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">BookRepository</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">JpaRepository</span>&lt;<span class="hljs-title">Book</span>,<span class="hljs-title">Long</span>&gt; </span>&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>这里一个是配置了一个实体类 Book，另一个则是配置了一个 BookRepository ，项目启动成功后，框架会根据 Book 类的定义，在数据库中自动创建相应的表，BookRepository 接口则是继承自 JpaRepository ，JpaRepository 中自带了一些基本的增删改查方法。</p><p>好了，代码写完了。</p><p>啥？你好像啥都没写啊？是的，啥都没写，啥都不用写，一个 RESTful 风格的增删改查应用就有了，这就是 Spring Boot 的魅力！</p><h4 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h4><p>此时，我们就可以启动项目进行测试了，使用 POSTMAN 来测试（大家也可以自行选择趁手的 HTTP 请求工具）。</p><p>此时我们的项目已经默认具备了一些接口，我们分别来看：</p><h6 id="根据-id-查询接口"><a href="#根据-id-查询接口" class="headerlink" title="根据 id 查询接口"></a>根据 id 查询接口</h6><ul><li><a href="http://127.0.0.1:8080/books/{id}" target="_blank" rel="noopener">http://127.0.0.1:8080/books/{id}</a></li></ul><p>这个接口表示根据 id 查询某一本书：</p><p><img src="http://img.itboyhub.com/2021/springboot2/31-2.png" alt></p><h6 id="分页查询"><a href="#分页查询" class="headerlink" title="分页查询"></a>分页查询</h6><ul><li><a href="http://127.0.0.1:8080/books" target="_blank" rel="noopener">http://127.0.0.1:8080/books</a></li></ul><p>这是一个批量查询接口，默认请求路径是类名首字母小写，并且再加一个 s 后缀。这个接口实际上是一个分页查询接口，没有传参数，表示查询第一页，每页 20 条数据。</p><p><img src="http://img.itboyhub.com/2021/springboot2/31-3.png" alt></p><p>查询结果中，除了该有的数据之外，也包含了分页数据：</p><p><img src="http://img.itboyhub.com/2021/springboot2/31-4.png" alt></p><p>分页数据中：</p><ol><li>size 表示每页查询记录数</li><li>totalElements 表示总记录数</li><li>totalPages 表示总页数</li><li>number 表示当前页数，从0开始计</li></ol><p>如果要分页或者排序查询，可以使用 _links 中的链接。<code>http://127.0.0.1:8080/books?page=1&amp;size=3&amp;sort=id,desc</code> 。</p><p><img src="http://img.itboyhub.com/2021/springboot2/31-5.png" alt></p><h6 id="添加"><a href="#添加" class="headerlink" title="添加"></a>添加</h6><p>也可以添加数据，添加是 POST 请求，数据通过 JSON 的形式传递，如下：</p><p><img src="http://img.itboyhub.com/2021/springboot2/31-6.png" alt></p><p>添加成功之后，默认会返回添加成功的数据。</p><h6 id="修改"><a href="#修改" class="headerlink" title="修改"></a>修改</h6><p>修改接口默认也是存在的，数据修改请求是一个 PUT 请求，修改的参数也是通过 JSON 的形式传递：</p><p><img src="http://img.itboyhub.com/2021/springboot2/31-7.png" alt></p><p>默认情况下，修改成功后，会返回修改成功的数据。</p><h6 id="删除"><a href="#删除" class="headerlink" title="删除"></a>删除</h6><p>当然也可以通过 DELETE 请求根据 id 删除数据：</p><p><img src="http://img.itboyhub.com/2021/springboot2/31-8.png" alt></p><p>删除成功后，是没有返回值的。</p><p>不需要几行代码，一个基本的增删改查就有了。</p><p>这些都是默认的配置，这些默认的配置实际上都是在 JpaRepository 的基础上实现的，实际项目中，我们还可以对这些功能进行定制。</p><h4 id="查询定制"><a href="#查询定制" class="headerlink" title="查询定制"></a>查询定制</h4><p>最广泛的定制，就是查询，因为增删改操作的变化不像查询这么丰富。对于查询的定制，非常容易，只需要提供相关的方法即可。例如根据作者查询书籍：</p><figure class="highlight java hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">BookRepository</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">JpaRepository</span>&lt;<span class="hljs-title">Book</span>,<span class="hljs-title">Long</span>&gt; </span>&#123;</span><br><span class="line">    <span class="hljs-function">List&lt;Book&gt; <span class="hljs-title">findBookByAuthorContaining</span><span class="hljs-params">(@Param(<span class="hljs-string">"author"</span>)</span> String author)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>注意，方法的定义，参数要有 @Param 注解。</p><p>定制完成后，重启项目，此时就多了一个查询接口，开发者可以通过 <a href="http://localhost:8080/books/search" target="_blank" rel="noopener">http://localhost:8080/books/search</a> 来查看和 book 相关的自定义接口都有哪些：</p><p><img src="http://img.itboyhub.com/2021/springboot2/31-9.png" alt></p><p>查询结果表示，只有一个自定义接口，接口名就是方法名，而且查询结果还给出了接口调用的示例。我们来尝试调用一下自己定义的查询接口：</p><p><img src="http://img.itboyhub.com/2021/springboot2/31-10.png" alt></p><p>开发者可以根据实际情况，在 BookRepository 中定义任意多个查询方法，查询方法的定义规则和 Jpa 中一模一样（不懂 Jpa 的小伙伴，可以参考<a href="https://mp.weixin.qq.com/s/Fg5ssXuvabZwEfRMKfpY9Q" target="_blank" rel="noopener">干货|一文读懂 Spring Data Jpa！</a>，或者在松哥个人网站 <a href="http://www.javaboy.org">www.javaboy.org</a> 上搜索 JPA，有相关教程参考）。但是，这样有一个缺陷，就是 Jpa 中方法名太长，因此，如果不想使用方法名作为接口名，则可以自定义接口名：</p><figure class="highlight java hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">BookRepository</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">JpaRepository</span>&lt;<span class="hljs-title">Book</span>, <span class="hljs-title">Long</span>&gt; </span>&#123;</span><br><span class="line">    <span class="hljs-meta">@RestResource</span>(rel = <span class="hljs-string">"byauthor"</span>,path = <span class="hljs-string">"byauthor"</span>)</span><br><span class="line">    <span class="hljs-function">List&lt;Book&gt; <span class="hljs-title">findBookByAuthorContaining</span><span class="hljs-params">(@Param(<span class="hljs-string">"author"</span>)</span> String author)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>@RestResource 注解中，两个参数的含义：</p><ul><li>rel 表示接口查询中，这个方法的 key            </li><li>path 表示请求路径</li></ul><p>这样定义完成后，表示接口名为 byauthor ，重启项目，继续查询接口：</p><p><img src="http://img.itboyhub.com/2021/springboot2/31-11.png" alt></p><p>除了 <code>rel</code> 和 <code>path</code> 两个属性之外，<code>@RestResource</code> 中还有一个属性，<code>exported</code> 表示是否暴露接口，默认为 <code>true</code> ，表示暴露接口，即方法可以在前端调用，如果仅仅只是想定义一个方法，不需要在前端调用这个方法，可以设置 <code>exported</code> 属性为 <code>false</code> 。</p><p>如果不想暴露官方定义好的方法，例如根据 <code>id</code> 删除数据，只需要在自定义接口中重写该方法，然后在该方法上加 <code>@RestResource</code> 注解并且配置相关属性即可。</p><figure class="highlight java hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">BookRepository</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">JpaRepository</span>&lt;<span class="hljs-title">Book</span>, <span class="hljs-title">Long</span>&gt; </span>&#123;</span><br><span class="line">    <span class="hljs-meta">@RestResource</span>(rel = <span class="hljs-string">"byauthor"</span>,path = <span class="hljs-string">"byauthor"</span>)</span><br><span class="line">    <span class="hljs-function">List&lt;Book&gt; <span class="hljs-title">findBookByAuthorContaining</span><span class="hljs-params">(@Param(<span class="hljs-string">"author"</span>)</span> String author)</span>;</span><br><span class="line">    <span class="hljs-meta">@Override</span></span><br><span class="line">    <span class="hljs-meta">@RestResource</span>(exported = <span class="hljs-keyword">false</span>)</span><br><span class="line">    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">deleteById</span><span class="hljs-params">(Long aLong)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>另外生成的 JSON 字符串中的集合名和单个 <code>item</code> 的名字都是可以自定义的：</p><figure class="highlight java hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-meta">@RepositoryRestResource</span>(collectionResourceRel = <span class="hljs-string">"bs"</span>,itemResourceRel = <span class="hljs-string">"b"</span>,path = <span class="hljs-string">"bs"</span>)</span><br><span class="line"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">BookRepository</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">JpaRepository</span>&lt;<span class="hljs-title">Book</span>, <span class="hljs-title">Long</span>&gt; </span>&#123;</span><br><span class="line">    <span class="hljs-meta">@RestResource</span>(rel = <span class="hljs-string">"byauthor"</span>,path = <span class="hljs-string">"byauthor"</span>)</span><br><span class="line">    <span class="hljs-function">List&lt;Book&gt; <span class="hljs-title">findBookByAuthorContaining</span><span class="hljs-params">(@Param(<span class="hljs-string">"author"</span>)</span> String author)</span>;</span><br><span class="line">    <span class="hljs-meta">@Override</span></span><br><span class="line">    <span class="hljs-meta">@RestResource</span>(exported = <span class="hljs-keyword">false</span>)</span><br><span class="line">    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">deleteById</span><span class="hljs-params">(Long aLong)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>path</code> 属性表示请求路径，请求路径默认是类名首字母小写+s，可以在这里自己重新定义。</p><h4 id="其他配置"><a href="#其他配置" class="headerlink" title="其他配置"></a>其他配置</h4><p>最后，也可以在 application.properties 中配置 REST 基本参数：</p><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">spring.data.rest.base-path=/api</span><br><span class="line">spring.data.rest.sort-param-name=sort</span><br><span class="line">spring.data.rest.page-param-name=page</span><br><span class="line">spring.data.rest.limit-param-name=size</span><br><span class="line">spring.data.rest.max-page-size=20</span><br><span class="line">spring.data.rest.default-page-size=0</span><br><span class="line">spring.data.rest.return-body-on-update=true</span><br><span class="line">spring.data.rest.return-body-on-create=true</span><br></pre></td></tr></table></figure><p>配置含义，从上往下，依次是：</p><ol><li>给所有的接口添加统一的前缀</li><li>配置排序参数的 key ，默认是 sort</li><li>配置分页查询时页码的 key，默认是 page</li><li>配置分页查询时每页查询页数的 key，默认是size</li><li>配置每页最大查询记录数，默认是 20 条</li><li>分页查询时默认的页码</li><li>更新成功时是否返回更新记录</li><li>添加成功时是否返回添加记录</li></ol><p>这是 Spring Data Rest 的一个简单用法，接下来我们来看如何给这个生成的文档。</p><h3 id="4-2-生成接口文档"><a href="#4-2-生成接口文档" class="headerlink" title="4.2 生成接口文档"></a>4.2 生成接口文档</h3><p>对于这种你都没看到接口的，我们只需要添加如下依赖，就可以自动生成 API 文档了，如下：</p><figure class="highlight xml hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span></span><br><span class="line">    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springdoc<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span></span><br><span class="line">    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>springdoc-openapi-data-rest<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.6.9<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span></span><br><span class="line"><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span></span><br><span class="line"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span></span><br><span class="line">    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springdoc<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span></span><br><span class="line">    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>springdoc-openapi-ui<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.6.9<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span></span><br><span class="line"><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>生成的接口文档如下：</p><p><img src="http://img.itboyhub.com/2021/10/tran/20220726194702.png" alt></p><h2 id="5-结合-Actuator"><a href="#5-结合-Actuator" class="headerlink" title="5. 结合 Actuator"></a>5. 结合 Actuator</h2><p>在之前的 Spring Boot 教程中，松哥还和大家介绍过 Spring Boot 中的 actuator，这个工具可以自行生成项目运行数据的端点（endpoints），如果想把这些端点也纳入到 SpringDoc 中来，那么只需要添加如下配置即可：</p><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">springdoc.show-actuator=true</span><br></pre></td></tr></table></figure><p>至于 SpringDoc 会显示多少个 Actuator 端点出来，那就要看 Actuator 暴露出来多少端点了，最终显示效果如下：</p><p><img src="http://img.itboyhub.com/2021/10/tran/20220726194716.png" alt></p><p>不过这里还有一个玩法！</p><p>SpringDoc 扮演的角色毕竟不是业务功能，而是项目的辅助功能，所以，我们可以将之从业务中剥离，放到 Actuator 中，毕竟 Actuator 专干这种事。那么只需要增加如下两个配置即可：</p><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">springdoc.use-management-port=true</span><br><span class="line">management.endpoints.web.exposure.include=openapi, swagger-ui</span><br><span class="line">management.server.port=9090</span><br></pre></td></tr></table></figure><p>配置完成后，将来就可以在 Actuator 中去查看接口文档和对应的页面了，访问地址是：</p><ul><li><a href="http://localhost:9090/actuator/swagger-ui/index.html" target="_blank" rel="noopener">http://localhost:9090/actuator/swagger-ui/index.html</a></li></ul><p><img src="http://img.itboyhub.com/2021/10/tran/20220726195002.png" alt></p><h2 id="6-切换到-Swagger"><a href="#6-切换到-Swagger" class="headerlink" title="6. 切换到 Swagger"></a>6. 切换到 Swagger</h2><p>如果你在项目中已经使用了 Swagger 了，那么也可以非常方便的切换到 SpringDoc 上面来，切换的时候，首先引入 SpringDoc 依赖：</p><figure class="highlight xml hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span></span><br><span class="line">   <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springdoc<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span></span><br><span class="line">   <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>springdoc-openapi-ui<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span></span><br><span class="line">   <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.6.9<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span></span><br><span class="line"><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>Swagger 和 SpringDoc 注解的对应关系如下：</p><ul><li>@Api → @Tag</li><li>@ApiIgnore → @Parameter(hidden = true) or @Operation(hidden = true) or @Hidden</li><li>@ApiImplicitParam → @Parameter</li><li>@ApiImplicitParams → @Parameters</li><li>@ApiModel → @Schema</li><li>@ApiModelProperty(hidden = true) → @Schema(accessMode = READ_ONLY)</li><li>@ApiModelProperty → @Schema</li><li>@ApiOperation(value = “foo”, notes = “bar”) → @Operation(summary = “foo”, description = “bar”)</li><li>@ApiParam → @Parameter</li><li>@ApiResponse(code = 404, message = “foo”) → @ApiResponse(responseCode = “404”, description = “foo”)</li></ul><p>以前我们在 Swagger 中配置接口扫描的方式如下：</p><figure class="highlight java hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-meta">@Bean</span></span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">public</span> Docket <span class="hljs-title">publicApi</span><span class="hljs-params">()</span> </span>&#123;</span><br><span class="line">    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> Docket(DocumentationType.SWAGGER_2)</span><br><span class="line">            .select()</span><br><span class="line">            .apis(RequestHandlerSelectors.basePackage(<span class="hljs-string">"org.github.springshop.web.public"</span>))</span><br><span class="line">            .paths(PathSelectors.regex(<span class="hljs-string">"/public.*"</span>))</span><br><span class="line">            .build()</span><br><span class="line">            .groupName(<span class="hljs-string">"springshop-public"</span>)</span><br><span class="line">            .apiInfo(apiInfo());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="hljs-meta">@Bean</span></span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">public</span> Docket <span class="hljs-title">adminApi</span><span class="hljs-params">()</span> </span>&#123;</span><br><span class="line">    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> Docket(DocumentationType.SWAGGER_2)</span><br><span class="line">            .select()</span><br><span class="line">            .apis(RequestHandlerSelectors.basePackage(<span class="hljs-string">"org.github.springshop.web.admin"</span>))</span><br><span class="line">            .paths(PathSelectors.regex(<span class="hljs-string">"/admin.*"</span>))</span><br><span class="line">            .apis(RequestHandlerSelectors.withMethodAnnotation(Admin.class))</span><br><span class="line">            .build()</span><br><span class="line">            .groupName(<span class="hljs-string">"springshop-admin"</span>)</span><br><span class="line">            .apiInfo(apiInfo());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>现在在 SpringDoc 中则按照如下方式进行配置即可（还可以按照注解去标记需要生成接口文档的方法）：</p><figure class="highlight java hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-meta">@Configuration</span></span><br><span class="line"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SpringDocConfig</span> </span>&#123;</span><br><span class="line">    <span class="hljs-meta">@Bean</span></span><br><span class="line">    <span class="hljs-function"><span class="hljs-keyword">public</span> GroupedOpenApi <span class="hljs-title">publicApi</span><span class="hljs-params">()</span> </span>&#123;</span><br><span class="line">        <span class="hljs-keyword">return</span> GroupedOpenApi.builder()</span><br><span class="line">                .group(<span class="hljs-string">"springshop-public"</span>)</span><br><span class="line">                .pathsToMatch(<span class="hljs-string">"/public/**"</span>)</span><br><span class="line">                .build();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="hljs-meta">@Bean</span></span><br><span class="line">    <span class="hljs-function"><span class="hljs-keyword">public</span> GroupedOpenApi <span class="hljs-title">adminApi</span><span class="hljs-params">()</span> </span>&#123;</span><br><span class="line">        <span class="hljs-keyword">return</span> GroupedOpenApi.builder()</span><br><span class="line">                .group(<span class="hljs-string">"springshop-admin"</span>)</span><br><span class="line">                .pathsToMatch(<span class="hljs-string">"/admin/**"</span>)</span><br><span class="line">                .addOpenApiMethodFilter(method -&gt; method.isAnnotationPresent(RequestMapping.class))</span><br><span class="line">                .build();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>当然，如果你并不需要对接口文档进行分组，那么也可以不使用 Java 配置，直接在 application.properties 中进行配置即可：</p><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">springdoc.packages-to-scan=org.javaboy.spring_doc.controller</span><br><span class="line">springdoc.paths-to-match=/**</span><br></pre></td></tr></table></figure><p>在 SpringDoc 中，如果你想配置 Swagger UI，则可以通过如下方式进行配置：</p><figure class="highlight java hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-meta">@Bean</span></span><br><span class="line"><span class="hljs-function">OpenAPI <span class="hljs-title">springShopOpenAPI</span><span class="hljs-params">()</span> </span>&#123;</span><br><span class="line">    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> OpenAPI()</span><br><span class="line">            .info(<span class="hljs-keyword">new</span> Info().title(<span class="hljs-string">"江南一点雨"</span>)</span><br><span class="line">                    .description(<span class="hljs-string">"Spring Boot 教程"</span>)</span><br><span class="line">                    .version(<span class="hljs-string">"v0.0.1"</span>)</span><br><span class="line">                    .license(<span class="hljs-keyword">new</span> License().name(<span class="hljs-string">"Apache 2.0"</span>).url(<span class="hljs-string">"http://www.javaboy.org"</span>)))</span><br><span class="line">            .externalDocs(<span class="hljs-keyword">new</span> ExternalDocumentation()</span><br><span class="line">                    .description(<span class="hljs-string">"一些描述信息"</span>)</span><br><span class="line">                    .url(<span class="hljs-string">"https://github.com/lenve/vhr"</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>好啦，常见用法大概就是这样，感兴趣的小伙伴可以去试试哦~关于 SpringDoc 的更多玩法，大家也可以参考官方文档：springdoc.org。</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;[TOC]&lt;/p&gt;
&lt;p&gt;上周松哥写了一篇文章和小伙伴们分享 Swagger3 在 Spring Boot 中的用法，评论中有不少小伙伴推荐 Spring Doc，松哥趁着休息时间抽空看了下，这个东西确实不错，不存在和 Spring Boot 之间的兼容问题，于是就撸了这篇文章和小伙伴们分享。一起来看看这个好玩的文档生成工具吧！&lt;/p&gt;
    
    </summary>
    
      <category term="TienChin" scheme="http://www.javaboy.org/categories/TienChin/"/>
    
    
      <category term="TienChin" scheme="http://www.javaboy.org/tags/TienChin/"/>
    
      <category term="Swagger" scheme="http://www.javaboy.org/tags/Swagger/"/>
    
  </entry>
  
  <entry>
    <title>手把手教你在 Vue3 中自定义指令</title>
    <link href="http://www.javaboy.org/2022/0725/vue-directive.html"/>
    <id>http://www.javaboy.org/2022/0725/vue-directive.html</id>
    <published>2022-07-25T14:23:25.000Z</published>
    <updated>2022-12-17T14:25:14.181Z</updated>
    
    <content type="html"><![CDATA[<p>[TOC]</p><p>TienChin 项目前端是 Vue3，前端有这样的一个需求：有一些前端页面上的按钮要根据用户的权限来决定是否展示出来，如果用户具备相应的权限，那么就展示对应的按钮；如果用户不具备对应的权限，那么按钮就隐藏起来。大致上就这样一个需求。</p><a id="more"></a><p>看到这个需求，可能有小伙伴首先想到用 v-if 指令，这个指令确实也能做，但是，由于用户具备的权限一般来说可能是多个，甚至可能还有通配符，所以这个比对并不是一个容易的事情，肯定得写方法。。。所以，如果能用一个指令来实现这个功能，那么就会显得专业很多了。</p><p>说干就干，我们来看看 Vue3 中如何自定义指令。</p><h2 id="1-成果展示"><a href="#1-成果展示" class="headerlink" title="1. 成果展示"></a>1. 成果展示</h2><p>我们先来看看实现自定义指令最终的使用方式：</p><figure class="highlight html hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-tag">&lt;<span class="hljs-name">button</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">"btnClick"</span> <span class="hljs-attr">v-hasPermission</span>=<span class="hljs-string">"['user:delete']"</span>&gt;</span>删除用户<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span><br></pre></td></tr></table></figure><p>小伙伴们看到，这个 <code>v-hasPermission</code> 就是我们的自定义指令，如果当前用户具备 <code>user:delete</code> 权限，这个按钮就会展示出来，如果当前用户不具备这个权限，这个按钮就不会展示出来。</p><h2 id="2-指令基础"><a href="#2-指令基础" class="headerlink" title="2. 指令基础"></a>2. 指令基础</h2><p>先要和小伙伴们说一下，Vue2 和 Vue3 在自定义指令上有一些差异，并不完全一致，下面的介绍主要是针对 Vue3 的介绍。</p><p>我先来和小伙伴们分享一下我们具体是怎么做的，然后在讲解代码的时候再来和大家说说各个参数的含义。</p><h3 id="2-1-两种作用域"><a href="#2-1-两种作用域" class="headerlink" title="2.1 两种作用域"></a>2.1 两种作用域</h3><p>自定义指令可以定义全局的，也可以定义局部的。</p><p>在正式开搞之前，小伙伴们需要先明白，自定义指令有两种作用域，一种是局部的自定义指令，还有一种是全局的自定义指令。局部的自定义指令就只能在当前 <code>.vue</code> 文件中使用，全局的则可以在所有的 <code>.vue</code> 文件中使用。</p><h4 id="2-1-1-局部指令"><a href="#2-1-1-局部指令" class="headerlink" title="2.1.1 局部指令"></a>2.1.1 局部指令</h4><p>直接在当前 .vue 文件中定义即可，如下：</p><figure class="highlight js hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">directives: &#123;</span><br><span class="line">  focus: &#123;</span><br><span class="line">    <span class="hljs-comment">// 指令的定义</span></span><br><span class="line">    mounted(el) &#123;</span><br><span class="line">      el.focus()</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>不过，在 Vue3 中，也可以这样写：</p><figure class="highlight js hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">        &lt;button v-onceClick=<span class="hljs-string">"10000"</span> @click=<span class="hljs-string">"btnClick"</span>&gt;ClickMe&lt;<span class="hljs-regexp">/button&gt;</span></span><br><span class="line"><span class="hljs-regexp">    &lt;/</span>div&gt;</span><br><span class="line">&lt;<span class="hljs-regexp">/template&gt;</span></span><br><span class="line"><span class="hljs-regexp"></span></span><br><span class="line"><span class="hljs-regexp">&lt;script&gt;</span></span><br><span class="line"><span class="hljs-regexp"></span></span><br><span class="line"><span class="hljs-regexp">    import &#123;ref&#125; from 'vue';</span></span><br><span class="line"><span class="hljs-regexp"></span></span><br><span class="line"><span class="hljs-regexp">    export default &#123;</span></span><br><span class="line"><span class="hljs-regexp">        name: "MyVue01",</span></span><br><span class="line"><span class="hljs-regexp">        setup() &#123;</span></span><br><span class="line"><span class="hljs-regexp">            const a = ref(1);</span></span><br><span class="line"><span class="hljs-regexp">            const btnClick = () =&gt; &#123;</span></span><br><span class="line"><span class="hljs-regexp">                a.value++;</span></span><br><span class="line"><span class="hljs-regexp">            &#125;</span></span><br><span class="line"><span class="hljs-regexp">            return &#123;a, btnClick&#125;</span></span><br><span class="line"><span class="hljs-regexp">        &#125;,</span></span><br><span class="line"><span class="hljs-regexp">        directives: &#123;</span></span><br><span class="line"><span class="hljs-regexp">            onceClick: &#123;</span></span><br><span class="line"><span class="hljs-regexp">                mounted(el, binding, vnode) &#123;</span></span><br><span class="line"><span class="hljs-regexp">                    el.addEventListener('click', () =&gt; &#123;</span></span><br><span class="line"><span class="hljs-regexp">                        if (!el.disabled) &#123;</span></span><br><span class="line"><span class="hljs-regexp">                            el.disabled = true;</span></span><br><span class="line"><span class="hljs-regexp">                            setTimeout(() =&gt; &#123;</span></span><br><span class="line"><span class="hljs-regexp">                                el.disabled = false;</span></span><br><span class="line"><span class="hljs-regexp">                            &#125;, binding.value || 1000);</span></span><br><span class="line"><span class="hljs-regexp">                        &#125;</span></span><br><span class="line"><span class="hljs-regexp">                    &#125;);</span></span><br><span class="line"><span class="hljs-regexp">                &#125;</span></span><br><span class="line"><span class="hljs-regexp">            &#125;</span></span><br><span class="line"><span class="hljs-regexp">        &#125;</span></span><br><span class="line"><span class="hljs-regexp">    &#125;</span></span><br><span class="line"><span class="hljs-regexp">&lt;/</span>script&gt;</span><br></pre></td></tr></table></figure><p>这里我自定义了一个名叫 onceClick 的指令，给一个 button 按钮加上这个指令之后，可以设置这个 button 按钮在点击多久之后，处于禁用状态，防止用户重复点击。</p><p>小伙伴们看，这个指令的执行逻辑其实很简单，el 相当于添加了这个指令的元素，监听该元素的点击事件，如果点击该元素时，该元素不是处于禁用状态，那么就设置该元素为禁用，给一个定时任务，到期后使该元素变为可用。这里边具体的参数，松哥下面会跟大家详细介绍。</p><p>不过这只是一个局部指令，只能在当前 .vue 文件中使用，我们也可以定义全局指令，这样就可以在所有的 .vue 文件中使用了。</p><h4 id="2-1-2-全局指令"><a href="#2-1-2-全局指令" class="headerlink" title="2.1.2 全局指令"></a>2.1.2 全局指令</h4><p>全局指令我们一般写在 main.js 中，或者写一个单独的 js 文件然后在 main.js 中引入，下面的例子是直接写在 main.js 中：</p><figure class="highlight js hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">const</span> app = createApp(App);</span><br><span class="line"></span><br><span class="line">app.directive(<span class="hljs-string">'onceClick'</span>,&#123;</span><br><span class="line">    mounted(el, binding, vnode) &#123;</span><br><span class="line">        el.addEventListener(<span class="hljs-string">'click'</span>, () =&gt; &#123;</span><br><span class="line">            <span class="hljs-keyword">if</span> (!el.disabled) &#123;</span><br><span class="line">                el.disabled = <span class="hljs-literal">true</span>;</span><br><span class="line">                setTimeout(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> &#123;</span><br><span class="line">                    el.disabled = <span class="hljs-literal">false</span>;</span><br><span class="line">                &#125;, binding.value || <span class="hljs-number">1000</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>这样，我们就可以随时随地去使用 <code>v-onceClick</code> 这个指令了。</p><p>可能小伙伴感觉比较疑惑，自定义指令时候的 mounted 以及这里的参数都是咋回事，那么接下来松哥就来和大家详细介绍一下这些方法和参数。</p><h3 id="2-2-七个钩子函数"><a href="#2-2-七个钩子函数" class="headerlink" title="2.2 七个钩子函数"></a>2.2 七个钩子函数</h3><p>在 Vue3 中，自定义指令的钩子函数主要有如下七种（这块跟 Vue2 差异较大）：</p><ul><li>created：在绑定元素的 attribute 或事件监听器被应用之前调用。在指令需要附加在普通的 v-on 事件监听器调用前的事件监听器中时，这很有用。</li><li>beforeMount：当指令第一次绑定到元素并且在挂载父组件之前调用。</li><li>mounted：在绑定元素的父组件被挂载后调用，<strong>大部分自定义指令都写在这里</strong>。</li><li>beforeUpdate：在更新包含组件的 VNode 之前调用。</li><li>updated：在包含组件的 VNode 及其子组件的 VNode 更新后调用。</li><li>beforeUnmount：在卸载绑定元素的父组件之前调用</li><li>unmounted：当指令与元素解除绑定且父组件已卸载时，只调用一次。</li></ul><p>虽然钩子函数比较多，看着有点唬人，不过我们日常开发中用的最多的其实是 mounted 函数。</p><h3 id="2-3-四个参数"><a href="#2-3-四个参数" class="headerlink" title="2.3 四个参数"></a>2.3 四个参数</h3><p>这里七个钩子函数，钩子函数中有回调参数，回调参数有四个，含义基本上和 Vue2 一致：</p><ul><li>el：指令所绑定的元素，可以用来直接操作 DOM，我们松哥说想实现一个可以自动判断组件显示还是隐藏的指令，那么就可以通过 el 对象来操作 DOM 节点，进而实现组件的隐藏。</li><li>binding：我们通过自定义指令传递的各种参数，主要存在于这个对象中，该对象属性较多，如下属性是我们日常开发使用较多的几个：<ul><li>name：指令名，不包括 v- 前缀。</li><li>value：指令的绑定值，例如：<code>v-hasPermission=&quot;[&#39;user:delete&#39;]&quot;</code> 中，绑定值为 <code>&#39;user:delete&#39;</code>，不过需要小伙伴们注意的是，这个绑定值可以是数组也可以是普通对象，关键是看你具体绑定的是什么，在 2.1 小节的案例中，我们的 value 就是一个数字。</li><li>expression：字符串形式的指令表达式。例如 v-my-directive=”1 + 1” 中，表达式为 “1 + 1”。</li><li>arg：传给指令的参数，可选。例如 <code>v-hasPermission:[name]=&quot;&#39;zhangsan&#39;&quot;</code> 中，参数为 “name”。</li></ul></li><li>vnode：Vue 编译生成的虚拟节点。</li><li>oldVnode：上一个虚拟节点，仅在 update 和 componentUpdated 钩子中可用。</li></ul><p>除了 el 之外，其它参数都应该是只读的，切勿进行修改。如果需要在钩子之间共享数据，建议通过元素的 dataset 来进行。</p><h2 id="2-4-动态参数"><a href="#2-4-动态参数" class="headerlink" title="2.4 动态参数"></a>2.4 动态参数</h2><p>有一种动态参数，这里也和小伙伴们分享下。正常情况下，我们自定义指令时传递的参数都是通过 binding.value 来获取到的，不过在这之外还有一种方式就是通过 binding.arg 获取参数。</p><p>我举一个简单例子，假设我们上面这个 onceClick 指令，默认的时间单位时毫秒，假设现在想给时间设置单位，那么我们就可以这样写：</p><figure class="highlight js hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">const</span> app = createApp(App);</span><br><span class="line"></span><br><span class="line">app.directive(<span class="hljs-string">'onceClick'</span>,&#123;</span><br><span class="line">    mounted(el, binding, vnode) &#123;</span><br><span class="line">        el.addEventListener(<span class="hljs-string">'click'</span>, () =&gt; &#123;</span><br><span class="line">            <span class="hljs-keyword">if</span> (!el.disabled) &#123;</span><br><span class="line">                el.disabled = <span class="hljs-literal">true</span>;</span><br><span class="line">                <span class="hljs-keyword">let</span> time = binding.value;</span><br><span class="line">                <span class="hljs-keyword">if</span> (binding.arg == <span class="hljs-string">"s"</span>) &#123;</span><br><span class="line">                    time = time * <span class="hljs-number">1000</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                setTimeout(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> &#123;</span><br><span class="line">                    el.disabled = <span class="hljs-literal">false</span>;</span><br><span class="line">                &#125;, time);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>在自定义指令的时候，获取到 binding.arg 的值，这样就可以知道时间单位了，在使用该指令的时候，方式如下：</p><figure class="highlight html hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">v-onceClick:</span>[<span class="hljs-attr">timeUnit</span>]=<span class="hljs-string">"10"</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">"btnClick"</span>&gt;</span>ClickMe<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span><br><span class="line"><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="hljs-undefined"></span></span><br><span class="line"><span class="hljs-undefined"></span></span><br><span class="line"><span class="hljs-javascript">    <span class="hljs-keyword">import</span> &#123;ref&#125; <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>;</span></span><br><span class="line"><span class="hljs-undefined"></span></span><br><span class="line"><span class="hljs-javascript">    <span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> &#123;</span></span><br><span class="line"><span class="hljs-javascript">        name: <span class="hljs-string">"MyVue01"</span>,</span></span><br><span class="line"><span class="hljs-undefined">        setup() &#123;</span></span><br><span class="line"><span class="hljs-javascript">            <span class="hljs-keyword">const</span> timeUnit = ref(<span class="hljs-string">'s'</span>);</span></span><br><span class="line"><span class="hljs-javascript">            <span class="hljs-keyword">return</span> &#123;timeUnit&#125;</span></span><br><span class="line"><span class="hljs-undefined">        &#125;</span></span><br><span class="line"><span class="hljs-undefined">    &#125;</span></span><br><span class="line"><span class="hljs-undefined"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><p>timeUnit 是一个提前定义好的变量。</p><h2 id="3-自定义权限指令"><a href="#3-自定义权限指令" class="headerlink" title="3. 自定义权限指令"></a>3. 自定义权限指令</h2><p>好啦，有了上面的基础知识，接下来就来看我们本文的主题，自定义权限指令，我写一个简单的例子大家来看下：</p><figure class="highlight js hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">const</span> usersPermissions = [<span class="hljs-string">'user'</span>];</span><br><span class="line"></span><br><span class="line">app.directive(<span class="hljs-string">'hasPermission'</span>, &#123;</span><br><span class="line">    mounted(el, binding, vnode) &#123;</span><br><span class="line">        <span class="hljs-keyword">const</span> &#123;value&#125; = binding;</span><br><span class="line">        <span class="hljs-keyword">let</span> f = usersPermissions.some(<span class="hljs-function"><span class="hljs-params">p</span> =&gt;</span> &#123;</span><br><span class="line">            <span class="hljs-keyword">return</span> p.indexOf(value) !== <span class="hljs-number">-1</span>;</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="hljs-keyword">if</span> (!f) &#123;</span><br><span class="line">            el.parentNode &amp;&amp; el.parentNode.removeChild(el);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>usersPermissions 表示当前用户所具备的权限，正常该数据应该是从服务端加载而来，但是我这里简单起见，就直接定义好了。</p><p>具体的逻辑很简单，先从 binding 中提取出 value 的值，这就是当前控件所需要的权限，然后遍历 usersPermissions 用一个 some 函数，去查看 usersPermissions 中是否有满足条件的值，如果没有，说明当前用户不具备展示该组件所需要的权限，那么就要隐藏这个组件，隐藏的方式就是获取到当前组件的父组件，然后从父组件中移除当前组件即可。</p><p>这是一个全局的指令，定义好之后，我们就可以在组件中直接使用了：</p><figure class="highlight html hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-tag">&lt;<span class="hljs-name">button</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">"btnClick"</span> <span class="hljs-attr">v-hasPermission</span>=<span class="hljs-string">"['user:delete']"</span>&gt;</span>删除用户<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span><br></pre></td></tr></table></figure><p>好啦，Vue3 自定义组件学会了没？松哥在最近的 TienChin 项目视频中也会和大家分享这块的内容，敬请期待。</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;[TOC]&lt;/p&gt;
&lt;p&gt;TienChin 项目前端是 Vue3，前端有这样的一个需求：有一些前端页面上的按钮要根据用户的权限来决定是否展示出来，如果用户具备相应的权限，那么就展示对应的按钮；如果用户不具备对应的权限，那么按钮就隐藏起来。大致上就这样一个需求。&lt;/p&gt;
    
    </summary>
    
      <category term="TienChin" scheme="http://www.javaboy.org/categories/TienChin/"/>
    
    
      <category term="TienChin" scheme="http://www.javaboy.org/tags/TienChin/"/>
    
      <category term="Vue3" scheme="http://www.javaboy.org/tags/Vue3/"/>
    
  </entry>
  
  <entry>
    <title>Spring Boot 整合 Swagger3 指北</title>
    <link href="http://www.javaboy.org/2022/0721/springboot-swagger3.html"/>
    <id>http://www.javaboy.org/2022/0721/springboot-swagger3.html</id>
    <published>2022-07-21T12:21:37.000Z</published>
    <updated>2022-07-21T12:25:14.595Z</updated>
    
    <content type="html"><![CDATA[<p>Swagger 好早之前就更新到 3 了，不过一直没空和小伙伴们分享下具体玩法，主要是也是因为 Swagger 虽然升级了，但是我们在 Spring Boot 中却依然可以使用老版本的 Swagger，不过好像是从 Spring Boot2.6 开始，你会发现用不了老版本的 Swagger 了，哎，反正迟早都得搞，那不如就今天吧！</p><a id="more"></a><p>今天我们就来看看，在 Spring Boot2.7.1 中如何使用 Swagger3。</p><h2 id="1-依赖"><a href="#1-依赖" class="headerlink" title="1. 依赖"></a>1. 依赖</h2><p>首先我们创建一个 Spring Boot 项目，引入 Swagger3 依赖，如下：</p><figure class="highlight xml hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span></span><br><span class="line">    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>io.springfox<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span></span><br><span class="line">    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>springfox-boot-starter<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>3.0.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span></span><br><span class="line"><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>以前在 Swagger2 的时代，这个依赖我们需要引入两个，现在就只需要这一个即可。</p><h2 id="2-配置"><a href="#2-配置" class="headerlink" title="2. 配置"></a>2. 配置</h2><p>接下来在启动类上添加两个注解，开启 Swagger：</p><figure class="highlight java hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-meta">@SpringBootApplication</span></span><br><span class="line"><span class="hljs-comment">//开启swagger</span></span><br><span class="line"><span class="hljs-meta">@EnableSwagger</span>2</span><br><span class="line"><span class="hljs-meta">@EnableOpenApi</span></span><br><span class="line"><span class="hljs-meta">@EnableWebMvc</span></span><br><span class="line"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SwaggerDemoApplication</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;</span><br><span class="line">        SpringApplication.run(SwaggerDemoApplication.class, args);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>现在，基本工作就已经完成了，此时即使我们不做任何额外的事情，Swagger 文档也已经可以自动生成了。</p><p>启动项目，浏览器输入 <code>http://localhost:8080/swagger-ui/index.html</code> 查看 Swagger 文档：</p><p><img src="evernotecid://79DF73BC-F1E1-48CC-A2CB-54B5D68418AE/appyinxiangcom/28106892/ENResource/p224" alt="6fd0ff460477f4f232c81b7d022c3fd4.png"></p><p>小伙伴们需要注意，这个默认的文档访问路径跟以前的 Swagger2 不一样哦！</p><p>现在扫描出来的接口中有一个是 BasicErrorController，这个是 Spring Boot 默认提供的异常处理器，因为我们现在没有为 Swagger 设置包扫描路径，所以就连同这个一起被扫描出来了。</p><p>好了，现在我们可以对这个网页稍微做一些定制，如下：</p><figure class="highlight java hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-meta">@Configuration</span></span><br><span class="line"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Swagger2Config</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-meta">@Bean</span></span><br><span class="line">    <span class="hljs-function">Docket <span class="hljs-title">docket</span><span class="hljs-params">()</span> </span>&#123;</span><br><span class="line">        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> Docket(DocumentationType.OAS_30)</span><br><span class="line">                <span class="hljs-comment">//配置网站的基本信息</span></span><br><span class="line">                .apiInfo(<span class="hljs-keyword">new</span> ApiInfoBuilder()</span><br><span class="line">                        <span class="hljs-comment">//网站标题</span></span><br><span class="line">                        .title(<span class="hljs-string">"TienChin项目在线接口文档"</span>)</span><br><span class="line">                        <span class="hljs-comment">//标题后面的版本号</span></span><br><span class="line">                        .version(<span class="hljs-string">"v1.0"</span>)</span><br><span class="line">                        .description(<span class="hljs-string">"TienChin项目接口文档"</span>)</span><br><span class="line">                        <span class="hljs-comment">//联系人信息</span></span><br><span class="line">                        .contact(<span class="hljs-keyword">new</span> Contact(<span class="hljs-string">"javaboy"</span>, <span class="hljs-string">"http://www.javaboy.org"</span>, <span class="hljs-string">"111@qq.com"</span>))</span><br><span class="line">                        .build())</span><br><span class="line">                .select()</span><br><span class="line">                <span class="hljs-comment">//指定接口的位置</span></span><br><span class="line">                .apis(RequestHandlerSelectors.basePackage(<span class="hljs-string">"org.javaboy.swagger_demo.controller"</span>))</span><br><span class="line">                .build();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>这段配置基本上和之前的 Swagger2 的一致，配置完成后，Swagger 页面的基本信息就会更新过来：</p><p><img src="evernotecid://79DF73BC-F1E1-48CC-A2CB-54B5D68418AE/appyinxiangcom/28106892/ENResource/p225" alt="e1db462ed0c63a9baef5f9b8e6118471.png"></p><h2 id="3-接口配置"><a href="#3-接口配置" class="headerlink" title="3. 接口配置"></a>3. 接口配置</h2><p>接下来就是一些具体的接口配置了。</p><p>这个和 Swagger2 也基本一致，而且很容易懂，下面我来分别向小伙伴们举例说明：</p><figure class="highlight java hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-meta">@RestController</span></span><br><span class="line"><span class="hljs-meta">@Api</span>(tags = <span class="hljs-string">"用户管理相关接口"</span>)</span><br><span class="line"><span class="hljs-meta">@RequestMapping</span>(<span class="hljs-string">"/user"</span>)</span><br><span class="line"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">UserController</span> </span>&#123;</span><br><span class="line">    <span class="hljs-meta">@PostMapping</span>(<span class="hljs-string">"/"</span>)</span><br><span class="line">    <span class="hljs-meta">@ApiOperation</span>(<span class="hljs-string">"添加用户的接口"</span>)</span><br><span class="line">    <span class="hljs-meta">@ApiImplicitParams</span>(&#123;</span><br><span class="line">            <span class="hljs-meta">@ApiImplicitParam</span>(name = <span class="hljs-string">"username"</span>, value = <span class="hljs-string">"用户名"</span>, defaultValue = <span class="hljs-string">"李四"</span>),</span><br><span class="line">            <span class="hljs-meta">@ApiImplicitParam</span>(name = <span class="hljs-string">"address"</span>, value = <span class="hljs-string">"用户地址"</span>, defaultValue = <span class="hljs-string">"深圳"</span>, required = <span class="hljs-keyword">true</span>)</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="hljs-function"><span class="hljs-keyword">public</span> RespBean <span class="hljs-title">addUser</span><span class="hljs-params">(String username, @RequestParam(required = <span class="hljs-keyword">true</span>)</span> String address) </span>&#123;</span><br><span class="line">        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> RespBean();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="hljs-meta">@GetMapping</span>(<span class="hljs-string">"/"</span>)</span><br><span class="line">    <span class="hljs-meta">@ApiOperation</span>(<span class="hljs-string">"根据id查询用户的接口"</span>)</span><br><span class="line">    <span class="hljs-meta">@ApiImplicitParam</span>(name = <span class="hljs-string">"id"</span>, value = <span class="hljs-string">"用户id"</span>, defaultValue = <span class="hljs-string">"99"</span>, required = <span class="hljs-keyword">true</span>)</span><br><span class="line">    <span class="hljs-function"><span class="hljs-keyword">public</span> User <span class="hljs-title">getUserById</span><span class="hljs-params">(@PathVariable Integer id)</span> </span>&#123;</span><br><span class="line">        User user = <span class="hljs-keyword">new</span> User();</span><br><span class="line">        user.setId(id);</span><br><span class="line">        <span class="hljs-keyword">return</span> user;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="hljs-meta">@PutMapping</span>(<span class="hljs-string">"/&#123;id&#125;"</span>)</span><br><span class="line">    <span class="hljs-meta">@ApiOperation</span>(<span class="hljs-string">"根据id更新用户的接口"</span>)</span><br><span class="line">    <span class="hljs-function"><span class="hljs-keyword">public</span> User <span class="hljs-title">updateUserById</span><span class="hljs-params">(@RequestBody User user)</span> </span>&#123;</span><br><span class="line">        <span class="hljs-keyword">return</span> user;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>这里边涉及到多个 API，我来向小伙伴们分别说明：</p><ol><li>@Api 注解可以用来标记当前 Controller 的功能。</li><li>@ApiOperation 注解用来标记一个方法的作用。</li><li>@ApiImplicitParam 注解用来描述一个参数，可以配置参数的中文含义，也可以给参数设置默认值，这样在接口测试的时候可以避免手动输入。</li><li>如果有多个参数，则需要使用多个 @ApiImplicitParam 注解来描述，多个 @ApiImplicitParam 注解需要放在一个 @ApiImplicitParams 注解中。</li><li>需要注意的是，@ApiImplicitParam 注解中虽然可以指定参数是必填的，但是却不能代替 @RequestParam(required = true) ，前者的必填只是在 Swagger 框架内必填，抛弃了 Swagger ，这个限制就没用了，所以假如开发者需要指定一个参数必填， @RequestParam(required = true) 注解还是不能省略。</li><li>如果参数是一个对象（例如上文的更新接口），对于参数的描述也可以放在实体类中。例如下面一段代码：</li></ol><figure class="highlight java hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-meta">@ApiModel</span></span><br><span class="line"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">User</span> </span>&#123;</span><br><span class="line">    <span class="hljs-meta">@ApiModelProperty</span>(value = <span class="hljs-string">"用户id"</span>)</span><br><span class="line">    <span class="hljs-keyword">private</span> Integer id;</span><br><span class="line">    <span class="hljs-meta">@ApiModelProperty</span>(value = <span class="hljs-string">"用户名"</span>)</span><br><span class="line">    <span class="hljs-keyword">private</span> String username;</span><br><span class="line">    <span class="hljs-meta">@ApiModelProperty</span>(value = <span class="hljs-string">"用户地址"</span>)</span><br><span class="line">    <span class="hljs-keyword">private</span> String address;</span><br><span class="line">    <span class="hljs-comment">//getter/setter</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>好了，经过如上配置之后，接下来，刷新刚刚打开的页面，可以看到如下效果：</p><p><img src="http://img.itboyhub.com/2021/springboot2/17-2.png" alt></p><p>可以看到，所有的接口这里都列出来了，包括接口请求方式，接口地址以及接口的名字等，点开一个接口，可以看到如下信息：</p><p><img src="http://img.itboyhub.com/2021/springboot2/17-3.png" alt></p><p>可以看到，接口的参数，参数要求，参数默认值等等统统都展示出来了，参数类型下的 query 表示参数以 <code>key/value</code> 的形式传递，点击右上角的 Try it out，就可以进行接口测试：</p><p><img src="http://img.itboyhub.com/2021/springboot2/17-4.png" alt></p><p>点击 Execute 按钮，表示发送请求进行测试。测试结果会展示在下面的 Response 中。</p><p>小伙伴们注意，参数类型下面的 query 表示参数以 key/value 的形式传递，这里的值也可能是 body，body 表示参数以请求体的方式传递，例如上文的更新接口，如下：</p><p><img src="http://img.itboyhub.com/2021/springboot2/17-5.png" alt></p><p>当然还有一种可能就是这里的参数为 path，表示参数放在路径中传递，例如根据 id 查询用户的接口：</p><p><img src="http://img.itboyhub.com/2021/springboot2/17-6.png" alt></p><p>当然，除了这些之外，还有一些响应值的注解，都比较简单，小伙伴可以自己摸索下。</p><h2 id="4-在-Security-中的配置"><a href="#4-在-Security-中的配置" class="headerlink" title="4. 在 Security 中的配置"></a>4. 在 Security 中的配置</h2><p>如果我们的 Spring Boot 项目中集成了 Spring Security，那么如果不做额外配置，Swagger 文档可能会被拦截，此时只需要在 Spring Security 的配置类中为 Swagger 相关的文件和接口放行即可（SpringBoot2.7.1 最新写法）：</p><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">@Configuration</span><br><span class="line">public class SecurityConfig &#123;</span><br><span class="line">    @Bean</span><br><span class="line">    WebSecurityCustomizer webSecurityCustomizer() &#123;</span><br><span class="line">        return new WebSecurityCustomizer() &#123;</span><br><span class="line">            @Override</span><br><span class="line">            public void customize(WebSecurity web) &#123;</span><br><span class="line">                web.ignoring().antMatchers(&quot;/swagger-ui/**&quot;)</span><br><span class="line">                        .antMatchers(&quot;/swagger-resources/**&quot;)</span><br><span class="line">                        .antMatchers(&quot;/v3/**&quot;);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>如此之后，Swagger 文件就不需要认证就能访问了。不知道小伙伴们有没有看懂呢？有问题欢迎留言讨论。</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;Swagger 好早之前就更新到 3 了，不过一直没空和小伙伴们分享下具体玩法，主要是也是因为 Swagger 虽然升级了，但是我们在 Spring Boot 中却依然可以使用老版本的 Swagger，不过好像是从 Spring Boot2.6 开始，你会发现用不了老版本的 Swagger 了，哎，反正迟早都得搞，那不如就今天吧！&lt;/p&gt;
    
    </summary>
    
      <category term="TienChin" scheme="http://www.javaboy.org/categories/TienChin/"/>
    
    
      <category term="TienChin" scheme="http://www.javaboy.org/tags/TienChin/"/>
    
  </entry>
  
</feed>
